<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>æ˜Ÿéš›è‹±æ‰“å†’éšª âˆ’ ç·¨è¼¯å–®å­—æœ¬</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="responsive_enhanced.css">

  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Source+Sans+Pro:wght@300;400;600;700&family=Noto+Sans+TC:wght@300;400;500;700&family=Noto+Sans+SC:wght@300;400;500;700&family=Noto+Sans+Symbols&family=Noto+Sans+Symbols+2&display=swap" rel="stylesheet">

  <style>
    /*-------------------------
      å…¨åŸŸé‡è¨­ & å­—é«”
    -------------------------*/
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      font-family: 'Noto Sans TC', 'Noto Sans SC', 'Inter', 'Source Sans Pro', -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Microsoft JhengHei', 'PingFang TC', 'Helvetica Neue', Arial, sans-serif;
      background: linear-gradient(to bottom, #020111 0%, #000010 100%);
      color: #fff;
      overflow: hidden;
    }
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    /*-------------------------
      Scrollbar è‡ªè¨‚ (WebKit)
    -------------------------*/
    ::-webkit-scrollbar {
      width: 12px;
      height: 12px;
    }
    ::-webkit-scrollbar-track {
      background: rgba(0, 0, 0, 0.2);
      border-radius: 6px;
    }
    ::-webkit-scrollbar-thumb {
      background: rgba(69, 162, 158, 0.6);
      border-radius: 6px;
      border: 2px solid rgba(0,0,0,0.2);
    }
    ::-webkit-scrollbar-thumb:hover {
      background: rgba(69, 162, 158, 0.8);
    }
    body {
      scrollbar-width: thin;
      scrollbar-color: rgba(69,162,158,0.6) rgba(0,0,0,0.2);
    }

    /*-------------------------
      å·¦ä¸Šè§’ TopBarï¼ˆé¡¯ç¤ºç¸½æ˜Ÿæ˜Ÿæ•¸ + è¿”å›å–®å­—æœ¬åˆ—è¡¨ï¼‰
    -------------------------*/
    #topBar {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      background: rgba(10, 20, 40, 0.85);
      padding: 10px 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      z-index: 3;
      border-bottom: 2px solid #00ffff;
      box-shadow: 0 0 16px #00ffff;
    }
    #topBar #starsDisplay {
      font-size: 1.2rem;
      color: #ffd700;
      font-weight: bold;
      text-shadow: 0 0 8px #ffd700;
    }
    #topBar .back-btn {
      background: linear-gradient(90deg, #00ffff 0%, #a259ff 100%);
      border: none;
      color: #000;
      border-radius: 8px;
      padding: 8px 16px;
      font-size: 0.9rem;
      text-decoration: none;
      transition: transform 0.2s, box-shadow 0.2s;
      cursor: pointer;
      font-weight: bold;
      box-shadow: 0 0 16px #00ffff;
    }
    #topBar .back-btn:hover {
      transform: scale(1.05);
      box-shadow: 0 0 24px #00ffff;
    }

    /*-------------------------
      æ˜Ÿç©º Canvas èƒŒæ™¯
    -------------------------*/
    canvas#stars {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: 0;
    }

    /*-------------------------
      ä¸»å®¹å™¨
    -------------------------*/
    .container {
      position: relative;
      z-index: 1;
      max-width: 800px;
      margin: 80px auto 40px;
      background: rgba(10, 20, 40, 0.7);
      padding: 30px;
      border-radius: 20px;
      box-shadow: 0 0 32px #00ffff44, 0 0 80px #a259ff22 inset;
      border: 2px solid #00ffff;
      backdrop-filter: blur(8px);
      overflow-y: auto;
      max-height: calc(100vh - 140px);
    }
    .container h1 {
      color: #00ffff;
      text-align: center;
      text-shadow: 0 0 12px #00ffff, 0 0 32px #a259ff;
      margin-bottom: 20px;
      font-size: 2rem;
      letter-spacing: 1px;
      font-family: 'Orbitron', sans-serif;
    }
    .container h2 {
      color: #99ccff;
      margin-top: 24px;
      margin-bottom: 12px;
      font-size: 1.3rem;
      text-shadow: 0 0 6px #3388cc;
      font-family: 'Orbitron', sans-serif;
    }

    /*-------------------------
      éŠæˆ²é¸å–® æŒ‰éˆ•å€å¡Š
    -------------------------*/
    .game-menu-btn {
      display: block;
      width: 100%;
      text-align: center;
      background: linear-gradient(90deg, #00ffff 0%, #a259ff 100%);
      color: #000;
      border: none;
      border-radius: 12px;
      padding: 14px 0;
      font-size: 1.1rem;
      font-weight: bold;
      margin: 16px 0;
      cursor: pointer;
      box-shadow: 0 0 16px #00ffff, 0 0 24px #a259ff99;
      transition: transform 0.2s, box-shadow 0.2s;
      font-family: 'Orbitron', sans-serif;
    }
    .game-menu-btn:hover {
      transform: scale(1.02);
      box-shadow: 0 0 24px #00ffff, 0 0 32px #a259ffcc;
    }

    /*-------------------------
      éŠæˆ²å½ˆçª—ï¼ˆmodalï¼‰æ¨£å¼
    -------------------------*/
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.8);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 4;
      backdrop-filter: blur(4px);
    }
    .modal-content {
      background: rgba(10, 20, 40, 0.95);
      border: 2px solid #00ffff;
      border-radius: 16px;
      padding: 30px;
      width: 90%;
      max-width: 450px;
      box-shadow: 0 0 32px #00ffff44, 0 0 80px #a259ff22 inset;
      backdrop-filter: blur(8px);
    }
    .modal-content h2 {
      text-align: center;
      color: #00ffff;
      margin-bottom: 20px;
      text-shadow: 0 0 8px #00ffff;
      font-size: 1.5rem;
    }
    .modal-content button {
      width: 100%;
      background: linear-gradient(90deg, #00ffff 0%, #a259ff 100%);
      border: none;
      color: #000;
      border-radius: 10px;
      padding: 12px 0;
      font-size: 1rem;
      margin-bottom: 12px;
      cursor: pointer;
      transition: transform 0.2s, box-shadow 0.2s;
      font-weight: bold;
      box-shadow: 0 0 16px #00ffff;
    }
    .modal-content button:hover {
      transform: scale(1.02);
      box-shadow: 0 0 24px #00ffff;
    }
    .modal-close {
      display: block;
      margin: 16px auto 0;
      background: linear-gradient(90deg, #ff4444 0%, #cc0000 100%);
      color: #fff;
      border: none;
      border-radius: 8px;
      padding: 10px 20px;
      font-size: 0.9rem;
      cursor: pointer;
      transition: transform 0.2s, box-shadow 0.2s;
      font-weight: bold;
      box-shadow: 0 0 16px #ff4444;
    }
    .modal-close:hover {
      transform: scale(1.05);
      box-shadow: 0 0 24px #ff4444;
    }

    /*-------------------------
      Disabled æŒ‰éˆ•æ¨£å¼
    -------------------------*/
    button:disabled {
      background: #555 !important;
      color: #aaa !important;
      cursor: not-allowed !important;
      box-shadow: none !important;
      transform: none !important;
    }

    /*-------------------------
      åŒ¯å…¥/åŒ¯å‡º å€å¡Š
    -------------------------*/
    .io-group {
      display: flex;
      gap: 12px;
      align-items: center;
      flex-wrap: wrap;
    }
    .io-group input[type="file"] {
      color: #c5c6c7;
      background: rgba(255,255,255,0.1);
      border: 1px solid #00ffff;
      border-radius: 8px;
      padding: 8px;
      box-shadow: 0 0 8px #00ffff80;
    }
    .io-group button {
      background: linear-gradient(90deg, #00ffff 0%, #a259ff 100%);
      color: #000;
      border: none;
      border-radius: 8px;
      padding: 10px 16px;
      font-size: 0.95rem;
      cursor: pointer;
      box-shadow: 0 0 16px #00ffff;
      transition: transform 0.2s, box-shadow 0.2s;
      font-weight: bold;
      font-family: 'Orbitron', sans-serif;
    }
    .io-group button:hover {
      transform: scale(1.05);
      box-shadow: 0 0 24px #00ffff;
    }

    /*-------------------------
      æª”æ¡ˆæ ¼å¼èªªæ˜
    -------------------------*/
    .format-info {
      background: rgba(10, 20, 40, 0.6);
      border: 1px solid #00ffff;
      border-radius: 12px;
      padding: 16px;
      margin: 16px 0;
      font-size: 0.9rem;
      color: #c5c6c7;
      box-shadow: 0 0 16px #00ffff44;
    }
    .format-info strong {
      color: #00ffff;
      text-shadow: 0 0 4px #00ffff;
    }
    .format-info code {
      background: rgba(0,0,0,0.3);
      padding: 2px 6px;
      border-radius: 4px;
      color: #ffd700;
      font-family: 'Roboto Mono', monospace;
    }

    /*-------------------------
      æ–°å¢å–®å­— å€å¡Š
    -------------------------*/
    .add-group input,
    .add-group textarea {
      width: 100%;
      padding: 12px;
      margin: 8px 0;
      border-radius: 10px;
      border: 2px solid #00ffff;
      background: rgba(10, 20, 40, 0.7);
      color: #fff;
      font-size: 1rem;
      box-shadow: 0 0 16px #00ffff80;
      font-family: 'Noto Sans TC', 'Noto Sans SC', 'Noto Sans Symbols', 'Noto Sans Symbols 2', 'Inter', 'Source Sans Pro', -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Microsoft JhengHei', 'PingFang TC', sans-serif;
      font-weight: 400;
      line-height: 1.5;
    }
    .add-group input:focus,
    .add-group textarea:focus {
      outline: none;
      box-shadow: 0 0 24px #00ffff;
    }
    .add-group textarea {
      resize: vertical;
      height: 80px;
    }
    .add-group button {
      background: linear-gradient(90deg, #00ffff 0%, #a259ff 100%);
      color: #000;
      border: none;
      border-radius: 10px;
      padding: 12px 20px;
      font-size: 1rem;
      cursor: pointer;
      box-shadow: 0 0 16px #00ffff;
      transition: transform 0.2s, box-shadow 0.2s;
      margin-top: 12px;
      font-weight: bold;
      font-family: 'Orbitron', sans-serif;
    }
    .add-group button:hover {
      transform: scale(1.05);
      box-shadow: 0 0 24px #00ffff;
    }

    /*-------------------------
      å–®å­—åˆ—è¡¨
    -------------------------*/
    ul#wordList {
      list-style: none;
      margin-top: 16px;
      padding-left: 0;
    }
    ul#wordList li {
      background: rgba(10, 20, 40, 0.6);
      margin-bottom: 12px;
      padding: 16px;
      border-radius: 12px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      border: 1px solid #00ffff;
      box-shadow: 0 0 16px #00ffff44;
      transition: transform 0.2s, box-shadow 0.2s;
    }
    ul#wordList li:hover {
      transform: translateY(-2px);
      box-shadow: 0 0 24px #00ffff66;
    }
    ul#wordList li span.word-item {
      display: flex;
      flex-direction: column;
      align-items: flex-start;
      flex: 1;
      gap: 8px;
    }
    ul#wordList li span.word-item .word-row {
      display: flex;
      align-items: center;
      gap: 12px;
      width: 100%;
    }
    ul#wordList li span.word-item .word-number {
      font-size: 1rem;
      color: #00ffff;
      text-shadow: 0 0 4px #00ffff;
      font-weight: bold;
      min-width: 30px;
      text-align: center;
      font-family: 'Orbitron', sans-serif;
      background: rgba(0, 255, 255, 0.1);
      border-radius: 6px;
      padding: 4px 8px;
      border: 1px solid rgba(0, 255, 255, 0.3);
    }
    ul#wordList li span.word-item .example-row {
      display: flex;
      flex-direction: column;
      gap: 4px;
      width: 100%;
      margin-left: 20px;
    }
    ul#wordList li span.word-item b.english-word {
      font-size: 1.2rem;
      color: #ffd700;
      text-shadow: 0 0 6px #ffd700;
      min-width: 120px;
      font-family: 'Source Sans Pro', 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      font-weight: 600;
      letter-spacing: 0.5px;
    }
    ul#wordList li span.word-item span.chinese-meaning {
      font-size: 1.1rem;
      color: #99ccff;
      text-shadow: 0 0 4px #3388cc;
      font-family: 'Noto Sans TC', 'Noto Sans SC', 'Noto Sans Symbols', 'Noto Sans Symbols 2', 'Microsoft JhengHei', 'PingFang TC', -apple-system, BlinkMacSystemFont, sans-serif;
      font-weight: 500;
    }
    ul#wordList li span.word-item span.english-example {
      font-size: 0.95rem;
      color: #c5c6c7;
      font-style: italic;
      text-shadow: 0 0 2px #666;
      font-family: 'Source Sans Pro', 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      font-weight: 400;
      line-height: 1.4;
    }
    ul#wordList li span.word-item span.example-translation {
      font-size: 0.9rem;
      color: #888;
      margin-left: 10px;
      font-family: 'Noto Sans TC', 'Noto Sans SC', 'Noto Sans Symbols', 'Noto Sans Symbols 2', 'Microsoft JhengHei', 'PingFang TC', -apple-system, BlinkMacSystemFont, sans-serif;
      font-weight: 400;
    }
    /* æŒ‰éˆ•ç¾¤çµ„ */
    ul#wordList li div {
      display: flex;
      gap: 8px;
      align-items: center;
    }
    /* åˆªé™¤æŒ‰éˆ• */
    ul#wordList li button.btn-delete {
      background: linear-gradient(90deg, #ff4444 0%, #cc0000 100%);
      color: #fff;
      border: none;
      border-radius: 8px;
      padding: 8px 12px;
      font-size: 0.9rem;
      cursor: pointer;
      transition: transform 0.2s, box-shadow 0.2s;
      font-weight: bold;
      box-shadow: 0 0 12px #ff4444;
    }
    ul#wordList li button.btn-delete:hover {
      transform: scale(1.05);
      box-shadow: 0 0 16px #ff4444;
    }
    /* ç™¼éŸ³æŒ‰éˆ• */
    ul#wordList li button.btn-pronounce {
      background: linear-gradient(90deg, #ffd700 0%, #ffaa00 100%);
      color: #000;
      border: none;
      border-radius: 8px;
      padding: 8px 12px;
      font-size: 0.9rem;
      cursor: pointer;
      transition: transform 0.2s, box-shadow 0.2s;
      font-weight: bold;
      box-shadow: 0 0 12px #ffd700;
    }
    ul#wordList li button.btn-pronounce:hover {
      transform: scale(1.05);
      box-shadow: 0 0 16px #ffd700;
    }
    /* ä¾‹å¥ç™¼éŸ³æŒ‰éˆ• */
    ul#wordList li button.btn-pronounce[onclick*="pronounceSentence"] {
      background: linear-gradient(90deg, #3498db 0%, #2980b9 100%);
      color: #fff;
      box-shadow: 0 0 12px #3498db;
    }
    ul#wordList li button.btn-pronounce[onclick*="pronounceSentence"]:hover {
      box-shadow: 0 0 16px #3498db;
    }

    /*-------------------------
      Scrollbar for .container
    -------------------------*/
    .container::-webkit-scrollbar {
      width: 12px;
    }
    .container::-webkit-scrollbar-track {
      background: rgba(0,0,0,0.2);
      border-radius: 6px;
    }
    .container::-webkit-scrollbar-thumb {
      background: rgba(69,162,158,0.6);
      border-radius: 6px;
      border: 2px solid rgba(0,0,0,0.2);
    }
    .container::-webkit-scrollbar-thumb:hover {
      background: rgba(69,162,158,0.8);
    }
    .container {
      scrollbar-width: thin;
      scrollbar-color: rgba(69,162,158,0.6) rgba(0,0,0,0.2);
    }

    /*-------------------------
      æœå°‹å–®å­— å€å¡Š
    -------------------------*/
    .search-group {
      display: flex;
      gap: 12px;
      margin-bottom: 16px;
    }
    .search-group input[type="search"] {
      flex: 1;
      padding: 10px 16px;
      border-radius: 10px;
      border: 2px solid #00ffff;
      background: rgba(10, 20, 40, 0.7);
      color: #fff;
      font-size: 1rem;
      box-shadow: 0 0 16px #00ffff80;
      font-family: 'Inter', 'Source Sans Pro', sans-serif;
    }
    .search-group input[type="search"]:focus {
      outline: none;
      box-shadow: 0 0 24px #00ffff;
    }
    .search-group button {
      background: linear-gradient(90deg, #ff4444 0%, #cc0000 100%);
      color: #fff;
      border: none;
      border-radius: 8px;
      padding: 10px 16px;
      font-size: 0.9rem;
      cursor: pointer;
      box-shadow: 0 0 12px #ff4444;
      font-family: 'Orbitron', sans-serif;
      font-weight: bold;
    }
    #searchNotFound {
      text-align: center;
      padding: 20px;
      margin-top: 10px;
      background: rgba(255, 215, 0, 0.1);
      border: 1px solid rgba(255, 215, 0, 0.3);
      border-radius: 12px;
      color: #ffd700;
      font-size: 1.1rem;
    }
    #searchNotFound button {
      margin-left: 15px;
      background: linear-gradient(90deg, #00ffff 0%, #a259ff 100%);
      color: #000;
      border: none;
      border-radius: 8px;
      padding: 8px 16px;
      font-size: 1rem;
      cursor: pointer;
      font-family: 'Orbitron', sans-serif;
      font-weight: bold;
      box-shadow: 0 0 12px #00ffff;
    }
  </style>
</head>
<body>
  <!-- å·¦ä¸Šè§’ TopBarï¼šæ˜Ÿæ˜Ÿæ•¸ + è¿”å›å–®å­—æœ¬åˆ—è¡¨ -->
  <div id="topBar">
    <div id="starsDisplay">â­<span id="totalStarsCount">0</span></div>
    <a href="book.html" class="back-btn">â¬… è¿”å›å–®å­—æœ¬åˆ—è¡¨</a>
  </div>

  <!-- æ˜Ÿç©º Canvas -->
  <canvas id="stars"></canvas>

  <!-- ä¸»å®¹å™¨ï¼šç·¨è¼¯å–®å­—æœ¬ -->
  <div class="container">
    <h1>ğŸ“– ç·¨è¼¯å–®å­—æœ¬ï¼š<span id="bookNameDisplay"></span></h1>

    <!-- éŠæˆ²é¸å–®æŒ‰éˆ• -->
    <button class="game-menu-btn" onclick="openGameModal()">ğŸ® éŠæˆ²é¸å–®</button>

    <!-- åŒ¯å…¥ / åŒ¯å‡º -->
    <h2>ğŸ“¥ åŒ¯å…¥ / ğŸ“¤ åŒ¯å‡º</h2>
    <div class="io-group">
      <input type="file" id="fileInput" accept=".csv,.txt">
      <button onclick="importFile()">åŒ¯å…¥æª”æ¡ˆ</button>
      <button onclick="exportCSV()">åŒ¯å‡º CSV</button>
    </div>
    
    <!-- æª”æ¡ˆæ ¼å¼èªªæ˜ -->
    <div class="format-info">
      <strong>ğŸ“‹ æ”¯æ´çš„æª”æ¡ˆæ ¼å¼ï¼š</strong><br>
      â€¢ CSV æ ¼å¼ï¼š<code>apple,è˜‹æœ,This is an apple.,é€™æ˜¯ä¸€å€‹è˜‹æœã€‚</code><br>
      â€¢ ä¸­æ–‡å†’è™Ÿï¼š<code>appleï¼šè˜‹æœï¼šThis is an apple.ï¼šé€™æ˜¯ä¸€å€‹è˜‹æœã€‚</code><br>
      â€¢ è‹±æ–‡å†’è™Ÿï¼š<code>apple:è˜‹æœ:This is an apple.:é€™æ˜¯ä¸€å€‹è˜‹æœã€‚</code><br>
      â€¢ Tab åˆ†éš”ï¼š<code>apple	è˜‹æœ	This is an apple.	é€™æ˜¯ä¸€å€‹è˜‹æœã€‚</code><br>
      â€¢ ç©ºæ ¼åˆ†éš”ï¼š<code>apple è˜‹æœ This is an apple. é€™æ˜¯ä¸€å€‹è˜‹æœã€‚</code><br>
      <em>æ¯è¡Œä¸€å€‹å–®å­—ï¼Œæ ¼å¼ï¼šè‹±æ–‡å–®å­— + åˆ†éš”ç¬¦ + ä¸­æ–‡è§£é‡‹ + åˆ†éš”ç¬¦ + è‹±æ–‡ä¾‹å¥ + åˆ†éš”ç¬¦ + ä¾‹å¥ä¸­æ–‡è§£é‡‹</em><br>
      <em style="color: #999;">æ³¨æ„ï¼šä¾‹å¥ä¸­æ–‡è§£é‡‹ç‚ºå¯é¸æ¬„ä½ï¼Œå¦‚æœæ²’æœ‰æä¾›æœƒè‡ªå‹•è¨­ç‚ºç©ºå­—ä¸²</em><br>
      <br>
      <strong>ğŸ”¤ æ”¯æ´çš„æª”æ¡ˆç·¨ç¢¼ï¼š</strong><br>
      â€¢ UTF-8ï¼ˆæ¨è–¦ï¼‰<br>
      â€¢ Big5ï¼ˆç¹é«”ä¸­æ–‡ï¼‰<br>
      â€¢ GBKï¼ˆç°¡é«”ä¸­æ–‡ï¼‰<br>
      â€¢ GB2312ï¼ˆç°¡é«”ä¸­æ–‡ï¼‰<br>
      â€¢ UTF-16<br>
      <em style="color: #999;">ç³»çµ±æœƒè‡ªå‹•æª¢æ¸¬ä¸¦è™•ç†ä¸åŒç·¨ç¢¼æ ¼å¼ï¼Œè§£æ±ºä¸­æ–‡äº‚ç¢¼å•é¡Œ</em><br>
      <br>
      <strong>ğŸ“Š åŒ¯å…¥åŠŸèƒ½ç‰¹è‰²ï¼š</strong><br>
      â€¢ âœ… æ”¯æ´ç„¡é™æ•¸é‡çš„å–®å­—åŒ¯å…¥<br>
      â€¢ âœ… å³æ™‚é€²åº¦é¡¯ç¤º<br>
      â€¢ âœ… æ‰¹æ¬¡è™•ç†ï¼Œé¿å…ç€è¦½å™¨å¡é “<br>
      â€¢ âœ… è‡ªå‹•è·³éç„¡æ•ˆè¡Œä¸¦é¡¯ç¤ºçµ±è¨ˆ<br>
      â€¢ âœ… æ”¯æ´å¤§å‹æª”æ¡ˆï¼ˆæ•¸åƒå€‹å–®å­—ï¼‰<br>
      â€¢ ğŸ”„ è‡ªå‹•éæ¿¾é‡è¤‡å–®å­—ï¼ˆä¾è‹±æ–‡å–®å­—åˆ¤æ–·ï¼‰<br>
      <em style="color: #999;">åŒ¯å…¥å¤§é‡å–®å­—æ™‚æœƒé¡¯ç¤ºé€²åº¦æ¢ï¼Œè«‹è€å¿ƒç­‰å¾…å®Œæˆ</em>
    </div>

    <!-- æ–°å¢å–®å­— -->
    <h2>â• æ–°å¢å–®å­—</h2>
    <div class="add-group">
      <input id="word" placeholder="è‹±æ–‡å–®å­—">
      <input id="meaning" placeholder="ä¸­æ–‡è§£é‡‹">
      <textarea id="example" placeholder="è‹±æ–‡ä¾‹å¥"></textarea>
      <textarea id="exampleMeaning" placeholder="ä¾‹å¥ä¸­æ–‡è§£é‡‹"></textarea>
      <button onclick="addWord()">æ–°å¢</button>
    </div>

    <!-- å–®å­—åˆ—è¡¨ -->
    <h2>ğŸ—‚ å–®å­—åˆ—è¡¨</h2>

    <!-- æœå°‹å–®å­— -->
    <div class="search-group">
      <input type="search" id="searchInput" placeholder="å³æ™‚æœå°‹è‹±æ–‡å–®å­—..." oninput="searchWord()">
      <button onclick="clearSearch()">æ¸…é™¤æœå°‹</button>
    </div>

    <ul id="wordList"></ul>
    <div id="searchNotFound" style="display: none;"></div>
  </div>

  <!-- éŠæˆ²é¸å–® Modal -->
  <div class="modal-overlay" id="gameModal">
    <div class="modal-content">
      <h2>é¸æ“‡éŠæˆ²æ¨¡å¼</h2>
      <button onclick="startSpelling()">
        æ‹¼å­—éŠæˆ²<br>
        <span style="font-size:0.8rem;color:#ccc;">(é¡¯ç¤ºæ„æ€ï¼Œæ‹¼å‡ºè‹±æ–‡å­—)</span>
      </button>
      <button onclick="startMatching()">
        å–®å­—é…å°éŠæˆ²<br>
        <span style="font-size:0.8rem;color:#ccc;">(è¨˜æ†¶é…å°å¡)</span>
      </button>
      <button onclick="startTimeChallenge()">
        æ™‚é–“æŒ‘æˆ°<br>
        <span style="font-size:0.8rem;color:#ccc;">(é™æ™‚ç­”é¡Œ)</span>
      </button>
      <button onclick="startQuiz('meaning-to-word')">
        å–®å­—é¸æ“‡é¡Œ<br>
        <span style="font-size:0.8rem;color:#ccc;">(ç”±æ„æ€é¸å–®å­—)</span>
      </button>
      <button class="modal-close" onclick="closeGameModal()">é—œé–‰</button>
    </div>
  </div>

  <!-- é€™æ˜¯éš±è—çš„è¼¸å…¥æ¡† -->
  <input type="text" id="secretInput" style="position: absolute; left: -9999px; opacity: 0;" placeholder="è¼¸å…¥å¿«æ·éµ">

  <script src="js/sound.js"></script>
  <script src="js/starRewardSystem.js"></script>
  <script>
    /*----------------------------------------
      (1) è®€å–æ˜Ÿæ˜Ÿæ•¸ä¸¦é¡¯ç¤º
    ----------------------------------------*/
    function loadTotalStars() {
      const v = localStorage.getItem('totalStars');
      return v ? parseInt(v, 10) : 0;
    }
    function updateStarsDisplay() {
      StarRewardSystem.updateStarsDisplay();
    }

    /*----------------------------------------
      (2) æ˜Ÿç©ºèƒŒæ™¯å‹•ç•«
    ----------------------------------------*/
    const canvas = document.getElementById('stars');
    const ctx = canvas.getContext('2d');
    let W, H;
    let stars = [];
    const numStars = 100;

    function initCanvas() {
      W = window.innerWidth;
      H = window.innerHeight;
      canvas.width = W;
      canvas.height = H;
      stars = [];
      for (let i = 0; i < numStars; i++) {
        stars.push({
          x: Math.random() * W,
          y: Math.random() * H,
          size: Math.random() * 1.5 + 0.5,
          speed: Math.random() * 0.5 + 0.2
        });
      }
    }

    function updateStars() {
      stars.forEach(s => {
        s.y += s.speed;
        if (s.y > H) {
          s.y = 0;
          s.x = Math.random() * W;
        }
      });
    }

    function drawStars() {
      ctx.clearRect(0, 0, W, H);
      ctx.fillStyle = '#ffffff';
      stars.forEach(s => {
        ctx.beginPath();
        ctx.arc(s.x, s.y, s.size, 0, Math.PI * 2);
        ctx.fill();
      });
    }

    function animate() {
      updateStars();
      drawStars();
      requestAnimationFrame(animate);
    }

    window.addEventListener('resize', initCanvas);

    /*----------------------------------------
      (3) å–®å­—æœ¬ç®¡ç†é‚è¼¯
    ----------------------------------------*/
    const bookName = new URLSearchParams(location.search).get('book');
    const storageKey = 'book_' + bookName;
    let vocab = JSON.parse(localStorage.getItem(storageKey) || '[]');

    document.getElementById('bookNameDisplay').textContent = bookName;

    function saveVocab() {
      localStorage.setItem(storageKey, JSON.stringify(vocab));
    }

    function displayWords(filter = '') {
      const ul = document.getElementById('wordList');
      const searchNotFoundDiv = document.getElementById('searchNotFound');
      ul.innerHTML = '';
      searchNotFoundDiv.style.display = 'none';

      const lowerCaseFilter = filter.toLowerCase();
      const filteredVocab = vocab.filter(v => 
        v.word.toLowerCase().includes(lowerCaseFilter) ||
        v.meaning.toLowerCase().includes(lowerCaseFilter)
      );

      if (filteredVocab.length === 0 && filter) {
        searchNotFoundDiv.style.display = 'block';
        searchNotFoundDiv.innerHTML = `
          <span>ğŸ¤·â€â™‚ï¸ æ‰¾ä¸åˆ°åŒ…å« "<strong>${filter}</strong>" çš„å–®å­—</span>
          <button onclick="prepareAddWord('${filter}')">â• æ–°å¢ç‚ºå–®å­—</button>
        `;
      } else {
        filteredVocab.forEach((v) => {
          const originalIndex = vocab.findIndex(item => item === v);
          const li = document.createElement('li');
          li.innerHTML = `
            <span class="word-item">
              <div class="word-row">
                <span class="word-number">${originalIndex + 1}.</span>
                <b class="english-word">${v.word}</b>
                <span class="chinese-meaning">${v.meaning}</span>
              </div>
              <div class="example-row">
                <span class="english-example">${v.example}</span>
                <span class="example-translation">${v.exampleMeaning || ''}</span>
              </div>
            </span>
            <div>
              <button class="btn-pronounce" onclick="pronounceWord('${v.word}')" title="å”¸å‡ºå–®å­—">ğŸ”Š</button>
              <button class="btn-pronounce" onclick="pronounceSentence('${v.example}')" title="å”¸å‡ºä¾‹å¥">ğŸ“</button>
              <button class="btn-delete" onclick="deleteWord(${originalIndex})">åˆªé™¤</button>
            </div>
          `;
          ul.appendChild(li);
        });
      }
    }

    function searchWord() {
      const searchTerm = document.getElementById('searchInput').value.trim();
      displayWords(searchTerm);
    }

    function clearSearch() {
      document.getElementById('searchInput').value = '';
      displayWords();
    }

    function prepareAddWord(word) {
      const wordInput = document.getElementById('word');
      // å¦‚æœæœå°‹çš„æ˜¯ä¸­æ–‡ï¼Œå‰‡å¡«å…¥ä¸­æ–‡æ¬„ä½
      if (/[\u4e00-\u9fa5]/.test(word)) {
        document.getElementById('meaning').value = word;
        document.getElementById('word').focus();
      } else {
        wordInput.value = word;
        document.getElementById('meaning').focus();
      }
      document.querySelector('.add-group').scrollIntoView({ behavior: 'smooth', block: 'center' });
    }

    function addWord() {
      const w = document.getElementById('word').value.trim();
      const m = document.getElementById('meaning').value.trim();
      const e = document.getElementById('example').value.trim();
      const em = document.getElementById('exampleMeaning').value.trim();
      if (!w || !m || !e) return alert('è«‹è‡³å°‘è¼¸å…¥è‹±æ–‡ã€ä¸­æ–‡å’Œè‹±æ–‡ä¾‹å¥ã€‚');
      vocab.push({ word: w, meaning: m, example: e, exampleMeaning: em });
      saveVocab();
      displayWords();
      document.getElementById('word').value = '';
      document.getElementById('meaning').value = '';
      document.getElementById('example').value = '';
      document.getElementById('exampleMeaning').value = '';
      
      // æ–°å¢å¾Œæ¸…é™¤æœå°‹æ¢ä»¶ï¼Œä»¥é¡¯ç¤ºå®Œæ•´åˆ—è¡¨
      clearSearch();
    }

    function deleteWord(index) {
      if (!confirm('ç¢ºå®šåˆªé™¤é€™å€‹å–®å­—ï¼Ÿ')) return;
      vocab.splice(index, 1);
      saveVocab();
      // ä¿æŒç›®å‰çš„æœå°‹çµæœ
      const searchTerm = document.getElementById('searchInput').value.trim();
      displayWords(searchTerm);
    }

    function importFile() {
      const file = document.getElementById('fileInput').files[0];
      if (!file) return alert('è«‹é¸æ“‡æª”æ¡ˆã€‚');
      
      // é¡¯ç¤ºåŒ¯å…¥é€²åº¦
      const progressModal = document.createElement('div');
      progressModal.className = 'modal-overlay';
      progressModal.style.display = 'flex';
      progressModal.innerHTML = `
        <div class="modal-content">
          <h2>ğŸ“¥ æ­£åœ¨åŒ¯å…¥æª”æ¡ˆ...</h2>
          <div style="text-align: center; margin: 20px 0;">
            <div style="font-size: 1.2rem; color: #00ffff; margin-bottom: 10px;">
              <span id="importProgress">0</span> / <span id="totalLines">0</span> è¡Œ
            </div>
            <div style="width: 100%; height: 8px; background: rgba(0,0,0,0.3); border-radius: 4px; overflow: hidden;">
              <div id="progressBar" style="width: 0%; height: 100%; background: linear-gradient(90deg, #00ffff, #a259ff); transition: width 0.3s;"></div>
            </div>
          </div>
          <div id="importStatus" style="text-align: center; color: #c5c6c7; font-size: 0.9rem;">
            æ­£åœ¨è®€å–æª”æ¡ˆ...
          </div>
        </div>
      `;
      document.body.appendChild(progressModal);
      
      // å˜—è©¦å¤šç¨®ç·¨ç¢¼æ ¼å¼ä¾†è§£æ±ºä¸­æ–‡äº‚ç¢¼å•é¡Œ
      const tryEncoding = (encoding) => {
        return new Promise((resolve, reject) => {
          const reader = new FileReader();
          reader.onload = (e) => resolve(e.target.result);
          reader.onerror = reject;
          reader.readAsText(file, encoding);
        });
      };
      
      // æŒ‰å„ªå…ˆé †åºå˜—è©¦ä¸åŒç·¨ç¢¼
      const encodings = ['utf-8', 'big5', 'gbk', 'gb2312', 'utf-16'];
      
      Promise.any(encodings.map(encoding => tryEncoding(encoding)))
        .then(text => {
          // ç§»é™¤ BOM æ¨™è¨˜
          text = text.replace(/^\uFEFF/, '');
          
          const lines = text.split('\n').filter(l => l.trim());
          const totalLines = lines.length;
          let importedCount = 0;
          let skippedCount = 0;
          let duplicateCount = 0;
          
          // å»ºç«‹ç¾æœ‰å–®å­—çš„ Set ä»¥åŠ é€ŸæŸ¥è©¢ï¼ˆä¸åˆ†å¤§å°å¯«ï¼‰
          const existingWords = new Set(vocab.map(v => v.word.toLowerCase()));

          // æ›´æ–°ç¸½è¡Œæ•¸
          document.getElementById('totalLines').textContent = totalLines;
          document.getElementById('importStatus').textContent = 'æ­£åœ¨è§£æå–®å­—è³‡æ–™...';
          
          // æ‰¹æ¬¡è™•ç†ï¼Œé¿å…é˜»å¡UI
          const batchSize = 100;
          const processBatch = (startIndex) => {
            const endIndex = Math.min(startIndex + batchSize, totalLines);
            
            for (let i = startIndex; i < endIndex; i++) {
              const line = lines[i];
              let word, meaning, example, exampleMeaning;
              
              // å˜—è©¦ä¸åŒçš„åˆ†éš”ç¬¦è™Ÿæ ¼å¼
              if (line.includes(',')) {
                // CSV æ ¼å¼ï¼šword,meaning,example,exampleMeaning
                const parts = line.split(',').map(s => s.trim());
                if (parts.length >= 4) {
                  [word, meaning, example, exampleMeaning] = parts;
                } else if (parts.length === 3) {
                  [word, meaning, example] = parts;
                  exampleMeaning = '';
                }
              } else if (line.includes('ï¼š')) {
                // ä¸­æ–‡å†’è™Ÿæ ¼å¼ï¼šwordï¼šmeaningï¼šexampleï¼šexampleMeaning
                const parts = line.split('ï¼š').map(s => s.trim());
                if (parts.length >= 4) {
                  [word, meaning, example, exampleMeaning] = parts;
                } else if (parts.length === 3) {
                  [word, meaning, example] = parts;
                  exampleMeaning = '';
                }
              } else if (line.includes(':')) {
                // è‹±æ–‡å†’è™Ÿæ ¼å¼ï¼šword:meaning:example:exampleMeaning
                const parts = line.split(':').map(s => s.trim());
                if (parts.length >= 4) {
                  [word, meaning, example, exampleMeaning] = parts;
                } else if (parts.length === 3) {
                  [word, meaning, example] = parts;
                  exampleMeaning = '';
                }
              } else if (line.includes('\t')) {
                // Tab åˆ†éš”æ ¼å¼ï¼šword\tmeaning\texample\texampleMeaning
                const parts = line.split('\t').map(s => s.trim());
                if (parts.length >= 4) {
                  [word, meaning, example, exampleMeaning] = parts;
                } else if (parts.length === 3) {
                  [word, meaning, example] = parts;
                  exampleMeaning = '';
                }
              } else if (line.includes(' ')) {
                // ç©ºæ ¼åˆ†éš”æ ¼å¼ï¼šword meaning example exampleMeaning
                const parts = line.split(' ');
                if (parts.length >= 4) {
                  word = parts[0];
                  meaning = parts[1];
                  example = parts[2];
                  exampleMeaning = parts.slice(3).join(' ');
                } else if (parts.length === 3) {
                  word = parts[0];
                  meaning = parts[1];
                  example = parts[2];
                  exampleMeaning = '';
                }
              }
              
              // å¦‚æœæˆåŠŸè§£æä¸”å¿…è¦æ¬„ä½éƒ½æœ‰å€¼ï¼Œå‰‡æ–°å¢å–®å­—
              if (word && meaning && example) {
                // æª¢æŸ¥æ˜¯å¦é‡è¤‡ï¼ˆä¸åˆ†å¤§å°å¯«ï¼‰
                if (!existingWords.has(word.toLowerCase())) {
                  vocab.push({ 
                    word: word, 
                    meaning: meaning, 
                    example: example, 
                    exampleMeaning: exampleMeaning || '' 
                  });
                  // å°‡æ–°å–®å­—åŠ å…¥ Setï¼Œä»¥è™•ç†æª”æ¡ˆå…§çš„é‡è¤‡
                  existingWords.add(word.toLowerCase());
                  importedCount++;
                } else {
                  duplicateCount++;
                }
              } else {
                skippedCount++;
              }
            }
            
            // æ›´æ–°é€²åº¦
            const progress = Math.min(endIndex, totalLines);
            const progressPercent = (progress / totalLines) * 100;
            document.getElementById('importProgress').textContent = progress;
            document.getElementById('progressBar').style.width = progressPercent + '%';
            
            // å¦‚æœé‚„æœ‰æ›´å¤šè¡Œè¦è™•ç†ï¼Œç¹¼çºŒæ‰¹æ¬¡è™•ç†
            if (endIndex < totalLines) {
              document.getElementById('importStatus').textContent = `æ­£åœ¨è™•ç†ç¬¬ ${progress} è¡Œ...`;
              setTimeout(() => processBatch(endIndex), 10); // çŸ­æš«å»¶é²é¿å…é˜»å¡UI
            } else {
              // å®Œæˆè™•ç†
              document.getElementById('importStatus').textContent = 'æ­£åœ¨å„²å­˜è³‡æ–™...';
              
              setTimeout(() => {
                saveVocab();
                displayWords();
                
                // ç§»é™¤é€²åº¦è¦–çª—
                document.body.removeChild(progressModal);
                
                // é¡¯ç¤ºçµæœ
                let resultMessage = `âœ… æˆåŠŸåŒ¯å…¥ ${importedCount} å€‹å–®å­—`;
                if (duplicateCount > 0) {
                  resultMessage += `\nğŸ”„ å·²å¿½ç•¥ ${duplicateCount} å€‹é‡è¤‡å–®å­—`;
                }
                if (skippedCount > 0) {
                  resultMessage += `\nâš ï¸ å·²è·³é ${skippedCount} å€‹ç„¡æ•ˆè¡Œ`;
                }
                alert(resultMessage);
                
                // åŒ¯å…¥æˆåŠŸå¾Œæ¸…ç©ºæœå°‹æ¡†
                clearSearch();
              }, 100);
            }
          };
          
          // é–‹å§‹æ‰¹æ¬¡è™•ç†
          processBatch(0);
        })
        .catch(error => {
          console.error('æª”æ¡ˆè®€å–å¤±æ•—:', error);
          document.body.removeChild(progressModal);
          alert('âŒ æª”æ¡ˆè®€å–å¤±æ•—ï¼Œè«‹æª¢æŸ¥æª”æ¡ˆæ ¼å¼æˆ–ç·¨ç¢¼');
        });
    }

    function exportCSV() {
      if (vocab.length === 0) return alert('ç›®å‰æ²’æœ‰å¯åŒ¯å‡ºçš„å–®å­—ã€‚');
      const csvContent = vocab.map(v => `${v.word},${v.meaning},${v.example},${v.exampleMeaning || ''}`).join('\n');
      const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
      const link = document.createElement('a');
      link.href = URL.createObjectURL(blob);
      link.download = `${bookName}.csv`;
      link.click();
    }

    /*----------------------------------------
      (4) ç™¼éŸ³åŠŸèƒ½
    ----------------------------------------*/
    function pronounceWord(text) {
      if (!('speechSynthesis' in window)) {
        return alert('æ­¤ç€è¦½å™¨ä¸æ”¯æ´ç™¼éŸ³åŠŸèƒ½');
      }
      
      // ä½¿ç”¨æ–°çš„ç™¼éŸ³ç³»çµ±
      SoundSystem.speech.speakWord(text);
    }

    function pronounceSentence(text) {
      if (!('speechSynthesis' in window)) {
        return alert('æ­¤ç€è¦½å™¨ä¸æ”¯æ´ç™¼éŸ³åŠŸèƒ½');
      }
      
      // ä½¿ç”¨æ–°çš„ç™¼éŸ³ç³»çµ±
      SoundSystem.speech.speakSentence(text);
    }

    /*----------------------------------------
      (5) éŠæˆ²é¸å–® modal é‚è¼¯
    ----------------------------------------*/
    function openGameModal() {
      document.getElementById('gameModal').style.display = 'flex';
    }
    function closeGameModal() {
      document.getElementById('gameModal').style.display = 'none';
    }

    function startSpelling() {
      // è·³è½‰åˆ°æ‹¼å­—éŠæˆ²
      window.location.href = `spelling.html?book=${encodeURIComponent(bookName)}`;
    }
    function startMatching() {
      // è·³è½‰åˆ°é…å°éŠæˆ²
      window.location.href = `flipcard_practice.html?book=${encodeURIComponent(bookName)}`;
    }
    function startTimeChallenge() {
      // è·³è½‰åˆ°é™æ™‚ç­”é¡Œ
      window.location.href = `time_challenge.html?book=${encodeURIComponent(bookName)}`;
    }

    function startQuiz(mode) {
      // è·³è½‰åˆ°å–®å­—é¸æ“‡é¡Œ
      window.location.href = `quiz_game.html?book=${encodeURIComponent(bookName)}&mode=${mode}`;
    }

    /*----------------------------------------
      (6) åˆå§‹åŒ–
    ----------------------------------------*/
    window.addEventListener('load', () => {
      updateStarsDisplay();
      initCanvas();
      animate();
      displayWords();
      
      // åˆå§‹åŒ–èªéŸ³ç³»çµ±
      if ('speechSynthesis' in window) {
        // ç­‰å¾…èªéŸ³è¼‰å…¥å®Œæˆ
        window.speechSynthesis.onvoiceschanged = () => {
          console.log('èªéŸ³ç³»çµ±å·²è¼‰å…¥');
        };
      }
    });
  </script>
</body>
</html>
