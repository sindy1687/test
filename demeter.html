<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <title>å¡«ç©ºæŒ‘æˆ° - è‹±æ‰“å°è‹±é›„</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="responsive_enhanced.css">
  <style>
    /* é˜²æ­¢æ°´å¹³æ»¾å‹• */
    html {
      overflow-x: hidden;
    }
    
    /* ç¢ºä¿æ‰€æœ‰å…ƒç´ éƒ½åœ¨è¦–çª—ç¯„åœå…§ */
    * {
      box-sizing: border-box;
      max-width: 100%;
    }
    
    /* ===== åŸºç¤æ¨£å¼ ===== */
    body {
      margin: 0;
      padding: 0;
      font-family: 'Segoe UI', Arial, sans-serif, 'Orbitron', sans-serif;
      background: linear-gradient(135deg, #232526 0%, #414345 100%);
      color: #fff;
      text-align: center;
      padding: 20px;
      min-height: 100vh;
      width: 100%;
      overflow-x: hidden;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }

    h1 {
      color: #ffd700;
      text-shadow: 0 0 8px #ffd700;
      margin-bottom: 20px;
      letter-spacing: 2px;
      font-family: 'Orbitron', Arial, sans-serif;
      font-size: 2.2rem;
    }

    /* ===== æŒ‰éˆ•æ¨£å¼ ===== */
    .top-btns {
      position: fixed;
      top: 20px;
      right: 20px;
      left: auto;
      display: flex;
      gap: 8px;
      z-index: 11;
    }

    .top-btns button {
      padding: 6px 12px;
      font-size: 1rem;
      background: #ffd700;
      color: #000;
      border: none;
      border-radius: 12px;
      cursor: pointer;
      box-shadow: 0 0 6px rgba(255, 215, 0, 0.2);
      font-family: 'Orbitron', Arial, sans-serif;
      transition: background 0.2s;
    }

    .top-btns button:hover {
      background: #ffe54f;
    }

    button {
      font-size: 1rem;
      padding: 10px 26px;
      border: none;
      border-radius: 12px;
      cursor: pointer;
      transition: background 0.2s;
      box-shadow: 0 2px 8px #0003;
      font-family: 'Orbitron', Arial, sans-serif;
    }

    #submit-btn {
      background: #ffd700;
      color: #111;
    }

    #submit-btn:disabled {
      background: #ccc;
      color: #888;
      cursor: not-allowed;
    }

    #skip-btn {
      background: #bbb;
      color: #222;
    }

    #skip-btn:hover {
      background: #ccc;
    }

    #speak-btn {
      background: #0ff;
      color: #111;
      margin-top: 10px;
    }

    #speak-btn:disabled {
      background: #555;
      color: #888;
    }

    #speak-btn:hover {
      background: #7ff;
    }

    #next-btn {
      background: #4caf50;
      color: #fff;
      margin-top: 10px;
    }

    #next-btn:hover {
      background: #6fdc7f;
    }

    /* ===== é¡¯ç¤ºå€å¡Šæ¨£å¼ ===== */
    #star-counter {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 18px;
      background: rgba(30, 30, 40, 0.92);
      border-radius: 18px;
      box-shadow: 0 4px 18px 0 rgba(31, 38, 135, 0.18);
      padding: 14px 32px;
      margin-bottom: 18px;
      border: 1.5px solid #ffd70044;
      font-size: 1.18rem;
      color: #ffd700;
      min-width: 260px;
      font-family: 'Orbitron', Arial, sans-serif;
    }

    #starsDisplay {
      position: fixed;
      top: 20px;
      left: 20px;
      background: rgba(10, 20, 40, 0.85);
      padding: 8px 14px;
      border-radius: 10px;
      color: #ffd700;
      font-weight: bold;
      box-shadow: 0 0 12px #ffd700, 0 0 32px #00ffff;
      border: 2px solid #00ffff;
      font-size: 1.2rem;
      z-index: 10;
    }

    #timer {
      font-size: 1.1rem;
      margin-bottom: 16px;
    }

    #timer.hidden {
      display: none;
    }

    /* ===== å•é¡Œå®¹å™¨æ¨£å¼ ===== */
    #question-container {
      background: rgba(30, 30, 40, 0.97);
      border-radius: 22px;
      box-shadow: 0 8px 32px rgba(31, 38, 135, 0.37);
      padding: 38px 30px 30px;
      max-width: 440px;
      width: 100%;
      margin: auto;
      border: 1.5px solid #ffd70044;
      display: flex;
      flex-direction: column;
      align-items: center;
      margin-bottom: 18px;
    }

    .question-title {
      font-size: 1.1rem;
      margin-bottom: 8px;
      letter-spacing: 1px;
    }

    .question-sentence {
      font-size: 1.7rem;
      font-weight: bold;
      margin: 10px 0 20px 0;
      line-height: 1.5;
      word-break: break-word;
    }

    .question-sentence .blank {
      color: #0ff;
      background: #fff2;
      border-radius: 8px;
      padding: 2px 16px;
      box-shadow: 0 1px 4px #0ff2;
    }

    .question-zh {
      color: #ffd700;
      margin-bottom: 16px;
      font-size: 1.08rem;
    }

    /* ===== è¼¸å…¥æ¡†æ¨£å¼ ===== */
    input {
      width: 92%;
      padding: 15px;
      font-size: 1.15rem;
      border: 2px solid #ffd700;
      border-radius: 14px;
      background: #222;
      color: #fff;
      margin-bottom: 22px;
      box-shadow: 0 2px 8px #0003;
      outline: none;
      transition: border 0.2s;
    }

    input:focus {
      border-color: #0ff;
    }

    /* ===== æŒ‰éˆ•åˆ—æ¨£å¼ ===== */
    .btn-row {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin-bottom: 14px;
      width: 100%;
    }

    /* ===== åé¥‹æ¨£å¼ ===== */
    #feedback {
      margin-top: 12px;
      font-size: 1.13rem;
      min-height: 28px;
    }

    .feedback-box {
      display: inline-block;
      padding: 10px 22px;
      border-radius: 16px;
      font-size: 1.18rem;
      font-weight: bold;
      box-shadow: 0 2px 16px #0004;
      margin-top: 8px;
      transition: background 0.3s, color 0.3s, transform 0.2s;
      animation: popfade 0.7s cubic-bezier(.68, -0.55, .27, 1.55);
    }

    .feedback-correct {
      background: linear-gradient(90deg, #2ecc40, #bfff00);
      color: #222;
    }

    .feedback-wrong {
      background: linear-gradient(90deg, #ff4f4f, #ffbaba);
      color: #fff;
    }

    .feedback-bonus {
      color: #ffd700;
      animation: bonusflash 1s infinite alternate;
      font-size: 1.25em;
    }

    /* ===== å‹•ç•«æ•ˆæœ ===== */
    .complete-anim {
      animation: pop 0.7s cubic-bezier(.68, -0.55, .27, 1.55) both;
    }

    @keyframes pop {
      0% {
        transform: scale(0.7);
        opacity: 0;
      }
      60% {
        transform: scale(1.15);
        opacity: 1;
      }
      100% {
        transform: scale(1);
      }
    }

    @keyframes popfade {
      0% {
        transform: scale(0.7);
        opacity: 0;
      }
      60% {
        transform: scale(1.15);
        opacity: 1;
      }
      100% {
        transform: scale(1);
      }
    }

    @keyframes bonusflash {
      0% {
        text-shadow: 0 0 8px #ffd700;
      }
      100% {
        text-shadow: 0 0 24px #fff700;
      }
    }

    /* ===== éŸ¿æ‡‰å¼è¨­è¨ˆå„ªåŒ– ===== */
    @media (max-width: 768px) {
      .top-btns {
        position: fixed;
        top: 10px;
        right: 10px;
        left: auto;
        display: flex;
        gap: 6px;
        z-index: 11;
        flex-wrap: wrap;
        justify-content: flex-end;
      }
      
      .top-btns button {
        padding: 4px 8px;
        font-size: 0.9rem;
      }
      
      #starsDisplay {
        top: 10px;
        left: 10px;
        padding: 6px 10px;
        font-size: 1rem;
      }
      
      h1 {
        font-size: 1.8rem;
        margin-top: 60px;
      }
      
      #question-container {
        max-width: 95vw;
        padding: 20px 15px;
        margin: 10px auto;
      }
      
      .question-sentence {
        font-size: 1.3rem;
      }
      
      .modal-content {
        padding: 20px;
        margin: 10px;
        max-width: 95vw;
      }
      
      .end-buttons {
        flex-direction: column;
        gap: 10px;
      }
      
      .end-buttons button {
        width: 100%;
        padding: 10px;
      }
    }

    @media (max-width: 480px) {
      body {
        padding: 10px;
      }
      
      .top-btns {
        position: relative;
        top: auto;
        right: auto;
        left: auto;
        justify-content: center;
        margin-bottom: 15px;
      }
      
      #starsDisplay {
        position: relative;
        top: auto;
        left: auto;
        display: inline-block;
        margin-bottom: 10px;
      }
      
      h1 {
        font-size: 1.5rem;
        margin-top: 10px;
      }
      
      #sessionStarsDisplay {
        font-size: 1rem;
        margin-bottom: 8px;
      }
      
      #star-counter {
        font-size: 1rem;
        padding: 10px 20px;
        min-width: 200px;
      }
      
      .question-sentence {
        font-size: 1.1rem;
      }
      
      input {
        font-size: 1rem;
        padding: 12px;
      }
      
      .btn-row {
        flex-direction: column;
        gap: 10px;
      }
      
      .btn-row button {
        width: 100%;
        padding: 12px;
      }
    }

    /* ===== éŠæˆ²çµæŸç•«é¢æ¨£å¼ ===== */
    .modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.8);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 1000;
      backdrop-filter: blur(4px);
    }

    .modal-content {
      background: rgba(30, 30, 40, 0.95);
      border: 2px solid #ffd700;
      border-radius: 20px;
      padding: 40px;
      text-align: center;
      max-width: 500px;
      width: 90%;
      box-shadow: 0 0 32px #ffd70044, 0 0 80px #00ffff22 inset;
      animation: modalPop 0.5s cubic-bezier(.68, -0.55, .27, 1.55);
    }

    .end-icon {
      font-size: 4rem;
      margin-bottom: 20px;
      animation: tada 1.2s infinite;
    }

    .modal-content h2 {
      color: #ffd700;
      font-size: 2rem;
      margin-bottom: 25px;
      text-shadow: 0 0 12px #ffd700;
      font-family: 'Orbitron', Arial, sans-serif;
    }

    .end-stats {
      margin-bottom: 30px;
    }

    .end-stats p {
      font-size: 1.2rem;
      margin: 10px 0;
      color: #fff;
    }

    .end-stats span {
      color: #ffd700;
      font-weight: bold;
    }

    .end-buttons {
      display: flex;
      gap: 15px;
      justify-content: center;
      flex-wrap: wrap;
    }

    .end-buttons button {
      background: linear-gradient(90deg, #ffd700, #ffed4e);
      color: #000;
      border: none;
      border-radius: 12px;
      padding: 12px 24px;
      font-size: 1.1rem;
      font-weight: bold;
      cursor: pointer;
      transition: transform 0.2s, box-shadow 0.2s;
      font-family: 'Orbitron', Arial, sans-serif;
    }

    .end-buttons button:hover {
      transform: scale(1.05);
      box-shadow: 0 0 16px #ffd700;
    }

    @keyframes modalPop {
      0% {
        transform: scale(0.7);
        opacity: 0;
      }
      60% {
        transform: scale(1.1);
        opacity: 1;
      }
      100% {
        transform: scale(1);
      }
    }

    @keyframes tada {
      0% { transform: scale(1); }
      10%, 20% { transform: scale(0.9) rotate(-3deg); }
      30%, 50%, 70%, 90% { transform: scale(1.1) rotate(3deg); }
      40%, 60%, 80% { transform: scale(1.1) rotate(-3deg); }
      100% { transform: scale(1) rotate(0); }
    }
  </style>
</head>
<body>
  <!-- èƒŒæ™¯éŸ³æ¨‚æ§åˆ¶æŒ‰éˆ• -->
  <button id="bgMusicControl" onclick="toggleBackgroundMusic()" title="èƒŒæ™¯éŸ³æ¨‚æ§åˆ¶">ğŸµ</button>

  <!-- æ˜Ÿæ˜Ÿæ•¸é¡¯ç¤ºå€å¡Š -->
  <div id="starsDisplay">
    â­<span id="totalStarsCount">0</span>
  </div>

  <!-- é ‚éƒ¨æŒ‰éˆ• -->
  <div class="top-btns">
    <button onclick="location.href='atlas.html?tab=greek'" aria-label="å›é¦–é ">ğŸ  å›é¦–é </button>
    <button onclick="resetProgress()" aria-label="é‡æ–°é–‹å§‹">ğŸ”„ é‡æ–°é–‹å§‹</button>
    <button onclick="showReviewModal()" aria-label="è¤‡ç¿’å–®å­—">ğŸ“š è¤‡ç¿’å–®å­—</button>
  </div>

  <h1>å¾—å¢¨å¿’è€³ Demeter - å¡«ç©ºæŒ‘æˆ°</h1>

  <!-- æœ¬æ¬¡æ˜Ÿæ˜Ÿé¡¯ç¤º -->
  <div id="sessionStarsDisplay" style="margin-bottom:10px;color:#ffd700;font-weight:bold;font-size:1.08rem;">
    æœ¬æ¬¡å·²ç²å¾— 0 é¡†æ˜Ÿæ˜Ÿ
  </div>

  <!-- é€²åº¦é¡¯ç¤º -->
  <div id="star-counter">
    ç¬¬ <span id="current-index">0</span> / <span id="total-questions">0</span> é¡Œ
  </div>

  <!-- è¨ˆæ™‚å™¨ -->
  <div id="timer" class="hidden">
    â³ å€’æ•¸ï¼š<span id="time-left">0</span> ç§’
  </div>

  <!-- å•é¡Œå®¹å™¨ -->
  <div id="question-container"></div>

  <!-- éŠæˆ²çµæŸç•«é¢ -->
  <div id="gameEndModal" class="modal" style="display: none;">
    <div class="modal-content">
      <div class="end-icon">ğŸ‰</div>
      <h2>éŠæˆ²å®Œæˆï¼</h2>
      <div class="end-stats">
        <p>â­ æœ¬æ¬¡ç²å¾—æ˜Ÿæ˜Ÿï¼š<span id="endSessionStars">0</span></p>
        <p>âœ… ç­”å°é¡Œæ•¸ï¼š<span id="endCorrectCount">0</span></p>
        <p>âŒ ç­”éŒ¯é¡Œæ•¸ï¼š<span id="endWrongCount">0</span></p>
        <p>â­ ç´¯ç©ç¸½æ˜Ÿæ˜Ÿï¼š<span id="endTotalStars">0</span></p>
      </div>
      <div class="end-buttons">
        <button onclick="restartGame()">ğŸ”„ é‡æ–°é–‹å§‹</button>
        <button onclick="location.href='atlas.html?tab=greek'">ğŸ  è¿”å›é¦–é </button>
      </div>
    </div>
  </div>

  <!-- è¤‡ç¿’å–®å­—å½ˆçª— -->
  <div id="reviewModal" class="modal" style="display: none;">
    <div class="modal-content">
      <div class="end-icon">ğŸ“š</div>
      <h2>å–®å­—è¤‡ç¿’</h2>
      <div id="reviewWordsContainer" style="max-height: 400px; overflow-y: auto; margin: 20px 0;">
        <!-- å–®å­—åˆ—è¡¨å°‡åœ¨é€™è£¡å‹•æ…‹ç”Ÿæˆ -->
      </div>
      <div class="end-buttons">
        <button onclick="closeReviewModal()">é—œé–‰</button>
      </div>
    </div>
  </div>

  <script>
    // ===== éŠæˆ²é…ç½® =====
    const GAME_CONFIG = {
      QUESTIONS_COUNT: 20,
      TIME_LIMIT: 30,
      MAX_ATTEMPTS: 3
    };

    // ===== é¡Œåº«è³‡æ–™ =====
    const VOCAB_DATA = [
      {
        "word": "twice",
        "zh": "å…©æ¬¡",
        "en_sentence": "He has visited Japan twice.",
        "zh_sentence": "ä»–å»éæ—¥æœ¬å…©æ¬¡ã€‚"
      },
      {
        "word": "of",
        "zh": "â€¦çš„",
        "en_sentence": "This is a photo of my family.",
        "zh_sentence": "é€™æ˜¯ä¸€å¼µæˆ‘å®¶äººçš„ç…§ç‰‡ã€‚"
      },
      {
        "word": "place",
        "zh": "ä½è™•ï¼›åœ°æ–¹",
        "en_sentence": "This park is a nice place to relax.",
        "zh_sentence": "é€™å€‹å…¬åœ’æ˜¯å€‹å¾ˆæ£’çš„æ”¾é¬†åœ°æ–¹ã€‚"
      },
      {
        "word": "road",
        "zh": "é“è·¯",
        "en_sentence": "The road to school is crowded in the morning.",
        "zh_sentence": "æ—©ä¸Šä¸Šå­¸çš„é“è·¯å¾ˆæ“æ“ ã€‚"
      },
      {
        "word": "temple",
        "zh": "å¯ºå»Ÿ",
        "en_sentence": "We visit the temple during the festival.",
        "zh_sentence": "æˆ‘å€‘åœ¨ç¯€æ—¥æœŸé–“åƒè§€å¯ºå»Ÿã€‚"
      },
      {
        "word": "museum",
        "zh": "åšç‰©é¤¨",
        "en_sentence": "The museum has ancient artifacts.",
        "zh_sentence": "åšç‰©é¤¨è£¡æœ‰å¤ä»£æ–‡ç‰©ã€‚"
      },
      {
        "word": "hotel",
        "zh": "æ—…é¤¨ï¼›é£¯åº—",
        "en_sentence": "We stay at a hotel near the beach.",
        "zh_sentence": "æˆ‘å€‘ä½åœ¨æµ·ç˜é™„è¿‘çš„é£¯åº—ã€‚"
      },
      {
        "word": "season",
        "zh": "å­£ç¯€",
        "en_sentence": "Spring is my favorite season.",
        "zh_sentence": "æ˜¥å¤©æ˜¯æˆ‘æœ€å–œæ­¡çš„å­£ç¯€ã€‚"
      },
      {
        "word": "high",
        "zh": "é«˜çš„",
        "en_sentence": "That building is very high.",
        "zh_sentence": "é‚£æ£Ÿå»ºç¯‰ç‰©éå¸¸é«˜ã€‚"
      },
      {
        "word": "autumn",
        "zh": "ç§‹å­£ï¼›ç§‹å¤©",
        "en_sentence": "Leaves change color in autumn.",
        "zh_sentence": "è‘‰å­åœ¨ç§‹å¤©è®Šè‰²ã€‚"
      },
      {
        "word": "snow",
        "zh": "é›ªï¼›ä¸‹é›ª",
        "en_sentence": "It may snow tomorrow.",
        "zh_sentence": "æ˜å¤©å¯èƒ½æœƒä¸‹é›ªã€‚"
      },
      {
        "word": "snowman",
        "zh": "é›ªäºº",
        "en_sentence": "We built a snowman in the yard.",
        "zh_sentence": "æˆ‘å€‘åœ¨é™¢å­è£¡å †äº†é›ªäººã€‚"
      },
      {
        "word": "plan",
        "zh": "è¨ˆç•«",
        "en_sentence": "I have a plan to study abroad next year.",
        "zh_sentence": "æˆ‘è¨ˆç•«æ˜å¹´å‡ºåœ‹ç•™å­¸ã€‚"
      },
      {
        "word": "date",
        "zh": "æ—¥æœŸ",
        "en_sentence": "What is the date today?",
        "zh_sentence": "ä»Šå¤©çš„æ—¥æœŸæ˜¯ä»€éº¼ï¼Ÿ"
      },
      {
        "word": "Father's Day",
        "zh": "çˆ¶è¦ªç¯€",
        "en_sentence": "We give gifts on Father's Day.",
        "zh_sentence": "æˆ‘å€‘åœ¨çˆ¶è¦ªç¯€é€ç¦®ç‰©ã€‚"
      },
      {
        "word": "USA",
        "zh": "ç¾åœ‹",
        "en_sentence": "He hopes to study in the USA.",
        "zh_sentence": "ä»–å¸Œæœ›åˆ°ç¾åœ‹å¿µæ›¸ã€‚"
      },
      {
        "word": "photo",
        "zh": "ç…§ç‰‡",
        "en_sentence": "She took a photo of the sunset.",
        "zh_sentence": "å¥¹æ‹äº†ä¸€å¼µæ—¥è½çš„ç…§ç‰‡ã€‚"
      },
      {
        "word": "mind",
        "zh": "å¿ƒæ™ºï¼›ä»‹æ„",
        "en_sentence": "Mind your manners at the dinner table.",
        "zh_sentence": "åœ¨é¤æ¡Œä¸Šè¦æ³¨æ„ç¦®è²Œã€‚"
      },
      {
        "word": "work",
        "zh": "ä½œå“ï¼›å·¥ä½œ",
        "en_sentence": "I finish my work before dinner.",
        "zh_sentence": "æˆ‘åœ¨æ™šé¤å‰å®Œæˆå·¥ä½œã€‚"
      },
      {
        "word": "exercise",
        "zh": "é‹å‹•",
        "en_sentence": "We do exercise every morning.",
        "zh_sentence": "æˆ‘å€‘æ¯å¤©æ—©ä¸Šåšé‹å‹•ã€‚"
      },
      {
        "word": "turtle",
        "zh": "æµ·é¾œ",
        "en_sentence": "The turtle swims slowly in the pond.",
        "zh_sentence": "æµ·é¾œåœ¨æ± å¡˜è£¡æ…¢æ…¢æ¸¸æ³³ã€‚"
      },
      {
        "word": "practice",
        "zh": "ç·´ç¿’",
        "en_sentence": "Practice your piano every day.",
        "zh_sentence": "æ¯å¤©ç·´ç¿’å½ˆé‹¼ç´ã€‚"
      },
      {
        "word": "race",
        "zh": "ç«¶è³½",
        "en_sentence": "They will race in the school competition.",
        "zh_sentence": "ä»–å€‘å°‡åƒåŠ å­¸æ ¡çš„ç«¶è³½ã€‚"
      },
      {
        "word": "team",
        "zh": "éšŠ",
        "en_sentence": "Our soccer team won the match.",
        "zh_sentence": "æˆ‘å€‘çš„è¶³çƒéšŠè´å¾—äº†æ¯”è³½ã€‚"
      },
      {
        "word": "problem",
        "zh": "å•é¡Œï¼›æ¯›ç—…",
        "en_sentence": "I need help with this math problem.",
        "zh_sentence": "æˆ‘éœ€è¦äººå¹«æˆ‘è§£é€™å€‹æ•¸å­¸å•é¡Œã€‚"
      },
      {
        "word": "toe",
        "zh": "è…³è¶¾",
        "en_sentence": "I stubbed my toe on the chair.",
        "zh_sentence": "æˆ‘æ’åˆ°æ¤…å­ï¼Œè…³è¶¾å¾ˆç—›ã€‚"
      },
      {
        "word": "kind",
        "zh": "ç¨®é¡",
        "en_sentence": "There are many kinds of flowers here.",
        "zh_sentence": "é€™è£¡æœ‰å¾ˆå¤šç¨®é¡çš„èŠ±ã€‚"
      },
      {
        "word": "violin",
        "zh": "å°æç´",
        "en_sentence": "She plays the violin beautifully.",
        "zh_sentence": "å¥¹å°æç´æ‹‰å¾—å¾ˆç¾ã€‚"
      },
      {
        "word": "flute",
        "zh": "é•·ç¬›ï¼›æ©«ç¬›",
        "en_sentence": "He learns to play the flute at school.",
        "zh_sentence": "ä»–åœ¨å­¸æ ¡å­¸ç¿’å¹é•·ç¬›ã€‚"
      },
      {
        "word": "special",
        "zh": "ç‰¹åˆ¥çš„",
        "en_sentence": "Today is a special day for us.",
        "zh_sentence": "ä»Šå¤©å°æˆ‘å€‘ä¾†èªªæ˜¯ç‰¹åˆ¥çš„ä¸€å¤©ã€‚"
      },
      {
        "word": "afraid",
        "zh": "å®³æ€•çš„",
        "en_sentence": "She is afraid of spiders.",
        "zh_sentence": "å¥¹å®³æ€•èœ˜è››ã€‚"
      },
      {
        "word": "same",
        "zh": "ç›¸åŒçš„",
        "en_sentence": "We have the same shoes.",
        "zh_sentence": "æˆ‘å€‘æœ‰ç›¸åŒçš„é‹å­ã€‚"
      },
      {
        "word": "different",
        "zh": "ä¸åŒçš„",
        "en_sentence": "They like different kinds of music.",
        "zh_sentence": "ä»–å€‘å–œæ­¡ä¸åŒç¨®é¡çš„éŸ³æ¨‚ã€‚"
      },
      {
        "word": "snowy",
        "zh": "ä¸‹é›ªçš„",
        "en_sentence": "It is snowy outside today.",
        "zh_sentence": "ä»Šå¤©å¤–é¢æ­£åœ¨ä¸‹é›ªã€‚"
      },
      {
        "word": "dry",
        "zh": "ä¹¾çš„ï¼›å¼„ä¹¾",
        "en_sentence": "Hang your clothes to dry in the sun.",
        "zh_sentence": "æŠŠè¡£æœæ›åˆ°å¤ªé™½ä¸‹æ›¬ä¹¾ã€‚"
      },
      {
        "word": "wet",
        "zh": "æ¿•çš„",
        "en_sentence": "My shoes got wet in the rain.",
        "zh_sentence": "æˆ‘çš„é‹å­åœ¨ä¸‹é›¨æ™‚æ¿•äº†ã€‚"
      },
      {
        "word": "popular",
        "zh": "å—æ­¡è¿çš„",
        "en_sentence": "That movie is very popular with students.",
        "zh_sentence": "é‚£éƒ¨é›»å½±åœ¨å­¸ç”Ÿé–“éå¸¸å—æ­¡è¿ã€‚"
      },
      {
        "word": "dark",
        "zh": "æš—çš„",
        "en_sentence": "It gets dark early in winter.",
        "zh_sentence": "å†¬å¤©å¤©é»‘å¾—å¾ˆæ—©ã€‚"
      },
      {
        "word": "know",
        "zh": "çŸ¥é“ï¼›èªè­˜",
        "en_sentence": "Do you know how to solve this?",
        "zh_sentence": "ä½ çŸ¥é“å¦‚ä½•è§£æ±ºé€™å€‹å—ï¼Ÿ"
      },
      {
        "word": "keep",
        "zh": "ä¿æŒï¼›ä¸€ç›´",
        "en_sentence": "Please keep the room tidy.",
        "zh_sentence": "è«‹ä¿æŒæˆ¿é–“æ•´æ½”ã€‚"
      },
      {
        "word": "join",
        "zh": "åƒåŠ ï¼›åŠ å…¥",
        "en_sentence": "I want to join the art club.",
        "zh_sentence": "æˆ‘æƒ³åŠ å…¥ç¾è¡“ç¤¾åœ˜ã€‚"
      },
      {
        "word": "throw",
        "zh": "ä¸Ÿ",
        "en_sentence": "Throw the ball to me.",
        "zh_sentence": "æŠŠçƒä¸Ÿçµ¦æˆ‘ã€‚"
      },
      {
        "word": "hit",
        "zh": "æ‰“æ“Šï¼›æˆåŠŸè€Œé¢¨è¡Œä¸€æ™‚çš„äº‹ç‰©",
        "en_sentence": "He can hit the baseball far.",
        "zh_sentence": "ä»–èƒ½æŠŠæ£’çƒæ‰“å¾—å¾ˆé ã€‚"
      }
    ];

    // ===== éŠæˆ²ç‹€æ…‹è®Šæ•¸ =====
    let gameState = {
      data: [],
      currentIndex: 0,
      attemptCount: 0,
      answered: false,
      timerInterval: null,
      preferredVoice: null,
      answerLog: [],
      sessionStars: 0
    };

    // ===== éŸ³æ•ˆè³‡æº =====
    const SOUNDS = {
      correct: new Audio('audio/correct.mp3'),
      wrong: new Audio('audio/wrong.mp3'),
      type: new Audio('audio/type.mp3')
    };

    // ===== èƒŒæ™¯éŸ³æ¨‚æ§åˆ¶ =====
    let bgMusic = null;
    let isMusicPlaying = false;

    function initBackgroundMusic() {
      bgMusic = new Audio('sound/åˆå¾Œæ”¾é¬†æ™‚å…‰ï¼ˆç´”éŸ³æ¨‚ï¼‰.mp3');
      bgMusic.loop = true;
      bgMusic.volume = 0.3;
      
      // å¾localStorageè®€å–éŸ³æ¨‚ç‹€æ…‹
      const musicState = localStorage.getItem('bgMusicState');
      if (musicState === 'playing') {
        playBackgroundMusic();
      }
    }

    function toggleBackgroundMusic() {
      if (isMusicPlaying) {
        pauseBackgroundMusic();
      } else {
        playBackgroundMusic();
      }
    }

    function playBackgroundMusic() {
      if (bgMusic) {
        bgMusic.play().then(() => {
          isMusicPlaying = true;
          document.getElementById('bgMusicControl').textContent = 'ğŸ”Š';
          document.getElementById('bgMusicControl').classList.remove('paused');
          localStorage.setItem('bgMusicState', 'playing');
        }).catch(err => {
          console.log('èƒŒæ™¯éŸ³æ¨‚æ’­æ”¾å¤±æ•—:', err);
        });
      }
    }

    function pauseBackgroundMusic() {
      if (bgMusic) {
        bgMusic.pause();
        isMusicPlaying = false;
        document.getElementById('bgMusicControl').textContent = 'ğŸ”‡';
        document.getElementById('bgMusicControl').classList.add('paused');
        localStorage.setItem('bgMusicState', 'paused');
      }
    }

    // ===== å·¥å…·å‡½æ•¸ =====
    function escapeRegExp(s) {
      return s.replace(/[.*+?^${}()|[\\]\\]/g, '\\$&');
    }

    function getRandomQuestions(arr, n) {
      const count = Math.min(n, arr.length);
      return arr.slice().sort(() => Math.random() - 0.5).slice(0, count);
    }

    // ===== è³‡æ–™åˆå§‹åŒ– =====
    function initData() {
      const selected = getRandomQuestions(VOCAB_DATA, GAME_CONFIG.QUESTIONS_COUNT);
      gameState.data = selected.map(item => ({
        answer: item.word,
        zh: item.zh,
        sentence: item.en_sentence.replace(new RegExp(escapeRegExp(item.word), 'i'), '___'),
        original: item.en_sentence,
        zh_sentence: item.zh_sentence
      }));
      document.getElementById('total-questions').textContent = gameState.data.length;
    }

    // ===== é€²åº¦ç®¡ç† =====
    function saveProgress() {
      localStorage.setItem('fillIndex', gameState.currentIndex);
    }

    function loadProgress() {
      gameState.currentIndex = parseInt(localStorage.getItem('fillIndex')) || 0;
      if (typeof gameState.data !== 'undefined' && Array.isArray(gameState.data) && gameState.currentIndex >= gameState.data.length) {
        gameState.currentIndex = 0;
        localStorage.removeItem('fillIndex');
      }
    }

    function resetProgress() {
      localStorage.removeItem('fillIndex');
      location.reload();
    }

    function updateCounter() {
      document.getElementById('current-index').textContent = gameState.currentIndex + 1;
    }

    // ===== è¨ˆæ™‚å™¨åŠŸèƒ½ =====
    function startTimer() {
      clearInterval(gameState.timerInterval);
      let timeLeft = GAME_CONFIG.TIME_LIMIT;
      document.getElementById('time-left').textContent = timeLeft;
      document.getElementById('timer').classList.remove('hidden');
      
      gameState.timerInterval = setInterval(() => {
        timeLeft--;
        document.getElementById('time-left').textContent = timeLeft;
        if (timeLeft <= 0) {
          clearInterval(gameState.timerInterval);
          revealAnswer(true);
        }
      }, 1000);
    }

    function stopTimer() {
      clearInterval(gameState.timerInterval);
    }

    // ===== èªéŸ³åŠŸèƒ½ =====
    function pickVoice() {
      const voices = window.speechSynthesis.getVoices();
      const prefer = [
        'Google US English', 'Microsoft Aria Online', 'Microsoft Jenny Online', 
        'Samantha', 'Jenny', 'Aria', 'en-US'
      ];
      gameState.preferredVoice = voices.find(v => prefer.some(p => v.name.includes(p))) || 
                                 voices.find(v => v.lang === 'en-US') || voices[0];
    }

    function speak(text, rate = 1.0, callback) {
      if (!window.speechSynthesis) return;
      
      const utter = new window.SpeechSynthesisUtterance(text);
      utter.lang = 'en-US';
      utter.rate = rate;
      utter.pitch = 1.12;
      if (gameState.preferredVoice) utter.voice = gameState.preferredVoice;
      if (callback) utter.onend = callback;
      
      window.speechSynthesis.cancel();
      window.speechSynthesis.speak(utter);
    }

    function speakQuestionAndWord(question) {
      window.speechSynthesis.cancel();
      speak(question.original, 0.97, function() {
        setTimeout(() => {
          speak(question.original.replace(new RegExp(escapeRegExp(question.answer), 'i'), '...'), 1.02, function() {
            setTimeout(() => speak(question.answer, 1.08), 350);
          });
        }, 350);
      });
    }

    // ===== ç­”æ¡ˆè™•ç† =====
    function revealAnswer(autoNext = false) {
      gameState.attemptCount = Infinity;
      document.getElementById('feedback').innerHTML = 
        `<span style='color:#f66;'>â° æ™‚é–“åˆ°ï¼æ­£ç¢ºç­”æ¡ˆï¼š<b>${gameState.data[gameState.currentIndex].answer}</b></span>`;
      document.getElementById('submit-btn').disabled = true;
      document.getElementById('user-input').disabled = true;
      
      logAnswer(false);
      
      if (autoNext) {
        setTimeout(() => {
          gameState.currentIndex++;
          showQuestion();
        }, 500);
      }
    }

    function logAnswer(correct, userAnswer = '') {
      const currentQuestion = gameState.data[gameState.currentIndex];
      gameState.answerLog[gameState.currentIndex] = {
        word: currentQuestion.answer,
        zh: currentQuestion.zh_sentence || currentQuestion.zh,
        en: currentQuestion.original,
        user: userAnswer,
        correct: correct,
        stars: 0
      };
    }

    // ===== å•é¡Œé¡¯ç¤º =====
    function showQuestion() {
      if (!gameState.data || !Array.isArray(gameState.data) || gameState.data.length === 0) {
        document.getElementById('question-container').innerHTML = 
          '<div style="color:#f66;font-size:1.2rem;">âš ï¸ é¡Œåº«æ²’æœ‰é¡Œç›®ï¼Œè«‹æª¢æŸ¥è³‡æ–™ï¼</div>';
        return;
      }

      if (gameState.currentIndex < 0 || gameState.currentIndex >= gameState.data.length) {
        // éŠæˆ²çµæŸï¼Œé¡¯ç¤ºçµæŸç•«é¢
        showGameEndScreen();
        return;
      }

      gameState.answered = false;
      gameState.attemptCount = 0;
      const question = gameState.data[gameState.currentIndex];

      document.getElementById('question-container').innerHTML = `
        <div class="question-title">è‹±æ–‡å¥å­ï¼š</div>
        <div class="question-sentence">${question.sentence.replace('___', '<span class="blank">___</span>')}</div>
        <div class="question-zh">ä¸­æ–‡æç¤ºï¼š${question.zh_sentence || question.zh}</div>
        <input id="user-input" placeholder="è¼¸å…¥ç­”æ¡ˆâ€¦" autocomplete="off" />
        <div class="btn-row">
          <button id="submit-btn" onclick="checkAnswer()">é€å‡º</button>
          <button id="skip-btn" onclick="skipQuestion()">è·³é</button>
          <button id="next-btn" onclick="nextQuestion()">ä¸‹ä¸€é¡Œ</button>
        </div>
        <div id="feedback"></div>
        <button id="speak-btn" onclick="speakQuestionAndWord(question)">ğŸ”Š æœ—è®€</button>
      `;

      const inputEl = document.getElementById('user-input');
      inputEl.focus();
      inputEl.onkeydown = function(e) {
        if (e.key === 'Enter') {
          checkAnswer();
        } else if (e.key.length === 1) {
          try {
            SOUNDS.type.currentTime = 0;
            SOUNDS.type.play();
          } catch (e) {}
        }
      };

      updateCounter();
      startTimer();
      
      setTimeout(() => {
        speak(question.original, 0.97);
      }, 400);

      document.getElementById('speak-btn').onclick = () => speakQuestionAndWord(question);
      window.answerStartTime = Date.now();
      
      // é–å®šè¤‡ç¿’æŒ‰éˆ•
      lockReviewButton();
    }

    // ===== è¤‡ç¿’æŒ‰éˆ•é–å®šåŠŸèƒ½ =====
    function lockReviewButton() {
      const reviewBtn = document.querySelector('.top-btns button[onclick*="showReviewModal"]');
      if (reviewBtn) {
        reviewBtn.disabled = true;
        reviewBtn.style.background = '#555';
        reviewBtn.style.color = '#888';
        reviewBtn.style.cursor = 'not-allowed';
        reviewBtn.title = 'éŠæˆ²é€²è¡Œä¸­ï¼Œç„¡æ³•è¤‡ç¿’å–®å­—';
      }
    }

    function unlockReviewButton() {
      const reviewBtn = document.querySelector('.top-btns button[onclick*="showReviewModal"]');
      if (reviewBtn) {
        reviewBtn.disabled = false;
        reviewBtn.style.background = '#ffd700';
        reviewBtn.style.color = '#000';
        reviewBtn.style.cursor = 'pointer';
        reviewBtn.title = 'è¤‡ç¿’å–®å­—';
      }
    }

    // ===== å•é¡Œæ“ä½œ =====
    function skipQuestion() {
      stopTimer();
      logAnswer(null, '');
      const feedback = document.getElementById('feedback');
      if (feedback) feedback.innerHTML = `<span style='color:#bbb;'>å·²è·³éæœ¬é¡Œ</span>`;
      setTimeout(() => {
        gameState.currentIndex++;
        showQuestion();
      }, 400);
    }

    function nextQuestion() {
      stopTimer();
      if (!gameState.answerLog[gameState.currentIndex]) {
        logAnswer(false, document.getElementById('user-input')?.value || '');
        const feedback = document.getElementById('feedback');
        if (feedback) feedback.innerHTML = `<span style='color:#bbb;'>æœªä½œç­”</span>`;
      }
      setTimeout(() => {
        gameState.currentIndex++;
        showQuestion();
      }, 400);
    }

    function checkAnswer() {
      if (gameState.answered) return;
      
      gameState.attemptCount++;
      const inputEl = document.getElementById('user-input');
      const feedback = document.getElementById('feedback');
      const answer = gameState.data[gameState.currentIndex].answer.toLowerCase();
      const userAnswer = inputEl.value.trim().toLowerCase();

      if (userAnswer === answer) {
        gameState.answered = true;
        stopTimer();

        const usedSeconds = (Date.now() - (window.answerStartTime || Date.now())) / 1000;
        let bonus = 0;
        let feedbackMsg = `<div class='feedback-box feedback-correct'>âœ… ç­”å°äº†ï¼å¤ªæ£’äº†ï¼`;
        
        if (usedSeconds < 10) {
          bonus = 2;
          feedbackMsg += ` <span class='feedback-bonus'>BONUS! â±ï¸ +2</span>`;
        }
        feedbackMsg += `</div>`;
        
        feedback.innerHTML = feedbackMsg;
        inputEl.disabled = true;
        document.getElementById('submit-btn').disabled = true;
        
        speak(answer, 1.1);
        saveProgress();
        updateCounter();
        
        logAnswer(true, inputEl.value.trim());
        
        const addStars = 1 + bonus;
        addStarsToTotal(addStars);
        gameState.sessionStars += addStars;
        document.getElementById('sessionStarsDisplay').textContent = `æœ¬æ¬¡å·²ç²å¾— ${gameState.sessionStars} é¡†æ˜Ÿæ˜Ÿ`;
        
        try {
          SOUNDS.correct.currentTime = 0;
          SOUNDS.correct.play();
        } catch (e) {}
        
        setTimeout(() => {
          gameState.currentIndex++;
          showQuestion();
        }, 1300);
      } else {
        if (gameState.attemptCount < GAME_CONFIG.MAX_ATTEMPTS) {
          feedback.innerHTML = `<div class='feedback-box feedback-wrong'>âŒ å†è©¦ä¸€æ¬¡ï¼ä½ å¯ä»¥çš„ï¼</div>`;
          try {
            SOUNDS.wrong.currentTime = 0;
            SOUNDS.wrong.play();
          } catch (e) {}
        } else {
          feedback.innerHTML = `<div class='feedback-box feedback-wrong'>âŒ æ­£ç¢ºç­”æ¡ˆï¼š<b>${gameState.data[gameState.currentIndex].answer}</b><br>åˆ¥æ°£é¤’ï¼Œå†æ¥å†å²ï¼</div>`;
          inputEl.disabled = true;
          document.getElementById('submit-btn').disabled = true;
          
          logAnswer(false, inputEl.value.trim());
          
          try {
            SOUNDS.wrong.currentTime = 0;
            SOUNDS.wrong.play();
          } catch (e) {}
          
          setTimeout(() => {
            gameState.currentIndex++;
            showQuestion();
          }, 1300);
        }
      }
    }

    // ===== æ˜Ÿæ˜Ÿç³»çµ± =====
    function loadTotalStars() {
      const stars = localStorage.getItem('totalStars');
      return stars !== null ? parseInt(stars, 10) : 0;
    }

    function addStarsToTotal(stars) {
      const currentStars = loadTotalStars();
      const newTotal = currentStars + stars;
      localStorage.setItem('totalStars', newTotal);
      updateStarsDisplay();
    }

    function updateStarsDisplay() {
      document.getElementById('totalStarsCount').textContent = loadTotalStars();
    }

    // ===== éŠæˆ²çµæŸç•«é¢ =====
    function showGameEndScreen() {
      // è¨ˆç®—çµ±è¨ˆæ•¸æ“š
      const correctCount = gameState.answerLog.filter(log => log && log.correct === true).length;
      const wrongCount = gameState.answerLog.filter(log => log && log.correct === false).length;
      const totalStars = loadTotalStars();

      // æ›´æ–°çµæŸç•«é¢æ•¸æ“š
      document.getElementById('endSessionStars').textContent = gameState.sessionStars;
      document.getElementById('endCorrectCount').textContent = correctCount;
      document.getElementById('endWrongCount').textContent = wrongCount;
      document.getElementById('endTotalStars').textContent = totalStars;

      // é¡¯ç¤ºçµæŸç•«é¢
      document.getElementById('gameEndModal').style.display = 'flex';
      
      // åœæ­¢è¨ˆæ™‚å™¨
      stopTimer();
      
      // è§£é–è¤‡ç¿’æŒ‰éˆ•
      unlockReviewButton();
      
      // æ’­æ”¾å®ŒæˆéŸ³æ•ˆ
      try {
        SOUNDS.correct.currentTime = 0;
        SOUNDS.correct.play();
      } catch (e) {}
    }

    function restartGame() {
      // éš±è—çµæŸç•«é¢
      document.getElementById('gameEndModal').style.display = 'none';
      
      // é‡ç½®éŠæˆ²ç‹€æ…‹
      gameState.currentIndex = 0;
      gameState.sessionStars = 0;
      gameState.answerLog = [];
      
      // é‡æ–°åˆå§‹åŒ–æ•¸æ“š
      initData();
      updateCounter();
      showQuestion();
      
      // æ›´æ–°æœ¬æ¬¡æ˜Ÿæ˜Ÿé¡¯ç¤º
      document.getElementById('sessionStarsDisplay').textContent = 'æœ¬æ¬¡å·²ç²å¾— 0 é¡†æ˜Ÿæ˜Ÿ';
    }

    // ===== è¤‡ç¿’å–®å­—åŠŸèƒ½ =====
    function showReviewModal() {
      // æš«åœéŠæˆ²è¨ˆæ™‚å™¨
      stopTimer();
      
      const container = document.getElementById('reviewWordsContainer');
      container.innerHTML = '';
      // é¡¯ç¤ºæ‰€æœ‰å–®å­—
      VOCAB_DATA.forEach((item, index) => {
        const wordDiv = document.createElement('div');
        wordDiv.style.cssText = `
          background: rgba(255, 255, 255, 0.1);
          border: 1px solid #ffd700;
          border-radius: 10px;
          padding: 15px;
          margin: 10px 0;
          text-align: left;
          cursor: pointer;
          transition: all 0.3s;
        `;
        wordDiv.innerHTML = `
          <div style="display: flex; align-items: flex-start; gap: 15px;">
            <div style="flex: 1; min-width: 0;">
              <div style="color: #ffd700; font-size: 1.2rem; font-weight: bold; margin-bottom: 8px; word-break: break-word;">
                ${index+1}. ${item.word}
              </div>
              <div style="color: #fff; font-size: 1rem; margin-bottom: 8px; word-break: break-word;">
                ${item.zh}
              </div>
              <div style="color: #0ff; font-size: 0.9rem; font-style: italic; word-break: break-word;">
                ${item.en_sentence}
              </div>
            </div>
            <button onclick="event.stopPropagation(); speakWord('${item.word}')" style="
              background: #0ff;
              color: #000;
              border: none;
              border-radius: 50%;
              width: 45px;
              height: 45px;
              font-size: 1.3rem;
              cursor: pointer;
              flex-shrink: 0;
              display: flex;
              align-items: center;
              justify-content: center;
              transition: all 0.2s;
              box-shadow: 0 2px 8px rgba(0,255,255,0.3);">ğŸ”Š</button>
          </div>
        `;
        wordDiv.addEventListener('click', () => {
          speakWord(item.word);
        });
        container.appendChild(wordDiv);
      });
      document.getElementById('reviewModal').style.display = 'flex';
    }

    function closeReviewModal() {
      document.getElementById('reviewModal').style.display = 'none';
      // æ¢å¾©éŠæˆ²è¨ˆæ™‚å™¨ï¼ˆå¦‚æœéŠæˆ²é‚„åœ¨é€²è¡Œä¸­ï¼‰
      if (gameState.currentIndex < gameState.data.length && !gameState.answered) {
        startTimer();
      }
    }

    function speakWord(word) {
      if (!window.speechSynthesis) return;
      
      const utter = new window.SpeechSynthesisUtterance(word);
      utter.lang = 'en-US';
      utter.rate = 0.9;
      utter.pitch = 1.1;
      if (gameState.preferredVoice) utter.voice = gameState.preferredVoice;
      
      window.speechSynthesis.cancel();
      window.speechSynthesis.speak(utter);
    }

    // ===== åˆå§‹åŒ– =====
    if (typeof speechSynthesis !== 'undefined') {
      speechSynthesis.onvoiceschanged = pickVoice;
      pickVoice();
    }

    document.addEventListener('DOMContentLoaded', () => {
      updateStarsDisplay();
      document.getElementById('sessionStarsDisplay').textContent = `æœ¬æ¬¡å·²ç²å¾— 0 é¡†æ˜Ÿæ˜Ÿ`;
      initData();
      gameState.currentIndex = 0;
      updateCounter();
      showQuestion();
      localStorage.removeItem('fillIndex');
      
      // åˆå§‹åŒ–æ™‚è§£é–è¤‡ç¿’æŒ‰éˆ•
      unlockReviewButton();
    });

    // é»æ“Šå½ˆçª—å¤–ä¹Ÿèƒ½é—œé–‰
    document.addEventListener('DOMContentLoaded', function() {
      const reviewModal = document.getElementById('reviewModal');
      const gameEndModal = document.getElementById('gameEndModal');
      
      if(reviewModal){
        reviewModal.addEventListener('click', function(e){
          if(e.target === reviewModal){
            closeReviewModal();
          }
        });
      }
      
      if(gameEndModal){
        gameEndModal.addEventListener('click', function(e){
          if(e.target === gameEndModal){
            document.getElementById('gameEndModal').style.display = 'none';
          }
        });
      }
    });
  </script>
</body>
</html>
