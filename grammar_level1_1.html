<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Á¨¨‰∏ÄÈóúÔºöÂñöÈÜíÊ®πÊú®ÂÆàË≠∑ËÄÖ - beÂãïË©ûËÇØÂÆöÂè•</title>
    <link rel="stylesheet" href="responsive.css">
    <style>
        html, body {
            height: 100%;
        }
        body {
            font-family: 'Microsoft JhengHei', Arial, sans-serif;
            background: linear-gradient(135deg, #0f2027 0%, #2c5364 100%);
            min-height: 100vh;
            margin: 0;
            color: #e0eaff;
            position: relative;
            overflow-x: hidden;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            padding: 20px 0;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: url('images/cards/galaxy.gif') repeat center center, radial-gradient(ellipse at bottom, #1b2735 0%, #090a0f 100%);
            opacity: 0.5;
            z-index: 0;
            pointer-events: none;
        }

        .game-container {
            background: rgba(30, 40, 70, 0.7);
            border-radius: 24px;
            padding: 36px;
            box-shadow: 0 8px 40px #00ffe055, 0 1.5px 8px #0ff2  inset;
            max-width: 820px;
            width: 95%;
            text-align: center;
            backdrop-filter: blur(8px);
            border: 1.5px solid #3ecfff55;
            margin: 0 auto;
            position: relative;
            z-index: 1;
        }

        .level-header {
            margin-bottom: 32px;
        }

        .level-title {
            font-size: 2.7em;
            color: #7eeeff;
            margin-bottom: 10px;
            text-shadow: 0 0 16px #00ffe0, 0 2px 8px #0ff2;
            letter-spacing: 2px;
        }

        .level-subtitle {
            font-size: 1.3em;
            color: #aeefff;
            margin-bottom: 15px;
            text-shadow: 0 0 8px #00ffe0;
        }

        .scene-description {
            font-size: 1.1em;
            color: #b2cfff;
            font-style: italic;
            text-shadow: 0 0 6px #00ffe0;
        }

        .game-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding: 15px;
            background: linear-gradient(90deg, #232b3a 60%, #1b2735 100%);
            border-radius: 15px;
            box-shadow: 0 2px 12px #00ffe033;
        }

        .timer, .score, .stars {
            font-size: 1.5em;
            font-weight: bold;
            color: #00ffe0;
            text-shadow: 0 0 8px #00ffe0;
        }

        .stars { color: #ffe066; text-shadow: 0 0 8px #ffe066; }

        .sound-toggle {
            background: none;
            border: none;
            font-size: 1.7em;
            cursor: pointer;
            padding: 5px;
            border-radius: 50%;
            transition: all 0.3s ease;
            color: #7eeeff;
            box-shadow: 0 0 8px #00ffe0;
        }

        .sound-toggle:hover {
            background: rgba(0,255,255,0.08);
            transform: scale(1.1);
            box-shadow: 0 0 16px #00ffe0;
        }

        .sound-toggle.muted { opacity: 0.5; }

        .question-container {
            background: rgba(20, 30, 50, 0.85);
            border-radius: 18px;
            padding: 32px;
            margin-bottom: 30px;
            box-shadow: 0 4px 24px #00ffe022;
            border: 1px solid #3ecfff33;
        }

        .question {
            font-size: 2em;
            margin-bottom: 30px;
            color: #e0eaff;
            line-height: 1.4;
            text-shadow: 0 0 8px #00ffe0;
        }

        .options {
            display: flex;
            gap: 18px;
            justify-content: center;
            margin-bottom: 30px;
        }

        .option {
            background: linear-gradient(135deg, #0ff 0%, #3ecfff 100%);
            color: #222;
            border: none;
            padding: 16px 24px;
            border-radius: 12px;
            font-size: 1.2em;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 2px 12px #00ffe055;
            font-weight: bold;
            letter-spacing: 1px;
        }

        .option:hover {
            transform: translateY(-2px) scale(1.04);
            box-shadow: 0 8px 32px #00ffe0cc;
            background: linear-gradient(135deg, #3ecfff 0%, #0ff 100%);
        }

        .option.correct {
            background: linear-gradient(135deg, #1e90ff 0%, #00ffe0 100%);
            color: #fff;
            font-weight: bold;
            text-shadow: 0 0 12px #00ffe0, 0 0 4px #fff;
            box-shadow: 0 0 24px #00ffe0cc, 0 0 8px #1e90ff;
            border: 2px solid #00ffe0;
        }

        .option.incorrect {
            background: linear-gradient(135deg, #7f53ac 0%, #ff6a88 100%);
            color: #fff;
            font-weight: bold;
            text-shadow: 0 0 12px #ff6a88, 0 0 4px #fff;
            box-shadow: 0 0 24px #ff6a88cc, 0 0 8px #7f53ac;
            border: 2px solid #ff6a88;
        }

        .hint-buttons {
            display: flex;
            justify-content: center;
            gap: 18px;
            margin-bottom: 20px;
        }

        .hint-btn {
            background: linear-gradient(135deg, #00ffe0, #3ecfff);
            color: #222;
            border: none;
            padding: 10px 24px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1em;
            font-weight: bold;
            transition: all 0.3s ease;
            box-shadow: 0 2px 12px #00ffe055;
        }

        .hint-btn:hover {
            transform: translateY(-1px) scale(1.04);
            box-shadow: 0 8px 24px #00ffe0cc;
            background: linear-gradient(135deg, #3ecfff, #00ffe0);
        }

        .hint-btn:disabled {
            background: #3ecfff55;
            cursor: not-allowed;
            transform: none;
        }

        .grammar-tip {
            background: linear-gradient(135deg, #3ecfff, #00ffe0);
            color: #222;
            padding: 15px;
            border-radius: 12px;
            margin-bottom: 20px;
            font-size: 1.1em;
            font-weight: bold;
            box-shadow: 0 2px 12px #00ffe055;
        }

        .progress-bar {
            width: 100%;
            height: 12px;
            background: #1b2735;
            border-radius: 6px;
            overflow: hidden;
            margin-bottom: 20px;
            box-shadow: 0 2px 12px #00ffe033;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #00ffe0, #3ecfff);
            transition: width 0.3s ease;
            box-shadow: 0 0 12px #00ffe0;
        }

        .result-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(10, 20, 40, 0.8);
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .result-content {
            background: rgba(30, 40, 70, 0.95);
            padding: 40px;
            border-radius: 24px;
            text-align: center;
            max-width: 500px;
            width: 90%;
            box-shadow: 0 8px 40px #00ffe055;
            border: 1.5px solid #3ecfff55;
            backdrop-filter: blur(8px);
        }

        .result-title {
            font-size: 2em;
            margin-bottom: 20px;
            color: #7eeeff;
            text-shadow: 0 0 16px #00ffe0, 0 2px 8px #0ff2;
        }

        .result-score {
            font-size: 1.5em;
            margin-bottom: 20px;
            color: #ffe066;
            text-shadow: 0 0 8px #ffe066;
        }

        .result-message {
            font-size: 1.2em;
            margin-bottom: 30px;
            color: #aeefff;
            text-shadow: 0 0 8px #00ffe0;
        }

        .action-buttons {
            display: flex;
            justify-content: center;
            gap: 18px;
        }

        .action-btn {
            padding: 12px 28px;
            border: none;
            border-radius: 10px;
            font-size: 1em;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: bold;
            background: linear-gradient(135deg, #00ffe0, #3ecfff);
            color: #222;
            box-shadow: 0 2px 12px #00ffe055;
        }

        .action-btn:hover {
            background: linear-gradient(135deg, #3ecfff, #00ffe0);
            box-shadow: 0 8px 24px #00ffe0cc;
            color: #111;
        }

        .btn-primary {
            background: linear-gradient(135deg, #7eeeff, #00ffe0);
            color: #222;
        }

        .btn-secondary {
            background: linear-gradient(135deg, #232b3a, #1b2735);
            color: #7eeeff;
            border: 1.5px solid #3ecfff55;
        }

        .btn-secondary:hover {
            background: linear-gradient(135deg, #3ecfff, #232b3a);
            color: #fff;
        }

        .guardian-statue {
            width: 90px;
            height: 90px;
            background: linear-gradient(135deg, #00ffe0, #3ecfff);
            border-radius: 50%;
            margin: 0 auto 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5em;
            box-shadow: 0 0 32px #00ffe0cc;
            transition: all 0.3s ease;
        }

        .guardian-statue.shine {
            animation: shine 0.5s ease;
        }

        @keyframes shine {
            0% { transform: scale(1); }
            50% { transform: scale(1.2); box-shadow: 0 0 40px #00ffe0; }
            100% { transform: scale(1); }
        }

        .falling-leaf {
            position: absolute;
            width: 20px;
            height: 20px;
            background: #00ffe0;
            border-radius: 50% 0 50% 0;
            animation: fall 2s linear;
        }

        @keyframes fall {
            0% { transform: translateY(-100px) rotate(0deg); opacity: 1; }
            100% { transform: translateY(100vh) rotate(360deg); opacity: 0; }
        }

        @media (max-width: 768px) {
            .game-container {
                padding: 20px;
                width: 98%;
            }

            .level-title {
                font-size: 2em;
            }

            .question {
                font-size: 1.5em;
            }

            .options {
                flex-direction: column;
            }

            .game-info {
                flex-direction: column;
                gap: 10px;
            }
        }

        /* ========== Ë™ûÊ≥ïÈÅäÊà≤ÈüøÊáâÂºèÂ¢ûÂº∑Ë®≠Ë®à ========== */
        
        /* Âπ≥ÊùøÈÅ©ÈÖç (1024px‰ª•‰∏ã) */
        @media (max-width: 1024px) {
            .game-container {
                max-width: 95%;
                padding: 28px;
            }
            
            .level-title {
                font-size: 2.4em;
                letter-spacing: 1.5px;
            }
            
            .level-subtitle {
                font-size: 1.2em;
            }
            
            .question {
                font-size: 1.8em;
                margin-bottom: 25px;
            }
            
            .options {
                gap: 15px;
            }
            
            .option {
                padding: 14px 20px;
                font-size: 1.1em;
            }
            
            .hint-btn {
                padding: 9px 20px;
                font-size: 0.95em;
            }
            
            .action-btn {
                padding: 11px 24px;
                font-size: 0.95em;
            }
        }

        /* ÊâãÊ©üÊ©´Â±èÈÅ©ÈÖç (768px‰ª•‰∏ã) */
        @media (max-width: 768px) {
            .game-container {
                padding: 16px;
                width: 98%;
                margin: 10px auto;
            }

            .level-title {
                font-size: 1.8em;
                margin-bottom: 8px;
            }
            
            .level-subtitle {
                font-size: 1.1em;
                margin-bottom: 12px;
            }
            
            .scene-description {
                font-size: 1em;
            }

            .game-info {
                flex-direction: column;
                gap: 8px;
                padding: 12px;
            }
            
            .timer, .score, .stars {
                font-size: 1.3em;
            }

            .question {
                font-size: 1.4em;
                margin-bottom: 20px;
                line-height: 1.3;
            }

            .options {
                flex-direction: column;
                gap: 12px;
            }
            
            .option {
                padding: 14px 16px;
                font-size: 1.1em;
                width: 100%;
            }
            
            .hint-buttons {
                flex-direction: column;
                gap: 12px;
            }
            
            .hint-btn {
                padding: 12px 16px;
                width: 100%;
                max-width: 300px;
                margin: 0 auto;
            }
            
            .action-buttons {
                flex-direction: column;
                gap: 12px;
            }
            
            .action-btn {
                padding: 12px 16px;
                width: 100%;
                max-width: 280px;
                margin: 0 auto;
            }
            
            .guardian-statue {
                width: 70px;
                height: 70px;
                font-size: 2em;
                margin-bottom: 15px;
            }
            
            .grammar-tip {
                font-size: 1em;
                padding: 12px;
                margin-bottom: 16px;
            }
            
            .progress-bar {
                height: 10px;
                margin-bottom: 16px;
            }
            
            .result-content {
                padding: 24px 16px;
                margin: 10px;
            }
            
            .result-title {
                font-size: 1.6em;
                margin-bottom: 16px;
            }
            
            .result-score {
                font-size: 1.3em;
                margin-bottom: 16px;
            }
            
            .result-message {
                font-size: 1.1em;
                margin-bottom: 24px;
            }
        }

        /* ÊâãÊ©üË±éÂ±èÈÅ©ÈÖç (600px‰ª•‰∏ã) */
        @media (max-width: 600px) {
            .game-container {
                padding: 12px;
                width: 99%;
                margin: 5px auto;
            }

            .level-title {
                font-size: 1.6em;
                margin-bottom: 6px;
                letter-spacing: 1px;
            }
            
            .level-subtitle {
                font-size: 1em;
                margin-bottom: 10px;
            }
            
            .scene-description {
                font-size: 0.95em;
            }

            .game-info {
                padding: 10px;
                gap: 6px;
            }
            
            .timer, .score, .stars {
                font-size: 1.2em;
            }
            
            .sound-toggle {
                font-size: 1.5em;
                padding: 4px;
            }

            .question {
                font-size: 1.3em;
                margin-bottom: 18px;
            }
            
            .option {
                padding: 12px 14px;
                font-size: 1em;
            }
            
            .hint-btn {
                padding: 10px 14px;
                font-size: 0.9em;
            }
            
            .action-btn {
                padding: 10px 14px;
                font-size: 0.9em;
            }
            
            .guardian-statue {
                width: 60px;
                height: 60px;
                font-size: 1.8em;
                margin-bottom: 12px;
            }
            
            .grammar-tip {
                font-size: 0.95em;
                padding: 10px;
                margin-bottom: 14px;
            }
            
            #wordHintDiv, #logicHintDiv {
                padding: 12px 14px;
                font-size: 0.95em;
                margin: 16px 0;
            }
            
            #wordHintDiv .word-block {
                padding: 5px 10px;
                font-size: 1em;
                margin: 3px 8px 3px 0;
            }
            
            .answer-explanation {
                padding: 12px 14px;
                font-size: 1.05em;
            }
            
            .pronunciation-btn {
                padding: 6px 12px;
                font-size: 0.9em;
                margin-left: 8px;
            }
        }

        /* Ë∂ÖÂ∞èËû¢ÂπïÈÅ©ÈÖç (480px‰ª•‰∏ã) */
        @media (max-width: 480px) {
            .game-container {
                padding: 8px;
                width: 100%;
                margin: 0;
                border-radius: 16px;
            }

            .level-title {
                font-size: 1.4em;
                margin-bottom: 5px;
            }
            
            .level-subtitle {
                font-size: 0.95em;
                margin-bottom: 8px;
            }
            
            .scene-description {
                font-size: 0.9em;
            }

            .game-info {
                padding: 8px;
                gap: 5px;
            }
            
            .timer, .score, .stars {
                font-size: 1.1em;
            }

            .question {
                font-size: 1.2em;
                margin-bottom: 16px;
            }
            
            .option {
                padding: 10px 12px;
                font-size: 0.95em;
            }
            
            .hint-btn, .action-btn {
                padding: 9px 12px;
                font-size: 0.85em;
            }
            
            .guardian-statue {
                width: 50px;
                height: 50px;
                font-size: 1.6em;
                margin-bottom: 10px;
            }
            
            .grammar-tip {
                font-size: 0.9em;
                padding: 8px;
                margin-bottom: 12px;
            }
            
            .result-content {
                padding: 16px 12px;
                margin: 5px;
            }
            
            .result-title {
                font-size: 1.4em;
                margin-bottom: 12px;
            }
            
            .result-score {
                font-size: 1.2em;
                margin-bottom: 12px;
            }
            
            .result-message {
                font-size: 1em;
                margin-bottom: 20px;
            }
        }

        /* Ëß∏ÊéßË£ùÁΩÆÂÑ™Âåñ */
        @media (hover: none) and (pointer: coarse) {
            .option:hover, .hint-btn:hover, .action-btn:hover, .sound-toggle:hover {
                transform: none;
                box-shadow: 0 2px 12px #00ffe055;
            }
            
            .option:active, .hint-btn:active, .action-btn:active {
                transform: scale(0.98);
                transition: transform 0.1s ease;
            }
            
            /* Â¢ûÂ§ßËß∏ÊéßÂçÄÂüü */
            button, .btn {
                min-height: 44px;
                min-width: 44px;
            }
            
            .pronunciation-btn {
                min-height: 40px;
                min-width: 80px;
            }
        }

        /* Ê©´Â±èÊ®°ÂºèÁâπÂà•ËôïÁêÜ */
        @media (max-height: 500px) and (orientation: landscape) {
            .game-container {
                margin: 5px auto;
                padding: 12px;
            }
            
            .level-header {
                margin-bottom: 16px;
            }
            
            .level-title {
                font-size: 1.5em;
                margin-bottom: 4px;
            }
            
            .level-subtitle {
                font-size: 1em;
                margin-bottom: 8px;
            }
            
            .guardian-statue {
                width: 50px;
                height: 50px;
                font-size: 1.5em;
                margin-bottom: 8px;
            }
            
            .grammar-tip {
                font-size: 0.9em;
                padding: 8px;
                margin-bottom: 10px;
            }
            
            .question {
                font-size: 1.2em;
                margin-bottom: 15px;
            }
            
            .result-content {
                max-height: 90vh;
                overflow-y: auto;
            }
        }

        /* Êñ∞Â¢ûÔºöÂõ∞Èõ£ÂñÆÂ≠óÊèêÁ§∫ÂçÄÂ°äÁßëÊäÄÈ¢®Ê†º */
        #wordHintDiv {
            margin: 20px 0;
            background: rgba(20,40,70,0.92);
            border: 1.5px solid #00ffe0;
            border-radius: 12px;
            padding: 16px 18px;
            text-align: left;
            box-shadow: 0 0 18px #00ffe088, 0 1.5px 8px #0ff2 inset;
            display: none;
        }
        #wordHintDiv strong {
            color: #00ffe0;
            font-size: 1.1em;
            letter-spacing: 1px;
            text-shadow: 0 0 8px #00ffe0;
        }
        #wordHintDiv .word-block {
            display: inline-block;
            margin: 4px 12px 4px 0;
            padding: 6px 12px;
            background: linear-gradient(135deg, #232b3a 60%, #1b2735 100%);
            color: #7eeeff;
            border-radius: 8px;
            font-weight: bold;
            font-size: 1.08em;
            box-shadow: 0 0 8px #00ffe0cc;
            transition: box-shadow 0.2s;
        }
        #wordHintDiv .word-block:hover {
            box-shadow: 0 0 18px #00ffe0, 0 0 8px #7eeeff;
        }
        #wordHintDiv .zh {
            color: #fffbe6;
            font-size: 1em;
            margin-left: 8px;
            text-shadow: 0 0 4px #00ffe0;
        }

        /* Êñ∞Â¢ûÔºöÈÇèËºØÊèêÁ§∫ÂçÄÂ°äÁßëÊäÄÈ¢®Ê†º */
        #logicHintDiv {
            background: rgba(20,40,70,0.92);
            border: 1.5px solid #38ffb0;
            border-radius: 12px;
            margin: 20px 0;
            padding: 14px 18px;
            font-size: 1.05em;
            color: #e0fff7;
            box-shadow: 0 0 18px #38ffb088, 0 1.5px 8px #38ffb055 inset;
            text-align: left;
            display: none;
        }
        #logicHintDiv strong {
            color: #38ffb0;
            font-size: 1.08em;
            letter-spacing: 1px;
            text-shadow: 0 0 8px #38ffb0;
        }
        #logicHintDiv:hover {
            box-shadow: 0 0 24px #38ffb0, 0 0 8px #7eeeff;
        }

        /* Êñ∞Â¢ûÔºöÁ≠îÊ°àËß£ÈáãÂçÄÂ°äÁßëÊäÄÈ¢®Ê†º */
        .answer-explanation {
            margin: 12px 0 0 0;
            padding: 16px 18px;
            background: rgba(20,40,70,0.92);
            border: 1.5px solid #00ffe0;
            border-radius: 12px;
            color: #7eeeff;
            font-size: 1.18em;
            font-weight: bold;
            text-shadow: 0 0 8px #00ffe0, 0 0 2px #fff;
            box-shadow: 0 0 18px #00ffe088, 0 1.5px 8px #0ff2 inset;
            display: inline-block;
        }

        /* Êñ∞Â¢ûÔºöÁôºÈü≥ÊåâÈàïÊ®£Âºè */
        .pronunciation-btn {
            background: linear-gradient(135deg, #ff6b6b, #ff8e8e);
            color: #fff;
            border: none;
            padding: 8px 16px;
            border-radius: 8px;
            font-size: 1em;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px #ff6b6b55;
            font-weight: bold;
            margin-left: 12px;
            display: inline-flex;
            align-items: center;
            gap: 6px;
        }

        .pronunciation-btn:hover {
            transform: translateY(-1px) scale(1.05);
            box-shadow: 0 4px 16px #ff6b6bcc;
            background: linear-gradient(135deg, #ff8e8e, #ff6b6b);
        }

        .pronunciation-btn:active {
            transform: translateY(0) scale(0.98);
        }

        .pronunciation-btn:disabled {
            background: #666;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
    </style>
</head>
<body>
    <div class="game-container">
        <div class="level-header">
            <h1 class="level-title" id="levelTitle">ÂñöÈÜíÊ®πÊú®ÂÆàË≠∑ËÄÖ</h1>
            <h2 class="level-subtitle" id="levelSubtitle">beÂãïË©ûËÇØÂÆöÂè•</h2>
            <p class="scene-description" id="levelDescription">ÈúßÊ∞£ÁπöÁπûÁöÑÁ≤æÈùàÊ£ÆÊûó</p>
        </div>

        <div class="game-info">
            <div class="timer">ÊôÇÈñìÔºö<span id="timeLeft">03:00</span></div>
            <div class="score">ÂàÜÊï∏Ôºö<span id="currentScore">0</span>/100</div>
            <div class="stars">ÊòüÊòüÔºö<span id="starCount">0</span> ‚≠ê</div>
            <button class="sound-toggle" onclick="toggleSound()" id="soundToggle">üîä</button>
        </div>
        <div style="text-align:center;margin-bottom:20px;">
            <button class="action-btn btn-secondary" id="pauseBtn" onclick="pauseGame()" style="margin:0 8px;">‚è∏ Êö´ÂÅú</button>
            <button class="action-btn btn-primary" id="resumeBtn" onclick="resumeGame()" style="margin:0 8px;display:none;">‚ñ∂Ô∏è ÁπºÁ∫å</button>
        </div>

        <div class="progress-bar">
            <div class="progress-fill" id="progressFill" style="width: 0%"></div>
        </div>

        <div class="guardian-statue" id="guardianStatue">üå≥</div>

        <div class="grammar-tip">
            <strong>ÊñáÊ≥ïÂ∞èÊèêÁ§∫Ôºö</strong> I ‚Üí amÔºåyou/we/they ‚Üí areÔºåhe/she/it ‚Üí is
        </div>

        <div class="question-container">
            <div class="question" id="questionText">Ê∫ñÂÇôÈñãÂßãÈÅäÊà≤...</div>
            <div class="options" id="optionsContainer"></div>
            <div class="subLevelProgress" id="subLevelProgress"></div>
        </div>

        <div class="hint-buttons">
            <button class="hint-btn" id="wordHintBtn" onclick="useWordHint()">Âõ∞Èõ£ÂñÆÂ≠óÊèêÁ§∫ (10‚≠ê)</button>
            <button class="hint-btn" id="logicHintBtn" onclick="useLogicHint()">Âà§Êñ∑ÈÇèËºØÊèêÁ§∫ (20‚≠ê)</button>
        </div>
        
        <div class="action-buttons">
            <button class="action-btn btn-secondary" onclick="skipQuestion()">Ë∑≥ÈÅéÊ≠§È°å</button>
            <button class="action-btn btn-primary" onclick="nextQuestion()" id="nextBtn" style="display: none;">‰∏ã‰∏ÄÈ°å</button>
            <button class="action-btn btn-secondary" onclick="goToMenu()">ËøîÂõûÈÅ∏ÂñÆ</button>
            <button class="action-btn btn-secondary" onclick="goToHome()">ËøîÂõûÈ¶ñÈ†Å</button>
            <button class="action-btn" onclick="gemSystem.showGemShop()" style="background: linear-gradient(135deg, #00ffe0, #3ecfff); color: #222; border: 1px solid #00ffe0;">üíé ÂØ∂Áü≥ÂïÜÂ∫ó</button>
        </div>
    </div>

    <div class="result-modal" id="resultModal">
        <div class="result-content">
            <h2 class="result-title" id="resultTitle">ÈÅäÊà≤ÁµêÊùü</h2>
            <div class="result-score" id="resultScore">ÂàÜÊï∏Ôºö0/100</div>
            <div class="result-message" id="resultMessage">ÁπºÁ∫åÂä™ÂäõÔºÅ</div>
            <div class="action-buttons">
                <button class="action-btn btn-primary" onclick="restartGame()">ÈáçÊñ∞ÈñãÂßã</button>
                <button class="action-btn btn-secondary" onclick="goToMenu()">ËøîÂõûÈÅ∏ÂñÆ</button>
            </div>
        </div>
    </div>

    <script src="js/userData.js"></script>
    <script src="js/grammarLevel1_1_questions.js"></script>
    <script src="js/starRewardSystem.js"></script>
    <script src="js/sound.js"></script>
    <script src="js/gemSystem.js"></script>
    <script>
        // Âõ∞Èõ£ÂñÆÂ≠óÁøªË≠ØÂ≠óÂÖ∏
        const DIFFICULT_WORDS_TRANSLATION = {
            // Âü∫Êú¨Ë©ûÂΩô
            'student': 'Â≠∏Áîü',
            'teacher': 'ËÄÅÂ∏´',
            'doctor': 'ÈÜ´Áîü',
            'friend': 'ÊúãÂèã',
            'brother': 'ÂÖÑÂºü',
            'sister': 'ÂßäÂ¶π',
            'parents': 'Áà∂ÊØç',
            'classmates': 'ÂêåÂ≠∏',
            
            // ÂΩ¢ÂÆπË©û
            'beautiful': 'ÁæéÈ∫óÁöÑ',
            'happy': 'Âø´Ê®ÇÁöÑ',
            'tall': 'È´òÁöÑ',
            'smart': 'ËÅ∞ÊòéÁöÑ',
            'cold': 'ÂÜ∑ÁöÑ',
            'busy': 'ÂøôÁ¢åÁöÑ',
            'tired': 'Áñ≤ÂÄ¶ÁöÑ',
            'hungry': 'È§ìÁöÑ',
            'excited': 'ËààÂ•ÆÁöÑ',
            'ready': 'Ê∫ñÂÇôÂ•ΩÁöÑ',
            'late': 'ÈÅ≤Âà∞ÁöÑ',
            'early': 'Êó©ÁöÑ',
            'good': 'Â•ΩÁöÑ',
            'nice': 'Â•ΩÁöÑ',
            'kind': 'ÂñÑËâØÁöÑ',
            'lucky': 'Âπ∏ÈÅãÁöÑ',
            'very': 'ÈùûÂ∏∏',
            'always': 'Á∏ΩÊòØ',
            'best': 'ÊúÄÂ•ΩÁöÑ',
            'one': '‰∏ÄÂÄã',
            'only': 'Âè™Êúâ',
            'absolutely': 'ÁµïÂ∞çÂú∞',
            'remarkable': 'ÂçìË∂äÁöÑ',
            'skilled': 'ÁÜüÁ∑¥ÁöÑ',
            'consistently': 'ÊåÅÁ∫åÂú∞',
            'talented': 'ÊúâÊâçËèØÁöÑ',
            'remarkably': 'ÈùûÂ∏∏Âú∞',
            'undoubtedly': 'ÁÑ°ÁñëÂú∞',
            'genuinely': 'ÁúüË™†Âú∞',
            'surprised': 'È©öË®ùÁöÑ',
            'significantly': 'È°ØËëóÂú∞',
            'improved': 'ÈÄ≤Ê≠•ÁöÑ',
            'essentially': 'Êú¨Ë≥™‰∏ä',
            'correct': 'Ê≠£Á¢∫ÁöÑ',
            'vital': 'ÈáçË¶ÅÁöÑ',
            'challenging': 'ÂÖ∑ÊúâÊåëÊà∞ÊÄßÁöÑ',
            'completely': 'ÂÆåÂÖ®Âú∞',
            'satisfied': 'ÊªøÊÑèÁöÑ',
            'ultimate': 'ÊúÄÁµÇÁöÑ',
            'integral': '‰∏çÂèØÊàñÁº∫ÁöÑ',
            'unparalleled': 'ÁÑ°ËàáÂÄ´ÊØîÁöÑ',
            'fully': 'ÂÖÖÂàÜÂú∞',
            'aware': 'ÊÑèË≠òÂà∞ÁöÑ',
            'chief': 'È¶ñÂ∏≠ÁöÑ',
            'main': '‰∏ªË¶ÅÁöÑ',
            
            // ‰ª£Ë©û
            'my': 'ÊàëÁöÑ',
            'your': '‰Ω†ÁöÑ',
            'it': 'ÂÆÉ',
            'we': 'ÊàëÂÄë',
            'they': '‰ªñÂÄë',
            'he': '‰ªñ',
            'she': 'Â•π',
            'you': '‰Ω†',
            'I': 'Êàë',
            
            // ÂêçË©û
            'cat': 'Ë≤ì',
            'dog': 'Áãó',
            'book': 'Êõ∏',
            'books': 'Êõ∏Á±ç',
            'table': 'Ê°åÂ≠ê',
            'home': 'ÂÆ∂',
            'park': 'ÂÖ¨Âúí',
            'weather': 'Â§©Ê∞£',
            'flowers': 'Ëä±Êúµ',
            'sky': 'Â§©Á©∫',
            'cars': 'Ê±ΩËªä',
            'guest': 'ÂÆ¢‰∫∫',
            'player': 'ÁêÉÂì°',
            'favorites': 'ÊúÄÊÑõ',
            'trip': 'ÊóÖË°å',
            'friends': 'ÊúãÂèãÂÄë',
            'middle': '‰∏≠Èñì',
            'road': 'ÈÅìË∑Ø',
            'part': 'ÈÉ®ÂàÜ',
            'group': 'ÂúòÈ´î',
            'leader': 'È†òÂ∞éËÄÖ',
            'answer': 'Á≠îÊ°à',
            'champions': 'ÂÜ†Ëªç',
            'test': 'Ê∏¨Ë©¶',
            'spiders': 'ËúòËõõ',
            'winner': 'Áç≤ÂãùËÄÖ',
            'committee': 'ÂßîÂì°ÊúÉ',
            'responsibility': 'Ë≤¨‰ªª',
            'mission': '‰ªªÂãô',
            'subject': 'ÁßëÁõÆ',
            'case': 'Ê°à‰ª∂',
            'players': 'ÁêÉÂì°ÂÄë',
            'performer': 'Ë°®ÊºîËÄÖ',
            'component': 'ÁµÑÊàêÈÉ®ÂàÜ',
            'people': '‰∫∫ÂÄë',
            'students': 'Â≠∏ÁîüÂÄë',
            'survivors': 'ÂÄñÂ≠òËÄÖ',
            'consequences': 'ÂæåÊûú',
            'candidate': 'ÂÄôÈÅ∏‰∫∫',
            'manager': 'Á∂ìÁêÜ',
            'investigator': 'Ë™øÊü•Âì°',
            'project': 'Â∞àÊ°à',
            'situation': 'ÊÉÖÊ≥Å',
            'team': 'ÂúòÈöä',
            'results': 'ÁµêÊûú',
            'organizer': 'ÁµÑÁπîËÄÖ',
            'event': 'Ê¥ªÂãï',
            'system': 'Á≥ªÁµ±',
            'process': 'ÈÅéÁ®ã',
            'company': 'ÂÖ¨Âè∏',
            'achievements': 'ÊàêÂ∞±',
            'engine': 'ÂºïÊìé',
            
            // Â∞àÊúâÂêçË©û
            'Anna': 'ÂÆâÂ®ú',
            'Tom': 'ÊπØÂßÜ',
            'Jerry': 'ÂÇëÁëû',
            'Mathematics': 'Êï∏Â≠∏',
            'English': 'Ëã±Ë™û',
            
            // ‰ªãË©ûÂíåÂâØË©û
            'at': 'Âú®',
            'in': 'Âú®...Ë£°Èù¢',
            'on': 'Âú®...‰∏äÈù¢',
            'here': 'ÈÄôË£°',
            'now': 'ÁèæÂú®',
            'today': '‰ªäÂ§©',
            'outside': 'Â§ñÈù¢',
            'time': 'ÊôÇÈñì',
            
            // ÂãïË©ûÁõ∏Èóú
            'help': 'Âπ´Âä©',
            'welcome': 'Ê≠°Ëøé',
            'investigating': 'Ë™øÊü•‰∏≠',
            'understands': 'ÁêÜËß£',
            'arrive': 'Âà∞ÈÅî',
            
            // ÂÖ∂‰ªñ
            'police': 'Ë≠¶ÂØü',
            'sunny': 'Êô¥ÊúóÁöÑ',
            'day': 'Â§©',
            'blue': 'ËóçËâ≤ÁöÑ',
            'white': 'ÁôΩËâ≤ÁöÑ',
            'red': 'Á¥ÖËâ≤ÁöÑ',
            'captain': 'ÈöäÈï∑',
            'afraid': 'ÂÆ≥ÊÄïÁöÑ',
            'decision-makers': 'Ê±∫Á≠ñËÄÖ'
        };

        // ÈÅäÊà≤ÁãÄÊÖã
        let gameState = {
            currentLevel: 'level1',
            currentSubLevel: 'sub1',
            currentQuestion: 0,
            score: 0,
            stars: 0,
            timeLeft: 180,
            questions: [],
            currentQuestionData: null,
            timer: null,
            isGameActive: false,
            isSoundEnabled: true,
            logicHintUsed: 0 // Âà§Êñ∑ÈÇèËºØÊèêÁ§∫‰ΩøÁî®Ê¨°Êï∏
        };

        // Èü≥ÊïàÁâ©‰ª∂
        let sounds = {};

        // ËºâÂÖ•Èü≥Êïà
        function loadSounds() {
            try {
                sounds = {
                    correct: new Audio('sound/correct.mp3'),
                    wrong: new Audio('sound/wrong.mp3'),
                    click: new Audio('sound/click.mp3'),
                    complete: new Audio('sound/unlock.mp3'), // ‰ΩøÁî® unlock.mp3 Êõø‰ª£‰∏çÂ≠òÂú®ÁöÑ completeSound.mp3
                    unlock: new Audio('sound/unlock.mp3'),
                    shine: new Audio('sound/shine.mp3')
                };
                Object.values(sounds).forEach(sound => {
                    sound.load();
                    sound.volume = 0.4;
                    sound.preload = 'auto';
                });
                // ËÉåÊôØÈü≥Ê®Ç
                if (!window.bgMusic) {
                    window.bgMusic = new Audio('sound/ÂçàÂæåÊîæÈ¨ÜÊôÇÂÖâÔºàÁ¥îÈü≥Ê®ÇÔºâ.mp3');
                    window.bgMusic.loop = true;
                    window.bgMusic.volume = 0.25;
                }
                // Ëá™ÂãïÊí≠ÊîæËÉåÊôØÈü≥Ê®ÇÔºàÈúÄÁî®Êà∂‰∫íÂãïËß∏ÁôºÔºâ
                document.body.addEventListener('click', function playBGOnce() {
                    if (gameState.isSoundEnabled) {
                        window.bgMusic.play().catch(()=>{});
                    }
                    document.body.removeEventListener('click', playBGOnce);
                });
                // Ëã•Â∑≤ÂïüÁî®Èü≥ÊïàÂâáËá™ÂãïÊí≠Êîæ
                if (gameState.isSoundEnabled) {
                    setTimeout(()=>{ window.bgMusic.play().catch(()=>{}); }, 500);
                } else {
                    window.bgMusic.pause();
                }
            } catch (error) {
                console.log('Èü≥ÊïàËºâÂÖ•Â§±Êïó:', error);
                gameState.isSoundEnabled = false;
            }
        }

        // Êí≠ÊîæÈü≥Êïà
        function playSound(soundName) {
            if (!gameState.isSoundEnabled || !sounds[soundName]) {
                return;
            }

            try {
                const sound = sounds[soundName];
                sound.pause();
                sound.currentTime = 0;
                sound.play().catch(error => {
                    console.log('Èü≥ÊïàÊí≠ÊîæÂ§±Êïó:', error);
                });
            } catch (error) {
                console.log('Èü≥ÊïàÊí≠ÊîæÈåØË™§:', error);
            }
        }

        // ÂàáÊèõÈü≥ÊïàÈñãÈóú
        function toggleSound() {
            gameState.isSoundEnabled = !gameState.isSoundEnabled;
            const soundToggle = document.getElementById('soundToggle');
            
            if (gameState.isSoundEnabled) {
                soundToggle.textContent = 'üîä';
                soundToggle.classList.remove('muted');
                if (window.bgMusic) window.bgMusic.play().catch(()=>{});
            } else {
                soundToggle.textContent = 'üîá';
                soundToggle.classList.add('muted');
                if (window.bgMusic) window.bgMusic.pause();
            }
            
            saveUserData();
        }

        // ËºâÂÖ•Áî®Êà∂Êï∏Êìö
        function loadUserData() {
            try {
                // ÂæûLinkageSystemËºâÂÖ•ÊòüÊòüÊï∏Êìö
                if (typeof LinkageSystem !== 'undefined' && LinkageSystem.stars) {
                    gameState.stars = LinkageSystem.stars.get();
                } else {
                    // ÂÇôÁî®ÊñπÊ°àÔºöÂæûlocalStorageËºâÂÖ•
                    gameState.stars = parseInt(localStorage.getItem('totalStars') || '0');
                }
                
                // ËºâÂÖ•Èü≥ÊïàË®≠ÂÆö
                const savedData = localStorage.getItem('grammarGameData');
                if (savedData) {
                    const userData = JSON.parse(savedData);
                    gameState.isSoundEnabled = userData.isSoundEnabled !== false;
                }
                
                // ÂàùÂßãÂåñÈü≥ÊïàÈñãÈóúÁãÄÊÖã
                const soundToggle = document.getElementById('soundToggle');
                if (gameState.isSoundEnabled) {
                    soundToggle.textContent = 'üîä';
                    soundToggle.classList.remove('muted');
                } else {
                    soundToggle.textContent = 'üîá';
                    soundToggle.classList.add('muted');
                }
            } catch (error) {
                console.log('ËºâÂÖ•Áî®Êà∂Êï∏ÊìöÂ§±Êïó:', error);
            }
        }

        // ‰øùÂ≠òÁî®Êà∂Êï∏Êìö
        function saveUserData() {
            try {
                // ÂêåÊ≠•ÊòüÊòüÊï∏ÊìöÂà∞LinkageSystem
                if (typeof LinkageSystem !== 'undefined' && LinkageSystem.stars) {
                    LinkageSystem.stars.set(gameState.stars);
                } else {
                    // ÂÇôÁî®ÊñπÊ°àÔºöÁõ¥Êé•‰øùÂ≠òÂà∞localStorage
                    localStorage.setItem('totalStars', gameState.stars.toString());
                }
                
                // ‰øùÂ≠òÈü≥ÊïàË®≠ÂÆö
                const userData = {
                    isSoundEnabled: gameState.isSoundEnabled,
                    lastPlayed: new Date().toISOString()
                };
                localStorage.setItem('grammarGameData', JSON.stringify(userData));
            } catch (error) {
                console.log('‰øùÂ≠òÁî®Êà∂Êï∏ÊìöÂ§±Êïó:', error);
            }
        }

        // Êõ¥Êñ∞ÈóúÂç°È°ØÁ§∫
        function updateLevelDisplay() {
            const currentSubLevelData = LEVEL_CONFIG[gameState.currentSubLevel];
            document.getElementById('levelTitle').textContent = currentSubLevelData.name;
            document.getElementById('levelSubtitle').textContent = 'beÂãïË©ûËÇØÂÆöÂè•';
            document.getElementById('levelDescription').textContent = currentSubLevelData.description;
        }

        // ÂàùÂßãÂåñÈÅäÊà≤
        function initGame() {
            loadSounds();
            loadUserData();
            // ‰ΩøÁî®Êñ∞È°åÂ∫´Á≥ªÁµ±
            const currentSubLevelData = LEVEL_CONFIG[gameState.currentSubLevel];
            gameState.questions = getRandomQuestions(gameState.currentSubLevel, 10);
            gameState.logicHintUsed = 0;
            updateLevelDisplay();
            startGame();
        }

        // ÈñãÂßãÈÅäÊà≤
        function startGame() {
            gameState.isGameActive = true;
            gameState.currentQuestion = 0;
            gameState.score = 0;
            gameState.timeLeft = 180;
            
            updateDisplay();
            loadQuestion();
            startTimer();
        }

        // ËºâÂÖ•È°åÁõÆ
        function loadQuestion() {
            if (gameState.currentQuestion >= gameState.questions.length) {
                endGame();
                return;
            }

            gameState.currentQuestionData = gameState.questions[gameState.currentQuestion];
            document.getElementById('questionText').textContent = gameState.currentQuestionData.question;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            
            // Èö®Ê©üÂåñÈÅ∏È†ÖÈ†ÜÂ∫è
            const shuffledOptions = shuffleOptions(gameState.currentQuestionData.options, gameState.currentQuestionData.correct);
            
            shuffledOptions.forEach((optionData, index) => {
                const button = document.createElement('button');
                button.className = 'option';
                button.textContent = optionData.text;
                button.onclick = () => selectAnswer(optionData.originalIndex);
                optionsContainer.appendChild(button);
            });
            // Èö±Ëóè‰∏ã‰∏ÄÈ°åÊåâÈàï
            document.getElementById('nextBtn').style.display = 'none';
            // Èö±ËóèÊâÄÊúâÊèêÁ§∫ÂçÄÂ°ä
            hideAllHints();
            // ÈáçÁΩÆÂõ∞Èõ£ÂñÆÂ≠óÊèêÁ§∫ÁãÄÊÖã
            resetWordHintState();
            // È°ØÁ§∫Â∞èÈóúÈÄ≤Â∫¶
            let progressDiv = document.getElementById('subLevelProgress');
            if (!progressDiv) {
                progressDiv = document.createElement('div');
                progressDiv.id = 'subLevelProgress';
                progressDiv.style.cssText = 'margin: 10px 0 0 0; font-size: 1.1em; color: #4a5568; font-weight: bold;';
                document.getElementById('questionContainer').appendChild(progressDiv);
            }
            progressDiv.textContent = `Êú¨Â∞èÈóúÈÄ≤Â∫¶ÔºöÁ¨¨${gameState.currentQuestion + 1} / ${gameState.questions.length}È°å`;
            updateProgress();
        }

        // Èö®Ê©üÂåñÈÅ∏È†ÖÈ†ÜÂ∫è
        function shuffleOptions(options, correctIndex) {
            const optionData = options.map((text, index) => ({
                text: text,
                originalIndex: index
            }));
            
            // Fisher-Yates Ê¥óÁâåÁÆóÊ≥ï
            for (let i = optionData.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [optionData[i], optionData[j]] = [optionData[j], optionData[i]];
            }
            
            return optionData;
        }

        // ÈÅ∏ÊìáÁ≠îÊ°à
        function selectAnswer(selectedIndex) {
            if (!gameState.isGameActive) return;
            playSound('click');
            const options = document.querySelectorAll('.option');
            const correctIndex = gameState.currentQuestionData.correct;
            // Á¶ÅÁî®ÊâÄÊúâÈÅ∏È†Ö
            options.forEach(option => option.style.pointerEvents = 'none');
            if (selectedIndex === correctIndex) {
                // Á≠îÂ∞ç
                options[selectedIndex].classList.add('correct');
                gameState.score += 10;
                gameState.stars += 2; // Á≠îÂ∞çÁç≤Âæó2È°ÜÊòüÊòü
                if (typeof StarRewardSystem !== 'undefined') StarRewardSystem.addStars(2);
                // Ê™¢Êü•ÊòØÂê¶Âõ∞Èõ£È°åÔºàhardÔºâ
                if (gameState.currentQuestionData.difficulty === 'hard' || gameState.currentQuestionData.isHard) {
                    gameState.stars += 3;
                    if (typeof StarRewardSystem !== 'undefined') StarRewardSystem.addStars(3);
                }
                // ÂÆàË≠∑ËÄÖÈõïÂÉèÁôºÂÖâ
                const statue = document.getElementById('guardianStatue');
                statue.classList.add('shine');
                setTimeout(() => statue.classList.remove('shine'), 500);
                playSound('correct');
                // Á≠îÂ∞çÁõ¥Êé•ÈÄ≤ÂÖ•‰∏ã‰∏ÄÈ°å
                setTimeout(() => {
                    gameState.currentQuestion++;
                    loadQuestion();
                }, 1000);
            } else {
                // Á≠îÈåØ
                options[selectedIndex].classList.add('incorrect');
                options[correctIndex].classList.add('correct');
                createFallingLeaf();
                playSound('wrong');
                // Á≠îÈåØÈ°ØÁ§∫Ëß£ÈáãÂíå‰∏ã‰∏ÄÈ°åÊåâÈàï
                setTimeout(() => {
                    showExplanation();
                    document.getElementById('nextBtn').style.display = 'inline-block';
                }, 1500);
            }
            updateDisplay();
            saveUserData();
        }

        // È°ØÁ§∫Ëß£Èáã
        function showExplanation() {
            const questionText = document.getElementById('questionText');
            const originalText = questionText.textContent;
            questionText.innerHTML = `
                <div style="margin-bottom: 15px;">${originalText}</div>
                <div class="answer-explanation">${gameState.currentQuestionData.explanation}</div>
            `;
            setTimeout(() => {
                gameState.currentQuestion++;
                loadQuestion();
            }, 2000);
        }

        // Âõ∞Èõ£ÂñÆÂ≠óÊèêÁ§∫ÁãÄÊÖã
        let wordHintState = {
            currentIndex: 0,
            totalWords: 0,
            words: []
        };

        // ÈáçÁΩÆÂõ∞Èõ£ÂñÆÂ≠óÊèêÁ§∫ÁãÄÊÖã
        function resetWordHintState() {
            wordHintState.currentIndex = 0;
            wordHintState.totalWords = 0;
            wordHintState.words = [];
            
            // ÈáçÁΩÆÊåâÈàïÁãÄÊÖã
            const wordHintBtn = document.getElementById('wordHintBtn');
            if (wordHintBtn) {
                wordHintBtn.textContent = 'Âõ∞Èõ£ÂñÆÂ≠óÊèêÁ§∫ (10‚≠ê)';
                wordHintBtn.disabled = false;
            }
        }

        // ‰ΩøÁî®Âõ∞Èõ£ÂñÆÂ≠óÊèêÁ§∫
        function useWordHint() {
            // ÂàùÂßãÂåñÊôÇÊ™¢Êü•ÊòüÊòü‰∏¶Ë®≠ÁΩÆÁãÄÊÖã
            if (wordHintState.currentIndex === 0) {
                if (gameState.stars < 10) {
                    alert('ÊòüÊòü‰∏çË∂≥ÔºÅ');
                    return;
                }
                
                // Á¨¨‰∏ÄÊ¨°ÈªûÊìäÊâ£Èô§ÊòüÊòü
                playSound('click');
                gameState.stars -= 10;
                updateDisplay();
                saveUserData();
                
                // Ë®≠ÁΩÆÂõ∞Èõ£ÂñÆÂ≠óÂàóË°®
                const difficultWords = gameState.currentQuestionData.difficultWords || [];
                wordHintState.words = difficultWords.map(word => ({
                    en: word,
                    zh: DIFFICULT_WORDS_TRANSLATION[word] || word
                }));
                wordHintState.totalWords = wordHintState.words.length;
                
                if (wordHintState.totalWords === 0) {
                    let hintDiv = document.getElementById('wordHintDiv');
                    if (!hintDiv) {
                        hintDiv = document.createElement('div');
                        hintDiv.id = 'wordHintDiv';
                        
                        // ÊèíÂÖ•Âà∞hint-buttonsÂçÄÂüü‰∏äÊñπ
                        const hintButtons = document.querySelector('.hint-buttons');
                        if (hintButtons) {
                            hintButtons.parentNode.insertBefore(hintDiv, hintButtons);
                        } else {
                            // ÂÇôÁî®ÊñπÊ°àÔºöÊèíÂÖ•Âà∞questionContainerÂæåÈù¢
                            const questionContainer = document.getElementById('questionContainer');
                            questionContainer.parentNode.insertBefore(hintDiv, questionContainer.nextSibling);
                        }
                    }
                    hintDiv.innerHTML = '<strong>Êú¨È°åÁÑ°Âõ∞Èõ£ÂñÆÂ≠ó„ÄÇ</strong>';
                    hintDiv.style.display = 'block';
                    
                    // Á¶ÅÁî®ÊåâÈàï
                    const wordHintBtn = document.getElementById('wordHintBtn');
                    wordHintBtn.textContent = 'Êú¨È°åÁÑ°Âõ∞Èõ£ÂñÆÂ≠ó';
                    wordHintBtn.disabled = true;
                    return;
                }
            }
            
            // È°ØÁ§∫Áï∂ÂâçÂõ∞Èõ£ÂñÆÂ≠ó
            if (wordHintState.currentIndex < wordHintState.totalWords) {
                const currentWord = wordHintState.words[wordHintState.currentIndex];
                
                let hintDiv = document.getElementById('wordHintDiv');
                if (!hintDiv) {
                    hintDiv = document.createElement('div');
                    hintDiv.id = 'wordHintDiv';
                    
                    // ÊèíÂÖ•Âà∞hint-buttonsÂçÄÂüü‰∏äÊñπ
                    const hintButtons = document.querySelector('.hint-buttons');
                    if (hintButtons) {
                        hintButtons.parentNode.insertBefore(hintDiv, hintButtons);
                    } else {
                        // ÂÇôÁî®ÊñπÊ°àÔºöÊèíÂÖ•Âà∞questionContainerÂæåÈù¢
                        const questionContainer = document.getElementById('questionContainer');
                        questionContainer.parentNode.insertBefore(hintDiv, questionContainer.nextSibling);
                    }
                }
                
                // Á¥ØÁ©çÈ°ØÁ§∫Â∑≤ÈªûÊìäÁöÑÂõ∞Èõ£ÂñÆÂ≠ó
                const displayedWords = wordHintState.words.slice(0, wordHintState.currentIndex + 1);
                hintDiv.innerHTML = `<strong>Âõ∞Èõ£ÂñÆÂ≠óÔºö</strong><br>` +
                    displayedWords.map(w => `<span class='word-block'>${w.en}</span> <span class='zh'>${w.zh}</span>`).join('<br>');
                hintDiv.style.display = 'block';
                
                wordHintState.currentIndex++;
                
                // Êõ¥Êñ∞ÊåâÈàïÁãÄÊÖã
                const wordHintBtn = document.getElementById('wordHintBtn');
                if (wordHintState.currentIndex < wordHintState.totalWords) {
                    wordHintBtn.textContent = `Âõ∞Èõ£ÂñÆÂ≠óÊèêÁ§∫ (${wordHintState.currentIndex}/${wordHintState.totalWords})`;
                } else {
                    wordHintBtn.textContent = 'Â∑≤È°ØÁ§∫ÂÆåÁï¢';
                    wordHintBtn.disabled = true;
                }
            }
        }

        // ‰ΩøÁî®Âà§Êñ∑ÈÇèËºØÊèêÁ§∫
        function useLogicHint() {
            if (gameState.stars < 20) {
                alert('ÊòüÊòü‰∏çË∂≥ÔºÅ');
                return;
            }
            playSound('click');
            gameState.stars -= 20;
            updateDisplay();
            saveUserData();
            
            // ËôïÁêÜÊèêÁ§∫ÂçÄÂ°ä - ÊèíÂÖ•Âà∞hint-buttonsÂçÄÂüü‰∏äÊñπ
            let logicHintDiv = document.getElementById('logicHintDiv');
            if (!logicHintDiv) {
                logicHintDiv = document.createElement('div');
                logicHintDiv.id = 'logicHintDiv';
                
                // ÊâæÂà∞hint-buttonsÂçÄÂüüÔºåÊèíÂÖ•Âà∞ÂÆÉÁöÑÂâçÈù¢
                const hintButtons = document.querySelector('.hint-buttons');
                if (hintButtons) {
                    hintButtons.parentNode.insertBefore(logicHintDiv, hintButtons);
                } else {
                    // ÂÇôÁî®ÊñπÊ°àÔºöÊèíÂÖ•Âà∞questionContainerÂæåÈù¢
                    const questionContainer = document.getElementById('questionContainer');
                    questionContainer.parentNode.insertBefore(logicHintDiv, questionContainer.nextSibling);
                }
            }
            
            // È°ØÁ§∫ÊèêÁ§∫ÂçÄÂ°ä
            logicHintDiv.style.display = 'block';
            // ‰ΩøÁî®È°åÁõÆÂ∞àÂ±¨ÁöÑÂà§Êñ∑ÊèêÁ§∫
            let logicHint = gameState.currentQuestionData.logicHint || 'Ë®ò‰ΩèÂè£Ë®£ÔºöIÁî®amÔºåyou/we/theyÁî®areÔºåhe/she/itÁî®is„ÄÇ';
            logicHintDiv.innerHTML = `<strong>Âà§Êñ∑ÈÇèËºØÊèêÁ§∫Ôºö</strong>${logicHint}`;
        }

        // Ë∑≥ÈÅéÊ≠§È°å
        function skipQuestion() {
            if (confirm('Á¢∫ÂÆöË¶ÅË∑≥ÈÅéÈÄôÈ°åÂóéÔºüË∑≥ÈÅéÂæåÁÑ°Ê≥ïËøîÂõû„ÄÇ')) {
                playSound('click');
                gameState.currentQuestion++;
                loadQuestion();
            }
        }

        // ‰∏ã‰∏ÄÈ°å
        function nextQuestion() {
            playSound('click');
            gameState.currentQuestion++;
            loadQuestion();
            document.getElementById('nextBtn').style.display = 'none';
        }

        // ÈñãÂßãË®àÊôÇÂô®
        function startTimer() {
            gameState.timer = setInterval(() => {
                gameState.timeLeft--;
                updateDisplay();
                
                if (gameState.timeLeft <= 0) {
                    endGame();
                }
            }, 1000);
        }

        // Êö´ÂÅú/ÁπºÁ∫åÂäüËÉΩ
        function pauseGame() {
            clearInterval(gameState.timer);
            document.getElementById('pauseBtn').style.display = 'none';
            document.getElementById('resumeBtn').style.display = 'inline-block';
        }
        function resumeGame() {
            startTimer();
            document.getElementById('pauseBtn').style.display = 'inline-block';
            document.getElementById('resumeBtn').style.display = 'none';
        }

        // Êõ¥Êñ∞È°ØÁ§∫
        function updateDisplay() {
            document.getElementById('timeLeft').textContent = formatTime(gameState.timeLeft);
            const maxScore = gameState.questions.length * 10;
            document.getElementById('currentScore').textContent = `${gameState.score}/${maxScore}`;
            document.getElementById('starCount').textContent = gameState.stars;
            
            // Êõ¥Êñ∞ÈÄ≤Â∫¶Ê¢ù
            const progress = (gameState.currentQuestion / gameState.questions.length) * 100;
            document.getElementById('progressFill').style.width = progress + '%';
            
            // Êõ¥Êñ∞Ë®àÊôÇÂô®È°èËâ≤
            const timerElement = document.getElementById('timeLeft');
            if (gameState.timeLeft <= 30) {
                timerElement.style.color = '#e53e3e';
            } else if (gameState.timeLeft <= 60) {
                timerElement.style.color = '#ed8936';
            } else {
                timerElement.style.color = '#2d3748';
            }
            
            // ÂêåÊ≠•Êõ¥Êñ∞LinkageSystemÁöÑÊòüÊòüÈ°ØÁ§∫
            if (typeof LinkageSystem !== 'undefined' && LinkageSystem.stars) {
                LinkageSystem.stars.updateDisplay();
            }
        }

        // Èö±ËóèÊâÄÊúâÊèêÁ§∫ÂçÄÂ°ä
        function hideAllHints() {
            // Èö±ËóèÂñÆÂ≠óÊèêÁ§∫
            const wordHintDiv = document.getElementById('wordHintDiv');
            if (wordHintDiv) {
                wordHintDiv.style.display = 'none';
            }
            // Èö±ËóèÂà§Êñ∑ÈÇèËºØÊèêÁ§∫
            const logicHintDiv = document.getElementById('logicHintDiv');
            if (logicHintDiv) {
                logicHintDiv.style.display = 'none';
            }
        }

        // Êõ¥Êñ∞ÈÄ≤Â∫¶
        function updateProgress() {
            const progress = (gameState.currentQuestion / gameState.questions.length) * 100;
            document.getElementById('progressFill').style.width = progress + '%';
        }

        // ÁµêÊùüÈÅäÊà≤
        function endGame() {
            gameState.isGameActive = false;
            clearInterval(gameState.timer);
            const resultModal = document.getElementById('resultModal');
            const resultTitle = document.getElementById('resultTitle');
            const resultScore = document.getElementById('resultScore');
            const resultMessage = document.getElementById('resultMessage');
            const maxScore = gameState.questions.length * 10;
            resultScore.textContent = `ÂàÜÊï∏Ôºö${gameState.score}/${maxScore}`;
            // Âà§Êñ∑ÁõÆÂâçÂ∞èÈóú
            let nextSub = null;
            if (gameState.currentSubLevel === 'sub1') nextSub = 'sub2';
            else if (gameState.currentSubLevel === 'sub2') nextSub = 'sub3';
            // ÈÄöÈóúÂà§Êñ∑
            if (gameState.score >= maxScore * 0.7) {
                if (nextSub) {
                    resultTitle.textContent = 'ÈöéÊÆµÂÆåÊàêÔºÅ';
                    resultTitle.style.color = '#38a169';
                    resultMessage.textContent = `‰Ω†ÂÆåÊàê‰∫Ü${LEVEL_CONFIG[gameState.currentSubLevel].name}ÔºÅÈªûÊìä‰∏ãÊñπÊåâÈàïÈÄ≤ÂÖ•‰∏ã‰∏ÄÈöéÊÆµ„ÄÇ`;
                } else {
                    resultTitle.textContent = 'ÊÅ≠ÂñúÈÄöÈóúÔºÅ';
                    resultTitle.style.color = '#38a169';
                    resultMessage.textContent = `‰Ω†ÊàêÂäüÂÆåÊàê‰∫Ü${LEVEL_CONFIG[gameState.currentSubLevel].name}ÔºÅÁç≤Âæó„Äåüåü BeÂãïË©ûÊòüÂÖâÁü≥„Äç1È°ÜÔºÅ`;
                    // ÁçéÂãµÂØ∂Áü≥
                    if (typeof gemSystem !== 'undefined') {
                        gemSystem.addGem('be_verb_master', 1);
                    }
                    playSound('complete');
                    playSound('unlock');
                    
                    // Êí≠ÊîæÈÄöÈóúËÉåÊôØÈü≥Ê®Ç‰∏¶Êö´ÂÅúËÉåÊôØÈü≥Ê®Ç
                    try {
                        // Êö´ÂÅúËÉåÊôØÈü≥Ê®Ç
                        if (window.bgMusic) {
                            window.bgMusic.pause();
                        }
                        
                        if (!window.kidsHappyMusic) {
                            window.kidsHappyMusic = new Audio('sound/kids-happy-background-music-366043.mp3');
                            window.kidsHappyMusic.volume = 0.7;
                        }
                        window.kidsHappyMusic.pause();
                        window.kidsHappyMusic.currentTime = 0;
                        const playPromise = window.kidsHappyMusic.play();
                        if (playPromise !== undefined) {
                            playPromise.catch(error => {
                                resultMessage.innerHTML += '<br><span style="color:#ff6b6b;font-size:1rem;">üéµ ÈÄöÈóúÈü≥Ê®ÇÊí≠ÊîæÂ§±ÊïóÔºåË´ãÊ™¢Êü•ÁÄèË¶ΩÂô®Ë®≠ÂÆö</span>';
                                console.warn('ÈÄöÈóúÈü≥Ê®ÇÊí≠ÊîæÂ§±Êïó', error);
                            });
                        }
                    } catch (e) {
                        resultMessage.innerHTML += '<br><span style="color:#ff6b6b;font-size:1rem;">üéµ ÈÄöÈóúÈü≥Ê®ÇÊí≠ÊîæÂ§±ÊïóÔºåË´ãÊ™¢Êü•ÁÄèË¶ΩÂô®Ë®≠ÂÆö</span>';
                        console.warn('ÈÄöÈóúÈü≥Ê®ÇÊí≠ÊîæÂ§±Êïó', e);
                    }
                }
            } else {
                resultTitle.textContent = 'ÊåëÊà∞Â§±Êïó';
                resultTitle.style.color = '#e53e3e';
                resultMessage.textContent = `ÂàÜÊï∏Êú™ÈÅî${Math.ceil(maxScore * 0.7)}ÂàÜÔºåË´ãÂÜçÊé•ÂÜçÂé≤ÔºÅ`;
            }
            saveUserData();
            // È°ØÁ§∫‰∏ã‰∏ÄÈöéÊÆµÊåâÈàï
            const actionBtns = resultModal.querySelector('.action-buttons');
            let nextBtn = document.getElementById('nextStageBtn');
            if (nextBtn) nextBtn.remove();
            if (nextSub && gameState.score >= maxScore * 0.7) {
                nextBtn = document.createElement('button');
                nextBtn.id = 'nextStageBtn';
                nextBtn.className = 'action-btn btn-primary';
                nextBtn.textContent = 'ÈÄ≤ÂÖ•‰∏ã‰∏ÄÈöéÊÆµ';
                nextBtn.onclick = function() {
                    playSound('click');
                    gameState.currentSubLevel = nextSub;
                    document.getElementById('resultModal').style.display = 'none';
                    initGame();
                };
                actionBtns.appendChild(nextBtn);
            }
            resultModal.style.display = 'flex';
        }

        // ÈáçÊñ∞ÈñãÂßãÈÅäÊà≤
        function restartGame() {
            playSound('click');
            document.getElementById('resultModal').style.display = 'none';
            initGame();
        }

        // ËøîÂõûÈÅ∏ÂñÆ
        function goToMenu() {
            playSound('click');
            window.location.href = 'index.html';
        }

        // ËøîÂõûÈ¶ñÈ†Å
        function goToHome() {
            playSound('click');
            window.location.href = 'index.html';
        }

        // Â∑•ÂÖ∑ÂáΩÊï∏
        function shuffleArray(array) {
            const shuffled = [...array];
            for (let i = shuffled.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
            }
            return shuffled;
        }

        function formatTime(seconds) {
            const minutes = Math.floor(seconds / 60);
            const remainingSeconds = seconds % 60;
            return `${minutes.toString().padStart(2, '0')}:${remainingSeconds.toString().padStart(2, '0')}`;
        }

        function createFallingLeaf() {
            const leaf = document.createElement('div');
            leaf.className = 'falling-leaf';
            leaf.style.left = Math.random() * window.innerWidth + 'px';
            document.body.appendChild(leaf);
            
            setTimeout(() => {
                document.body.removeChild(leaf);
            }, 2000);
        }

        function playSound(soundType) {
            // ‰ΩøÁî®Â∑≤ËºâÂÖ•ÁöÑÈü≥Êïà
            if (sounds[soundType]) {
                try {
                    const sound = sounds[soundType];
                    sound.pause();
                    sound.currentTime = 0;
                    sound.play().catch(error => {
                        console.log('Èü≥ÊïàÊí≠ÊîæÂ§±Êïó:', error);
                    });
                } catch (error) {
                    console.log('Èü≥ÊïàÊí≠ÊîæÈåØË™§:', error);
                }
            }
        }

        // È†ÅÈù¢ËºâÂÖ•ÂÆåÊàêÂæåÂàùÂßãÂåñÈÅäÊà≤
        window.onload = function() {
            initGame();
        };
    </script>
</body>
</html> 