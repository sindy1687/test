<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LinkageSystem æ¸¬è©¦</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f0f0f0;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
            font-weight: bold;
        }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .info { background: #d1ecf1; color: #0c5460; }
        .warning { background: #fff3cd; color: #856404; }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #0056b3;
        }
        .test-section {
            background: white;
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ”— LinkageSystem è¼‰å…¥æ¸¬è©¦</h1>
        
        <div id="status"></div>
        
        <div class="test-section">
            <h2>åŸºæœ¬è¼‰å…¥æ¸¬è©¦ï¼š</h2>
            <button onclick="testBasicLoading()">æ¸¬è©¦åŸºæœ¬è¼‰å…¥</button>
            <div id="basicTest"></div>
        </div>
        
        <div class="test-section">
            <h2>å¡ç‰‡ç³»çµ±æ¸¬è©¦ï¼š</h2>
            <button onclick="testCardSystem()">æ¸¬è©¦å¡ç‰‡ç³»çµ±</button>
            <button onclick="addTestCards()">æ·»åŠ æ¸¬è©¦å¡ç‰‡</button>
            <button onclick="clearTestCards()">æ¸…é™¤æ¸¬è©¦å¡ç‰‡</button>
            <div id="cardTest"></div>
        </div>
        
        <div class="test-section">
            <h2>æ˜Ÿæ˜Ÿç³»çµ±æ¸¬è©¦ï¼š</h2>
            <button onclick="testStarSystem()">æ¸¬è©¦æ˜Ÿæ˜Ÿç³»çµ±</button>
            <button onclick="addStars(10)">æ·»åŠ  10 é¡†æ˜Ÿæ˜Ÿ</button>
            <button onclick="addStars(50)">æ·»åŠ  50 é¡†æ˜Ÿæ˜Ÿ</button>
            <div id="starTest"></div>
        </div>
        
        <div class="test-section">
            <h2>ç©å®¶ç³»çµ±æ¸¬è©¦ï¼š</h2>
            <button onclick="testPlayerSystem()">æ¸¬è©¦ç©å®¶ç³»çµ±</button>
            <button onclick="setTestPlayer()">è¨­å®šæ¸¬è©¦ç©å®¶</button>
            <div id="playerTest"></div>
        </div>
        
        <div class="test-section">
            <h2>è©³ç´°èª¿è©¦è³‡è¨Šï¼š</h2>
            <button onclick="showDebugInfo()">é¡¯ç¤ºèª¿è©¦è³‡è¨Š</button>
            <div id="debugInfo"></div>
        </div>
    </div>

    <!-- è¼‰å…¥å¿…è¦çš„è…³æœ¬ -->
    <script src="js/userData.js"></script>
    
    <script>
        function updateStatus(message, type = 'info') {
            const statusDiv = document.getElementById('status');
            statusDiv.innerHTML = `<div class="status ${type}">${message}</div>`;
        }
        
        function updateTestResult(elementId, content) {
            const element = document.getElementById(elementId);
            element.innerHTML = content;
        }
        
        function testBasicLoading() {
            let result = '<h3>åŸºæœ¬è¼‰å…¥æ¸¬è©¦çµæœï¼š</h3>';
            
            // æª¢æŸ¥ userDataModuleLoaded
            if (window.userDataModuleLoaded) {
                result += '<p>âœ… userDataModuleLoaded å·²è¨­å®š</p>';
            } else {
                result += '<p>âŒ userDataModuleLoaded æœªè¨­å®š</p>';
            }
            
            // æª¢æŸ¥ LinkageSystem
            if (typeof window.LinkageSystem !== 'undefined') {
                result += '<p>âœ… window.LinkageSystem å·²è¼‰å…¥</p>';
                
                // æª¢æŸ¥å„å€‹å­ç³»çµ±
                const subsystems = ['stars', 'player', 'cards', 'music', 'progress', 'notifications'];
                subsystems.forEach(subsystem => {
                    if (window.LinkageSystem[subsystem]) {
                        result += `<p>âœ… ${subsystem} å­ç³»çµ±å¯ç”¨</p>`;
                    } else {
                        result += `<p>âŒ ${subsystem} å­ç³»çµ±ä¸å¯ç”¨</p>`;
                    }
                });
            } else {
                result += '<p>âŒ window.LinkageSystem æœªè¼‰å…¥</p>';
            }
            
            // æª¢æŸ¥å…¨åŸŸè®Šæ•¸
            if (typeof LinkageSystem !== 'undefined') {
                result += '<p>âœ… å…¨åŸŸ LinkageSystem è®Šæ•¸å¯ç”¨</p>';
            } else {
                result += '<p>âŒ å…¨åŸŸ LinkageSystem è®Šæ•¸ä¸å¯ç”¨</p>';
            }
            
            updateTestResult('basicTest', result);
            updateStatus('åŸºæœ¬è¼‰å…¥æ¸¬è©¦å®Œæˆ', 'success');
        }
        
        function testCardSystem() {
            let result = '<h3>å¡ç‰‡ç³»çµ±æ¸¬è©¦çµæœï¼š</h3>';
            
            if (typeof window.LinkageSystem === 'undefined' || !window.LinkageSystem.cards) {
                result += '<p>âŒ å¡ç‰‡ç³»çµ±ä¸å¯ç”¨</p>';
                updateTestResult('cardTest', result);
                return;
            }
            
            const cards = window.LinkageSystem.cards;
            
            // æ¸¬è©¦ getOwnedCards
            try {
                const ownedCards = cards.getOwnedCards();
                result += `<p>âœ… getOwnedCards() æˆåŠŸï¼Œè¿”å› ${Object.keys(ownedCards).length} å¼µå¡ç‰‡</p>`;
            } catch (e) {
                result += `<p>âŒ getOwnedCards() å¤±æ•—ï¼š${e.message}</p>`;
            }
            
            // æ¸¬è©¦ getShards
            try {
                const shards = cards.getShards();
                result += `<p>âœ… getShards() æˆåŠŸï¼Œè¿”å› ${Object.keys(shards).length} ç¨®ç¢ç‰‡</p>`;
            } catch (e) {
                result += `<p>âŒ getShards() å¤±æ•—ï¼š${e.message}</p>`;
            }
            
            // æ¸¬è©¦ addCard
            try {
                cards.addCard('test_card');
                result += '<p>âœ… addCard() æˆåŠŸ</p>';
            } catch (e) {
                result += `<p>âŒ addCard() å¤±æ•—ï¼š${e.message}</p>`;
            }
            
            // æ¸¬è©¦ isCardOwned
            try {
                const isOwned = cards.isCardOwned('test_card');
                result += `<p>âœ… isCardOwned() æˆåŠŸï¼Œtest_card æ“æœ‰ç‹€æ…‹ï¼š${isOwned}</p>`;
            } catch (e) {
                result += `<p>âŒ isCardOwned() å¤±æ•—ï¼š${e.message}</p>`;
            }
            
            updateTestResult('cardTest', result);
            updateStatus('å¡ç‰‡ç³»çµ±æ¸¬è©¦å®Œæˆ', 'success');
        }
        
        function addTestCards() {
            if (typeof window.LinkageSystem === 'undefined' || !window.LinkageSystem.cards) {
                updateStatus('âŒ å¡ç‰‡ç³»çµ±ä¸å¯ç”¨', 'error');
                return;
            }
            
            const testCards = ['apple', 'banana', 'orange', 'grape', 'strawberry'];
            testCards.forEach(card => {
                window.LinkageSystem.cards.addCard(card);
            });
            
            updateStatus(`âœ… å·²æ·»åŠ  ${testCards.length} å¼µæ¸¬è©¦å¡ç‰‡`, 'success');
            testCardSystem();
        }
        
        function clearTestCards() {
            if (typeof window.LinkageSystem === 'undefined' || !window.LinkageSystem.cards) {
                updateStatus('âŒ å¡ç‰‡ç³»çµ±ä¸å¯ç”¨', 'error');
                return;
            }
            
            const testCards = ['apple', 'banana', 'orange', 'grape', 'strawberry', 'test_card'];
            const ownedCards = window.LinkageSystem.cards.getOwnedCards();
            
            testCards.forEach(card => {
                delete ownedCards[card];
            });
            
            window.LinkageSystem.cards.setOwnedCards(ownedCards);
            
            updateStatus(`âœ… å·²æ¸…é™¤æ¸¬è©¦å¡ç‰‡`, 'success');
            testCardSystem();
        }
        
        function testStarSystem() {
            let result = '<h3>æ˜Ÿæ˜Ÿç³»çµ±æ¸¬è©¦çµæœï¼š</h3>';
            
            if (typeof window.LinkageSystem === 'undefined' || !window.LinkageSystem.stars) {
                result += '<p>âŒ æ˜Ÿæ˜Ÿç³»çµ±ä¸å¯ç”¨</p>';
                updateTestResult('starTest', result);
                return;
            }
            
            const stars = window.LinkageSystem.stars;
            
            // æ¸¬è©¦ get
            try {
                const currentStars = stars.get();
                result += `<p>âœ… get() æˆåŠŸï¼Œç•¶å‰æ˜Ÿæ˜Ÿï¼š${currentStars}</p>`;
            } catch (e) {
                result += `<p>âŒ get() å¤±æ•—ï¼š${e.message}</p>`;
            }
            
            // æ¸¬è©¦ add
            try {
                const before = stars.get();
                stars.add(5);
                const after = stars.get();
                result += `<p>âœ… add() æˆåŠŸï¼Œ${before} + 5 = ${after}</p>`;
            } catch (e) {
                result += `<p>âŒ add() å¤±æ•—ï¼š${e.message}</p>`;
            }
            
            updateTestResult('starTest', result);
            updateStatus('æ˜Ÿæ˜Ÿç³»çµ±æ¸¬è©¦å®Œæˆ', 'success');
        }
        
        function addStars(amount) {
            if (typeof window.LinkageSystem === 'undefined' || !window.LinkageSystem.stars) {
                updateStatus('âŒ æ˜Ÿæ˜Ÿç³»çµ±ä¸å¯ç”¨', 'error');
                return;
            }
            
            window.LinkageSystem.stars.add(amount);
            updateStatus(`âœ… å·²æ·»åŠ  ${amount} é¡†æ˜Ÿæ˜Ÿ`, 'success');
            testStarSystem();
        }
        
        function testPlayerSystem() {
            let result = '<h3>ç©å®¶ç³»çµ±æ¸¬è©¦çµæœï¼š</h3>';
            
            if (typeof window.LinkageSystem === 'undefined' || !window.LinkageSystem.player) {
                result += '<p>âŒ ç©å®¶ç³»çµ±ä¸å¯ç”¨</p>';
                updateTestResult('playerTest', result);
                return;
            }
            
            const player = window.LinkageSystem.player;
            
            // æ¸¬è©¦ getName
            try {
                const name = player.getName();
                result += `<p>âœ… getName() æˆåŠŸï¼Œç©å®¶åç¨±ï¼š${name}</p>`;
            } catch (e) {
                result += `<p>âŒ getName() å¤±æ•—ï¼š${e.message}</p>`;
            }
            
            // æ¸¬è©¦ getAvatar
            try {
                const avatar = player.getAvatar();
                result += `<p>âœ… getAvatar() æˆåŠŸï¼Œé ­åƒï¼š${avatar}</p>`;
            } catch (e) {
                result += `<p>âŒ getAvatar() å¤±æ•—ï¼š${e.message}</p>`;
            }
            
            updateTestResult('playerTest', result);
            updateStatus('ç©å®¶ç³»çµ±æ¸¬è©¦å®Œæˆ', 'success');
        }
        
        function setTestPlayer() {
            if (typeof window.LinkageSystem === 'undefined' || !window.LinkageSystem.player) {
                updateStatus('âŒ ç©å®¶ç³»çµ±ä¸å¯ç”¨', 'error');
                return;
            }
            
            window.LinkageSystem.player.setName('æ¸¬è©¦ç©å®¶');
            window.LinkageSystem.player.setAvatar('img/avatars/avatar_TL.png');
            
            updateStatus('âœ… å·²è¨­å®šæ¸¬è©¦ç©å®¶è³‡æ–™', 'success');
            testPlayerSystem();
        }
        
        function showDebugInfo() {
            let result = '<h3>è©³ç´°èª¿è©¦è³‡è¨Šï¼š</h3>';
            
            // æª¢æŸ¥æ‰€æœ‰ç›¸é—œçš„å…¨åŸŸè®Šæ•¸
            const globalVars = [
                'userDataModuleLoaded',
                'LinkageSystem',
                'window.LinkageSystem',
                'window.userDataModuleLoaded'
            ];
            
            globalVars.forEach(varName => {
                try {
                    const value = eval(varName);
                    if (value !== undefined) {
                        result += `<p>âœ… ${varName} = ${typeof value === 'object' ? 'Object' : value}</p>`;
                    } else {
                        result += `<p>âŒ ${varName} = undefined</p>`;
                    }
                } catch (e) {
                    result += `<p>âŒ ${varName} éŒ¯èª¤ï¼š${e.message}</p>`;
                }
            });
            
            // æª¢æŸ¥ localStorage
            result += '<h4>localStorage æª¢æŸ¥ï¼š</h4>';
            const localStorageKeys = ['ownedCards', 'cardShards', 'totalStars', 'playerName', 'selectedAvatar'];
            localStorageKeys.forEach(key => {
                const value = localStorage.getItem(key);
                if (value) {
                    result += `<p>âœ… ${key} = ${value.substring(0, 50)}${value.length > 50 ? '...' : ''}</p>`;
                } else {
                    result += `<p>âŒ ${key} = null</p>`;
                }
            });
            
            updateTestResult('debugInfo', result);
            updateStatus('èª¿è©¦è³‡è¨Šé¡¯ç¤ºå®Œæˆ', 'success');
        }
        
        // é é¢è¼‰å…¥å®Œæˆå¾ŒåŸ·è¡Œ
        window.addEventListener('load', function() {
            console.log('é é¢è¼‰å…¥å®Œæˆï¼Œé–‹å§‹æ¸¬è©¦...');
            
            setTimeout(() => {
                testBasicLoading();
                updateStatus('é é¢è¼‰å…¥å®Œæˆï¼Œè«‹é»æ“ŠæŒ‰éˆ•é€²è¡Œæ¸¬è©¦', 'info');
            }, 500);
        });
    </script>
</body>
</html> 