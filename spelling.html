<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <title>è‹±æ‰“å°è‹±é›„ - è‡ªè¨‚é—œå¡</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="responsive_enhanced.css">
  <style>
    /* èƒŒæ™¯ï¼šæ˜Ÿç©ºèˆ‡æ¼¸å±¤ */
    body {
      margin: 0;
      padding: 0;
      overflow: auto;
      font-family: 'Orbitron', sans-serif;
      color: #fff;
      background: linear-gradient(to bottom, #020111 0%, #000010 100%);
    }
    /* æ˜Ÿç©ºç²’å­ */
    #starfield {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: 0;
      pointer-events: none;
    }
    /* ä¸»è¦å®¹å™¨ */
    #container {
      position: relative;
      z-index: 1;
      max-width: 500px;
      margin: 40px auto;
      padding: 20px;
      background: rgba(10, 20, 40, 0.7);
      border: 2px solid #00ffff;
      border-radius: 16px;
      box-shadow: 0 0 32px #00ffff44, 0 0 80px #a259ff22 inset;
      backdrop-filter: blur(8px);
    }
    /* è¿”å›é¦–é æŒ‰éˆ• */
    .home-btn {
      position: absolute;
      top: 20px;
      left: 20px;
      background: linear-gradient(90deg, #00ffff 0%, #a259ff 100%);
      color: #000;
      font-weight: bold;
      padding: 8px 16px;
      border-radius: 8px;
      box-shadow: 0 0 16px #00ffff;
      text-decoration: none;
      z-index: 2;
      transition: transform 0.2s, box-shadow 0.2s;
      font-family: 'Orbitron', sans-serif;
    }
    .home-btn:hover {
      transform: scale(1.1);
      box-shadow: 0 0 32px #00ffff;
    }
    /* æˆå°±é é¢æŒ‰éˆ• */
    .achievement-btn {
      position: absolute;
      top: 20px;
      left: 140px;
      background: linear-gradient(90deg, #ffd700 0%, #ffed4e 100%);
      color: #000;
      font-weight: bold;
      padding: 8px 16px;
      border-radius: 8px;
      box-shadow: 0 0 16px #ffd700;
      text-decoration: none;
      z-index: 2;
      transition: transform 0.2s, box-shadow 0.2s;
      font-family: 'Orbitron', sans-serif;
    }
    .achievement-btn:hover {
      transform: scale(1.1);
      box-shadow: 0 0 32px #ffd700;
    }
    /* ç¸½æ˜Ÿæ˜Ÿé¡¯ç¤º */
    #totalStars {
      position: absolute;
      top: 20px;
      right: 20px;
      background: rgba(10, 20, 40, 0.85);
      padding: 8px 14px;
      border-radius: 10px;
      box-shadow: 0 0 12px #ffd700, 0 0 32px #00ffff;
      border: 2px solid #00ffff;
      color: #ffd700;
      font-size: 1.2rem;
      font-weight: bold;
      z-index: 2;
      font-family: 'Orbitron', sans-serif;
    }
    /* æ¨™é¡Œ */
    h1 {
      margin-top: 60px;
      font-size: 2rem;
      letter-spacing: 1px;
      color: #00ffff;
      text-shadow: 0 0 12px #00ffff, 0 0 32px #a259ff;
      z-index: 2;
      font-family: 'Orbitron', sans-serif;
      text-align: center;
    }
    /* é¡Œæ•¸é¡¯ç¤º */
    #questionCount {
      margin: 10px auto;
      font-size: 1.2rem;
      color: #a0a0ff;
      text-align: center;
      z-index: 2;
      font-family: 'Orbitron', sans-serif;
      text-shadow: 0 0 6px #00ffff;
    }
    /* æç¤ºå¥ï¼ˆä¸­æ–‡ï¼‰ */
    #wordDisplay {
      margin: 20px auto;
      font-size: 2.4rem;
      font-weight: bold;
      color: #ffd700;
      text-shadow: 0 0 8px #ffd700;
      animation: glow 2s ease-in-out infinite alternate;
      z-index: 2;
      font-family: 'Orbitron', sans-serif;
      text-align: center;
    }
    @keyframes glow {
      from { text-shadow: 0 0 8px #ffd700; }
      to { text-shadow: 0 0 16px #ffd700, 0 0 32px #00ffff; }
    }
    /* è¨ˆæ™‚å™¨ */
    #timerDisplay {
      font-size: 1.1rem;
      color: #00ffff;
      margin-bottom: 15px;
      z-index: 2;
      font-family: 'Orbitron', sans-serif;
      text-align: center;
      text-shadow: 0 0 6px #00ffff;
    }
    #timerDisplay.danger { animation: flash 1s infinite; }
    @keyframes flash {
      0%, 100% { color: #00ffff; }
      50% { color: #ff4444; }
    }
    /* è¼¸å…¥æ¡† */
    #answerInput {
      font-family: 'Roboto Mono', monospace;
      font-size: 1.3rem;
      padding: 16px 20px;
      border-radius: 16px;
      border: 3px solid #00ffff;
      width: 85%;
      max-width: 450px;
      background: rgba(10, 20, 40, 0.8);
      color: #fff;
      box-shadow: 
        0 0 20px #00ffff80,
        inset 0 2px 4px rgba(255, 255, 255, 0.1);
      text-align: center;
      outline: none;
      margin-bottom: 20px;
      display: block;
      margin-left: auto;
      margin-right: auto;
      transition: all 0.3s ease;
      letter-spacing: 1px;
      font-weight: 500;
    }
    #answerInput:focus {
      border-color: #ffd700;
      box-shadow: 
        0 0 30px #ffd70080,
        0 0 50px #00ffff40,
        inset 0 2px 4px rgba(255, 255, 255, 0.2);
      transform: translateY(-2px);
      background: rgba(10, 20, 40, 0.9);
    }
    #answerInput::placeholder {
      color: rgba(255, 255, 255, 0.5);
      font-style: italic;
    }
    #answerInput.correct {
      border-color: #00ff00;
      box-shadow: 0 0 30px #00ff0080;
      animation: correctPulse 0.6s ease;
    }
    #answerInput.wrong {
      border-color: #ff4444;
      box-shadow: 0 0 30px #ff444480;
      animation: wrongShake 0.6s ease;
    }
    @keyframes correctPulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.02); }
    }
    @keyframes wrongShake {
      0%, 100% { transform: translateX(0); }
      25% { transform: translateX(-5px); }
      75% { transform: translateX(5px); }
    }
    
    /* å›é¥‹è¨Šæ¯ */
    #feedback {
      height: 40px;
      font-size: 1.2rem;
      font-weight: bold;
      margin: 15px 0;
      z-index: 2;
      font-family: 'Orbitron', sans-serif;
      text-align: center;
      color: #ffd700;
      text-shadow: 0 0 8px #00ffff;
      transition: all 0.3s ease;
    }
    #feedback.correct {
      color: #00ff00;
      text-shadow: 0 0 12px #00ff00;
      animation: feedbackBounce 0.6s ease;
    }
    #feedback.wrong {
      color: #ff4444;
      text-shadow: 0 0 12px #ff4444;
      animation: feedbackBounce 0.6s ease;
    }
    @keyframes feedbackBounce {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.1); }
    }
    
    /* é€²åº¦æ¢ */
    #progressBar {
      width: 100%;
      height: 8px;
      background: rgba(0, 255, 255, 0.2);
      border-radius: 4px;
      margin: 15px 0;
      overflow: hidden;
      position: relative;
    }
    #progressFill {
      height: 100%;
      background: linear-gradient(90deg, #00ffff, #a259ff);
      border-radius: 4px;
      transition: width 0.3s ease;
      width: 0%;
      position: relative;
    }
    #progressFill::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
      animation: progressShine 2s infinite;
    }
    @keyframes progressShine {
      0% { transform: translateX(-100%); }
      100% { transform: translateX(100%); }
    }
    
    /* æç¤ºå€åŸŸ */
    #hintArea {
      margin: 15px 0;
      padding: 10px;
      background: rgba(0, 255, 255, 0.1);
      border-radius: 8px;
      border: 1px solid rgba(0, 255, 255, 0.3);
      text-align: center;
      font-size: 0.9rem;
      color: #a0a0ff;
      font-family: 'Orbitron', sans-serif;
    }
    #hintArea.show {
      animation: hintFadeIn 0.5s ease;
    }
    @keyframes hintFadeIn {
      from { opacity: 0; transform: translateY(-10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    /* æŒ‰éˆ•åˆ— */
    .btn-row {
      display: flex;
      justify-content: center;
      gap: 15px;
      flex-wrap: wrap;
      margin-top: 25px;
      z-index: 2;
    }
    .btn-row button {
      font-family: 'Orbitron', sans-serif;
      font-size: 1rem;
      padding: 14px 24px;
      border-radius: 12px;
      border: none;
      cursor: pointer;
      background: linear-gradient(90deg, #00ffff 0%, #a259ff 100%);
      color: #000;
      font-weight: bold;
      box-shadow: 0 0 16px #00ffff, 0 0 24px #a259ff99;
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
    }
    .btn-row button::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
      transition: left 0.5s;
    }
    .btn-row button:hover::before {
      left: 100%;
    }
    .btn-row button:hover {
      transform: translateY(-3px) scale(1.05);
      box-shadow: 0 0 25px #00ffff, 0 0 35px #a259ffcc;
    }
    .btn-row button:active {
      transform: translateY(-1px) scale(1.02);
    }
    .btn-row button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none;
    }
    #speakBtn {
      background: linear-gradient(90deg, #ffd700 0%, #ffaa00 100%);
      color: #000;
    }
    #hintBtn {
      background: linear-gradient(90deg, #a259ff 0%, #ff6b6b 100%);
      color: #fff;
    }
    /* æ¨¡æ…‹è¦–çª— */
    .modal {
      display: none;
      position: fixed;
      z-index: 10;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.8);
      align-items: center;
      justify-content: center;
      overflow-y: auto;
    }
    .modal-content {
      background: rgba(10, 20, 40, 0.95);
      padding: 30px;
      border: 2px solid #00ffff;
      border-radius: 16px;
      color: #fff;
      max-width: 500px;
      width: 85%;
      text-align: center;
      box-shadow: 0 0 32px #00ffff99, 0 0 80px #a259ff44 inset;
      font-family: 'Orbitron', sans-serif;
      margin: 20px;
    }
    .modal-content h2 {
      margin-bottom: 15px;
      color: #00ffff;
      text-shadow: 0 0 12px #00ffff, 0 0 32px #a259ff;
      font-size: 1.5rem;
      font-family: 'Orbitron', sans-serif;
    }
    .modal-content p {
      margin: 8px 0;
      font-size: 0.95rem;
      font-family: 'Orbitron', sans-serif;
      color: #a0a0ff;
    }
    .modal-content ul {
      list-style: none;
      padding: 0;
      max-height: 140px;
      overflow-y: auto;
      margin: 15px 0;
      text-align: left;
      font-size: 0.9rem;
      font-family: 'Roboto Mono', monospace;
      color: #fff;
    }
    .modal-content ul li {
      margin: 6px 0;
      padding: 4px 8px;
      background: rgba(0, 255, 255, 0.1);
      border-radius: 4px;
    }
    /*-------------------------
      éŸ¿æ‡‰å¼è¨­è¨ˆ
    -------------------------*/
    @media (max-width: 768px) {
      #container {
        margin: 20px 15px;
        padding: 15px;
        border-radius: 12px;
      }
      
      h1 {
        font-size: 1.6rem;
        margin-top: 50px;
      }
      
      #wordDisplay {
        font-size: 2rem;
      }
      
      #answerInput {
        font-size: 1.2rem;
        padding: 14px 16px;
        width: 90%;
      }
      
      .btn-row {
        gap: 10px;
      }
      
      .btn-row button {
        padding: 12px 16px;
        font-size: 0.9rem;
      }
      
      .home-btn {
        top: 15px;
        left: 15px;
        padding: 6px 12px;
        font-size: 0.9rem;
      }
      
      .achievement-btn {
        top: 15px;
        left: 110px;
        padding: 6px 12px;
        font-size: 0.9rem;
      }
      
      #totalStars {
        top: 15px;
        right: 15px;
        padding: 6px 10px;
        font-size: 1rem;
      }
    }
    
    @media (max-width: 480px) {
      #container {
        margin: 15px 10px;
        padding: 12px;
      }
      
      h1 {
        font-size: 1.4rem;
        margin-top: 45px;
      }
      
      #wordDisplay {
        font-size: 1.8rem;
      }
      
      #answerInput {
        font-size: 1.1rem;
        padding: 12px 14px;
        width: 95%;
      }
      
      .btn-row {
        flex-direction: column;
        gap: 8px;
      }
      
      .btn-row button {
        width: 100%;
        padding: 14px;
      }
      
      #questionCount {
        font-size: 1rem;
      }
      
      #timerDisplay {
        font-size: 1rem;
      }
      
      .home-btn {
        top: 10px;
        left: 10px;
        padding: 5px 10px;
        font-size: 0.8rem;
      }
      
      .achievement-btn {
        top: 10px;
        left: 90px;
        padding: 5px 10px;
        font-size: 0.8rem;
      }
      
      #totalStars {
        top: 10px;
        right: 10px;
        padding: 5px 8px;
        font-size: 0.9rem;
      }
    }
    
    /*-------------------------
      è¼‰å…¥å‹•ç•«
    -------------------------*/
    .loading {
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 3px solid rgba(0, 255, 255, 0.3);
      border-radius: 50%;
      border-top-color: #00ffff;
      animation: spin 1s ease-in-out infinite;
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    
    /*-------------------------
      è¼¸å…¥æ¡†è‡ªå‹•å®Œæˆæ¨£å¼
    -------------------------*/
    #answerInput:-webkit-autofill,
    #answerInput:-webkit-autofill:hover,
    #answerInput:-webkit-autofill:focus {
      -webkit-text-fill-color: #fff;
      -webkit-box-shadow: 0 0 0px 1000px rgba(10, 20, 40, 0.9) inset;
      transition: background-color 5000s ease-in-out 0s;
    }
    
    /*-------------------------
      æŒ‰éˆ•ç¦ç”¨ç‹€æ…‹
    -------------------------*/
    .btn-row button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none !important;
      box-shadow: 0 0 8px rgba(0, 255, 255, 0.3) !important;
    }
    
    /*-------------------------
      ç„¦é»æŒ‡ç¤ºå™¨
    -------------------------*/
    .btn-row button:focus,
    #answerInput:focus {
      outline: 2px solid #ffd700;
      outline-offset: 2px;
    }
    
    /*-------------------------
      å‹•ç•«å„ªåŒ–
    -------------------------*/
    @media (prefers-reduced-motion: reduce) {
      * {
        animation-duration: 0.01ms !important;
        animation-iteration-count: 1 !important;
        transition-duration: 0.01ms !important;
      }
    }
  </style>
</head>
<body>
  <canvas id="starfield"></canvas>
  <div id="container">
    <a href="index.html" class="home-btn">â† è¿”å›é¦–é </a>
    <a href="achievement.html" class="achievement-btn">æˆå°±é é¢</a>
    <div id="totalStars">ç¸½æ˜Ÿæ˜Ÿï¼š<span id="totalStarCount">0</span> â­</div>
    <h1>â­ è‡ªè¨‚é—œå¡ï¼š<span id="categoryName"></span></h1>
    <div id="questionCount">
      ç¬¬ <span id="currentQuestion">0</span> é¡Œ / <span id="maxQuestions">0</span> é¡Œ
    </div>
    <div id="wordDisplay">æº–å‚™ä¸­...</div>
    <div id="timerDisplay">â± æ™‚é–“ï¼š<span id="timeLeft">30</span> ç§’</div>
    
    <!-- é€²åº¦æ¢ -->
    <div id="progressBar">
      <div id="progressFill"></div>
    </div>
    
    <input type="text" id="answerInput" placeholder="è«‹è¼¸å…¥è‹±æ–‡..." autocomplete="off" />
    <div id="feedback"></div>
    
    <!-- æç¤ºå€åŸŸ -->
    <div id="hintArea" style="display: none;">
      <div id="hintText"></div>
    </div>
    
    <div class="btn-row">
      <button onclick="checkAnswer()">âœ… é€å‡º</button>
      <button onclick="skipWord()">â­ï¸ è·³é</button>
      <button id="speakBtn" onclick="speakCurrentWord()">ğŸ”ˆ ç™¼éŸ³</button>
      <button id="hintBtn" onclick="showHint()">ğŸ’¡ æç¤º</button>
      <button onclick="restartGame()">ğŸ” é‡ç©</button>
    </div>

    <!-- çµç®—é¢æ¿ -->
    <div id="resultModal" class="modal">
      <div class="modal-content">
        <h2>é—œå¡çµç®—</h2>
        <p>â˜… æœ¬æ¬¡ç²å¾—æ˜Ÿæ˜Ÿï¼š<span id="sessionStars">0</span></p>
        <p>âœ… ç­”å°é¡Œæ•¸ï¼š<span id="sessionCorrect">0</span></p>
        <p>âŒ ç­”éŒ¯é¡Œæ•¸ï¼š<span id="sessionWrong">0</span></p>
        <p>â­ ç´¯ç©ç¸½æ˜Ÿæ˜Ÿï¼š<span id="sessionTotal">0</span></p>
        <button id="wrongBtn" onclick="showWrongModal()">éŒ¯é¡Œè¤‡ç¿’</button>
        <button onclick="restartGame()">é‡æ–°é–‹å§‹</button>
        <button onclick="goHome()">è¿”å›é¦–é </button>
      </div>
    </div>

    <!-- éŒ¯é¡Œè¤‡ç¿’é¢æ¿ -->
    <div id="wrongModal" class="modal">
      <div class="modal-content">
        <h2>éŒ¯é¡Œè¤‡ç¿’</h2>
        <ul id="wrongItems"></ul>
        <button onclick="closeWrongModal()">é—œé–‰</button>
      </div>
    </div>
  </div>

  <script src="js/sound.js"></script>
  <script src="js/starRewardSystem.js"></script>
  <script src="js/achievementSystem.js"></script>
  <script>
    // åˆå§‹åŒ–éŸ³æ•ˆç³»çµ±
    if (typeof SoundSystem !== 'undefined') {
      SoundSystem.speech.init();
    }

    // æ˜Ÿç©ºèƒŒæ™¯
    const starCanvas = document.getElementById('starfield');
    const ctx = starCanvas.getContext('2d');
    let width = window.innerWidth;
    let height = window.innerHeight;
    starCanvas.width = width;
    starCanvas.height = height;

    const starsBg = [];
    function initStars() {
      starsBg.length = 0;
      for (let i = 0; i < 100; i++) {
        starsBg.push({
          x: Math.random() * width,
          y: Math.random() * height,
          r: Math.random() * 1.2 + 0.3,
          alpha: Math.random(),
          twinkle: Math.random() * 5
        });
      }
    }

    function drawStars() {
      ctx.clearRect(0, 0, width, height);
      starsBg.forEach(s => {
        s.twinkle += 0.02;
        s.alpha = Math.abs(Math.sin(s.twinkle));
        ctx.beginPath();
        ctx.arc(s.x, s.y, s.r, 0, Math.PI * 2);
        ctx.fillStyle = `rgba(255, 255, 255, ${s.alpha})`;
        ctx.fill();
      });
      requestAnimationFrame(drawStars);
    }

    window.addEventListener('resize', () => {
      width = window.innerWidth;
      height = window.innerHeight;
      starCanvas.width = width;
      starCanvas.height = height;
      initStars();
    });

    initStars();
    drawStars();

    // TTS voices è¼‰å…¥
    // ä½¿ç”¨æ–°çš„ç™¼éŸ³ç³»çµ±ï¼Œç§»é™¤èˆŠçš„èªéŸ³è¼‰å…¥é‚è¼¯

    function speak(text) {
      if (!text) return;
      SoundSystem.speech.speakWord(text);
    }

    function speakCurrentWord() {
      if (!current) return;
      SoundSystem.speech.speakWord(current.word);
    }

    // è‡ªå»ºé¡Œåº«ï¼šå¾ localStorage è®€å–æ›¸æœ¬
    const params = new URLSearchParams(location.search);
    const bookName = params.get('book');
    if (!bookName) {
      alert('åƒæ•¸éŒ¯èª¤ï¼šç¼ºå°‘ bookã€‚');
      history.back();
    }
    document.getElementById('categoryName').textContent = bookName;

    let allVocab = JSON.parse(localStorage.getItem('book_' + bookName) || '[]');
    if (!Array.isArray(allVocab) || allVocab.length < 1) {
      alert('æ­¤å–®å­—æœ¬æ²’æœ‰ä»»ä½•å–®å­—ï¼Œç„¡æ³•éŠç©ã€‚');
      history.back();
    }

    // æ‰“äº‚å¾Œå–å‰ 20 ç­†
    shuffleArray(allVocab);
    const maxQuestions = Math.min(20, allVocab.length);
    let words = allVocab.slice(0, maxQuestions).map(item => ({
      zh: item.meaning,
      word: item.word
    }));

    document.getElementById('maxQuestions').textContent = maxQuestions;

    let current = null;
    let used = [];
    let wrongList = [];
    let correctCount = 0;
    let timer = null;
    let timeLeft = 30;
    let hintUsed = false;
    
    // ===== æ–°å¢ï¼šéŠæˆ²ç‹€æ…‹è¿½è¹¤ =====
    let gameStats = {
      correctCount: 0,
      totalAnswered: 0,
      consecutiveCorrect: 0, // é€£çºŒç­”å°æ¬¡æ•¸
      fastestAnswer: Infinity, // æœ€å¿«ç­”é¡Œæ™‚é–“
      slowestAnswer: 0, // æœ€æ…¢ç­”é¡Œæ™‚é–“
      totalTimeUsed: 0, // ç¸½ç”¨æ™‚
      perfectAnswers: 0, // å®Œç¾ç­”é¡Œæ¬¡æ•¸ï¼ˆ10ç§’å…§ç­”å°ï¼‰
      hintUsedCount: 0, // ä½¿ç”¨æç¤ºæ¬¡æ•¸
      startTime: Date.now()
    };

    let totalStarCount = parseInt(localStorage.getItem('totalStars') || '0', 10);
    function updateTotal() {
      document.getElementById('totalStarCount').textContent = totalStarCount;
    }

    function updateQuestionCount() {
      document.getElementById('currentQuestion').textContent = used.length;
    }

    function updateProgressBar() {
      const progress = (used.length / maxQuestions) * 100;
      document.getElementById('progressFill').style.width = progress + '%';
    }
    
    // ===== æ–°å¢ï¼šæ˜Ÿæ˜Ÿçå‹µè¨ˆç®—å‡½æ•¸ =====
    function calculateStarReward(isCorrect, answerTime, consecutiveCount, wordLength, hintUsed) {
      if (!isCorrect) return 0;
      
      let baseReward = 1; // åŸºç¤çå‹µ
      
      // æ™‚é–“çå‹µï¼šè¶Šå¿«ç­”å°çå‹µè¶Šå¤š
      if (answerTime <= 5) {
        baseReward += 3; // 5ç§’å…§ +3æ˜Ÿ
      } else if (answerTime <= 10) {
        baseReward += 2; // 10ç§’å…§ +2æ˜Ÿ
      } else if (answerTime <= 15) {
        baseReward += 1; // 15ç§’å…§ +1æ˜Ÿ
      }
      
      // é€£æ“Šçå‹µï¼šé€£çºŒç­”å°è¶Šå¤šçå‹µè¶Šå¤š
      if (consecutiveCount >= 5) {
        baseReward += 3; // 5é€£æ“Š +3æ˜Ÿ
      } else if (consecutiveCount >= 3) {
        baseReward += 2; // 3é€£æ“Š +2æ˜Ÿ
      } else if (consecutiveCount >= 2) {
        baseReward += 1; // 2é€£æ“Š +1æ˜Ÿ
      }
      
      // å–®å­—é›£åº¦çå‹µï¼šæ ¹æ“šå–®å­—é•·åº¦çµ¦äºˆé¡å¤–çå‹µ
      if (wordLength >= 8) {
        baseReward += 2; // é•·å–®å­—é¡å¤–çå‹µ
      } else if (wordLength >= 6) {
        baseReward += 1; // ä¸­ç­‰é•·åº¦å–®å­—çå‹µ
      }
      
      // å–®å­—æœ¬é¡å‹çå‹µ
      if (bookName.includes('æ‰˜ç¦') || bookName.includes('TOEFL')) {
        baseReward += 1; // æ‰˜ç¦å–®å­—é¡å¤–çå‹µ
      } else if (bookName.includes('è‹±æª¢') || bookName.includes('GEPT')) {
        baseReward += 1; // è‹±æª¢å–®å­—é¡å¤–çå‹µ
      }
      
      // æç¤ºä½¿ç”¨æ‡²ç½°
      if (hintUsed) {
        baseReward = Math.max(1, baseReward - 1); // ä½¿ç”¨æç¤ºæ‰£1æ˜Ÿï¼Œä½†æœ€å°‘1æ˜Ÿ
      }
      
      return baseReward;
    }
    
    // ===== æ–°å¢ï¼šé¡¯ç¤ºçå‹µå‹•ç•« =====
    function showRewardAnimation(starsEarned, reason = '') {
      const rewardDiv = document.createElement('div');
      rewardDiv.style.cssText = `
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: linear-gradient(135deg, rgba(255, 215, 0, 0.95), rgba(255, 170, 0, 0.95));
        color: #000;
        padding: 20px 30px;
        border-radius: 15px;
        font-size: 1.5rem;
        font-weight: bold;
        z-index: 1000;
        box-shadow: 0 0 30px #ffd700;
        animation: rewardPop 1.2s ease-out forwards;
        font-family: 'Orbitron', sans-serif;
        text-align: center;
        min-width: 300px;
      `;
      
      let reasonText = '';
      if (reason) {
        reasonText = `<div style="font-size: 1rem; margin-top: 8px; color: #666;">${reason}</div>`;
      }
      
      rewardDiv.innerHTML = `
        <div style="font-size: 3rem; margin-bottom: 10px;">â­</div>
        <div style="font-size: 1.8rem; margin-bottom: 5px;">+${starsEarned} æ˜Ÿæ˜Ÿ</div>
        ${reasonText}
      `;
      
      // æ·»åŠ å‹•ç•«æ¨£å¼
      const style = document.createElement('style');
      style.textContent = `
        @keyframes rewardPop {
          0% { transform: translate(-50%, -50%) scale(0.5); opacity: 0; }
          50% { transform: translate(-50%, -50%) scale(1.2); opacity: 1; }
          100% { transform: translate(-50%, -50%) scale(1); opacity: 0; }
        }
      `;
      document.head.appendChild(style);
      
      document.body.appendChild(rewardDiv);
      
      // æ’­æ”¾æ˜Ÿæ˜ŸéŸ³æ•ˆ
      if (typeof StarRewardSystem !== 'undefined') {
        StarRewardSystem.playStarSound();
      }
      
      // 2.5ç§’å¾Œç§»é™¤
      setTimeout(() => {
        if (document.body.contains(rewardDiv)) {
          document.body.removeChild(rewardDiv);
        }
        if (document.head.contains(style)) {
          document.head.removeChild(style);
        }
      }, 2500);
    }
    
    // ===== æ–°å¢ï¼šé¡¯ç¤ºé€£æ“Šé€šçŸ¥ =====
    function showComboNotification(comboCount) {
      if (comboCount < 2) return;
      
      const comboDiv = document.createElement('div');
      comboDiv.style.cssText = `
        position: fixed;
        top: 20%;
        left: 50%;
        transform: translateX(-50%);
        background: linear-gradient(135deg, rgba(255, 69, 0, 0.9), rgba(255, 140, 0, 0.9));
        color: #fff;
        padding: 15px 25px;
        border-radius: 25px;
        font-size: 1.2rem;
        font-weight: bold;
        z-index: 1000;
        box-shadow: 0 0 20px #ff4500;
        animation: comboSlide 0.8s ease-out forwards;
        font-family: 'Orbitron', sans-serif;
      `;
      
      let comboText = '';
      let comboIcon = '';
      
      if (comboCount >= 5) {
        comboText = `${comboCount} é€£æ“Šï¼ğŸ”¥ ç„¡æ•µé€£æ“Šï¼`;
        comboIcon = 'ğŸ”¥';
      } else if (comboCount >= 3) {
        comboText = `${comboCount} é€£æ“Šï¼âš¡ è¶…å¼·é€£æ“Šï¼`;
        comboIcon = 'âš¡';
      } else {
        comboText = `${comboCount} é€£æ“Šï¼âœ¨ é€£æ“Šé–‹å§‹ï¼`;
        comboIcon = 'âœ¨';
      }
      
      comboDiv.innerHTML = `${comboIcon} ${comboText} ${comboIcon}`;
      
      // æ·»åŠ å‹•ç•«æ¨£å¼
      const style = document.createElement('style');
      style.textContent = `
        @keyframes comboSlide {
          0% { transform: translateX(-50%) translateY(-100%); opacity: 0; }
          50% { transform: translateX(-50%) translateY(0); opacity: 1; }
          100% { transform: translateX(-50%) translateY(0); opacity: 0; }
        }
      `;
      document.head.appendChild(style);
      
      document.body.appendChild(comboDiv);
      
      // 2ç§’å¾Œç§»é™¤
      setTimeout(() => {
        if (document.body.contains(comboDiv)) {
          document.body.removeChild(comboDiv);
        }
        if (document.head.contains(style)) {
          document.head.removeChild(style);
        }
      }, 2000);
    }

    function startTimer() {
      clearInterval(timer);
      timeLeft = 30;
      const timerDiv = document.getElementById('timerDisplay');
      document.getElementById('timeLeft').textContent = timeLeft;
      timerDiv.classList.remove('danger');
      timer = setInterval(() => {
        timeLeft--;
        document.getElementById('timeLeft').textContent = timeLeft;
        if (timeLeft <= 5) {
          timerDiv.classList.add('danger');
        }
        if (timeLeft <= 0) {
          clearInterval(timer);
          wrongList.push(current);
          setTimeout(nextWord, 500);
        }
      }, 1000);
    }

    function disablePlay() {
      clearInterval(timer);
      document.getElementById('answerInput').disabled = true;
      document.querySelectorAll('.btn-row button').forEach(btn => btn.disabled = true);
    }
    function enablePlay() {
      clearInterval(timer);
      document.getElementById('answerInput').disabled = false;
      document.querySelectorAll('.btn-row button').forEach(btn => btn.disabled = false);
      
      // å¼·åˆ¶èšç„¦åˆ°è¼¸å…¥æ¡†
      const input = document.getElementById('answerInput');
      
      // å¤šç¨®èšç„¦ç­–ç•¥
      input.focus();
      input.click(); // å°æ–¼æŸäº›ç§»å‹•è¨­å‚™
      
      // å¦‚æœèšç„¦å¤±æ•—ï¼Œå˜—è©¦å¤šæ¬¡èšç„¦
      setTimeout(() => {
        if (document.activeElement !== input) {
          input.focus();
          input.click();
        }
      }, 100);
      
      setTimeout(() => {
        if (document.activeElement !== input) {
          input.focus();
          input.click();
        }
      }, 300);
      
      setTimeout(() => {
        if (document.activeElement !== input) {
          input.focus();
          input.click();
        }
      }, 500);
    }

    function showHint() {
      if (!current || hintUsed) return;
      
      hintUsed = true;
      gameStats.hintUsedCount++; // è¨˜éŒ„ä½¿ç”¨æç¤ºæ¬¡æ•¸
      const hintArea = document.getElementById('hintArea');
      const hintText = document.getElementById('hintText');
      
      // é¡¯ç¤ºç¬¬ä¸€å€‹å­—æ¯
      const firstLetter = current.word.charAt(0).toUpperCase();
      const wordLength = current.word.length;
      const hint = `ğŸ’¡ æç¤ºï¼š${firstLetter}${'_'.repeat(wordLength - 1)} (${wordLength} å€‹å­—æ¯)`;
      
      hintText.textContent = hint;
      hintArea.style.display = 'block';
      hintArea.classList.add('show');
      
      // 3ç§’å¾Œè‡ªå‹•éš±è—
      setTimeout(() => {
        hintArea.classList.remove('show');
        setTimeout(() => {
          hintArea.style.display = 'none';
        }, 500);
      }, 3000);
    }

    function showResultPanel() {
      // ===== ä¿®æ”¹ï¼šä½¿ç”¨æ–°çš„æ˜Ÿæ˜Ÿè¨ˆç®—é‚è¼¯ =====
      const totalTime = (Date.now() - gameStats.startTime) / 1000;
      const accuracy = (gameStats.correctCount / gameStats.totalAnswered * 100).toFixed(1);
      
      // è¨ˆç®—ç¸½æ˜Ÿæ˜Ÿçå‹µï¼ˆé€™è£¡åªæ˜¯é¡¯ç¤ºï¼Œå¯¦éš›çå‹µåœ¨ç­”é¡Œæ™‚å·²ç¶“çµ¦äºˆï¼‰
      const totalStarsEarned = parseInt(localStorage.getItem('totalStars') || '0') - totalStarCount;
      
      document.getElementById('sessionStars').textContent = totalStarsEarned;
      document.getElementById('sessionCorrect').textContent = correctCount;
      document.getElementById('sessionWrong').textContent = wrongList.length;
      document.getElementById('sessionTotal').textContent = parseInt(localStorage.getItem('totalStars') || '0');
      document.getElementById('wrongBtn').style.display = wrongList.length ? 'inline-block' : 'none';
      document.getElementById('resultModal').style.display = 'flex';

      updateTotal();
      if (correctCount === maxQuestions || correctCount / maxQuestions >= 0.8) {
        let passed = JSON.parse(localStorage.getItem('passed_challenge2')||'[]');
        if (!passed.includes(bookName)) {
          passed.push(bookName);
          localStorage.setItem('passed_challenge2', JSON.stringify(passed));
        }
      }
      
      // æ›´æ–°æ‹¼å­—éŠæˆ²æˆå°±çµ±è¨ˆ
      updateSpellingAchievements();
    }

    // æ–°å¢ï¼šæ‹¼å­—éŠæˆ²æˆå°±è¿½è¹¤
    function updateSpellingAchievements() {
      // æ›´æ–°æ‹¼å­—éŠæˆ²å®Œæˆæ¬¡æ•¸
      const spellingGames = parseInt(localStorage.getItem('spellingGamesCompleted') || '0');
      localStorage.setItem('spellingGamesCompleted', spellingGames + 1);
      
      // æª¢æŸ¥ä¸¦æ›´æ–°ç›¸é—œæˆå°±
      checkAndUpdateSpellingAchievements();
    }
    
    function checkAndUpdateSpellingAchievements() {
      // æª¢æŸ¥æ˜¯å¦æœ‰æ–°æˆå°±é”æˆ
      const achievements = [
        { id: 'speed_learner', name: 'å¿«é€Ÿå­¸ç¿’è€…', requirement: 10 },
        { id: 'accuracy_master', name: 'æº–ç¢ºå¤§å¸«', requirement: 20 },
        { id: 'combo_king', name: 'é€£æ“Šä¹‹ç‹', requirement: 15 }
      ];
      
      const claimed = JSON.parse(localStorage.getItem('claimedAchievements') || '[]');
      
      achievements.forEach(ach => {
        if (claimed.includes(ach.id)) return; // å·²ç¶“é ˜å–éäº†
        
        // è¨ˆç®—é€šéçš„é—œå¡æ•¸é‡
        const fillGames = parseInt(localStorage.getItem('fillGamesCompleted') || '0');
        const cardGames = parseInt(localStorage.getItem('cardGamesCompleted') || '0');
        const quizGames = parseInt(localStorage.getItem('quizGamesCompleted') || '0');
        const spellingGames = parseInt(localStorage.getItem('spellingGamesCompleted') || '0');
        const matchingGames = parseInt(localStorage.getItem('matchingGamesCompleted') || '0');
        const totalGames = fillGames + cardGames + quizGames + spellingGames + matchingGames;
        
        if (totalGames >= ach.requirement) {
          // é¡¯ç¤ºæˆå°±é”æˆé€šçŸ¥
          showAchievementNotification(ach.name, ach.id);
        }
      });
    }
    
    function showAchievementNotification(achievementName, achievementId) {
      // å‰µå»ºæˆå°±é€šçŸ¥
      const notification = document.createElement('div');
      notification.style.cssText = `
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: linear-gradient(135deg, #ffd700, #ffed4e);
        color: #000;
        padding: 20px 30px;
        border-radius: 15px;
        font-weight: bold;
        font-size: 1.2rem;
        z-index: 10000;
        box-shadow: 0 0 30px #ffd700;
        animation: achievementPop 0.8s cubic-bezier(.68, -0.55, .27, 1.55);
        text-align: center;
        min-width: 300px;
      `;
      
      notification.innerHTML = `
        <div style="font-size: 3rem; margin-bottom: 10px;">ğŸ†</div>
        <div style="margin-bottom: 5px;">ğŸ‰ æˆå°±é”æˆï¼</div>
        <div style="font-size: 1.1rem;">${achievementName}</div>
        <div style="font-size: 0.9rem; margin-top: 10px; color: #666;">
          å‰å¾€æˆå°±é é¢é ˜å–çå‹µ
        </div>
      `;
      
      // æ·»åŠ å‹•ç•«æ¨£å¼
      const style = document.createElement('style');
      style.textContent = `
        @keyframes achievementPop {
          0% { transform: translate(-50%, -50%) scale(0.5); opacity: 0; }
          50% { transform: translate(-50%, -50%) scale(1.1); opacity: 1; }
          100% { transform: translate(-50%, -50%) scale(1); opacity: 1; }
        }
      `;
      document.head.appendChild(style);
      
      document.body.appendChild(notification);
      
      // 3ç§’å¾Œè‡ªå‹•ç§»é™¤
      setTimeout(() => {
        notification.remove();
        style.remove();
      }, 3000);
    }

    function showWrongModal() {
      const list = document.getElementById('wrongItems');
      list.innerHTML = '';
      wrongList.forEach(item => {
        const li = document.createElement('li');
        li.textContent = `${item.zh} â€” ${item.word}`;
        list.appendChild(li);
      });
      document.getElementById('wrongModal').style.display = 'flex';
    }
    function closeWrongModal() {
      document.getElementById('wrongModal').style.display = 'none';
    }
    function goHome() {
      location.href = 'index.html';
    }

    function nextWord() {
      disablePlay();
      if (used.length >= words.length) {
        document.getElementById('wordDisplay').textContent = 'âœ… æŒ‘æˆ°å®Œæˆ';
        document.getElementById('timerDisplay').textContent = 'â± å·²çµæŸ';
        
        // ===== æ–°å¢ï¼šé¡¯ç¤ºéŠæˆ²ç¸½çµ =====
        setTimeout(() => {
          showGameSummary();
          setTimeout(showResultPanel, 2000);
        }, 300);
        return;
      }
      const available = words.filter(w => !used.includes(w.word));
      current = available[Math.floor(Math.random() * available.length)];
      used.push(current.word);

      updateQuestionCount();
      updateProgressBar();
      document.getElementById('wordDisplay').textContent = current.zh;
      document.getElementById('answerInput').value = '';
      document.getElementById('feedback').textContent = '';
      document.getElementById('hintArea').style.display = 'none';
      hintUsed = false;
      
      // é‡ç½®è¼¸å…¥æ¡†æ¨£å¼
      const input = document.getElementById('answerInput');
      input.classList.remove('correct', 'wrong');
      
      speakCurrentWord();
      enablePlay();
      startTimer();
      document.getElementById('answerInput').scrollIntoView({ block: 'center', behavior: 'smooth' });
    }

    function checkAnswer() {
      disablePlay();
      const ans = document.getElementById('answerInput').value.trim().toLowerCase();
      const input = document.getElementById('answerInput');
      const feedback = document.getElementById('feedback');
      
      // ===== æ–°å¢ï¼šè¨ˆç®—ç­”é¡Œæ™‚é–“ =====
      const answerTime = (30 - timeLeft); // 30ç§’å€’è¨ˆæ™‚ï¼Œæ‰€ä»¥ç”¨30æ¸›å»å‰©é¤˜æ™‚é–“
      gameStats.totalAnswered++;
      gameStats.totalTimeUsed += answerTime;
      
      if (ans === current.word.toLowerCase()) {
        input.classList.add('correct');
        feedback.textContent = 'âœ… æ­£ç¢ºï¼';
        feedback.className = 'correct';
        correctCount++;
        
        // ===== æ–°å¢ï¼šç­”å°é‚è¼¯ =====
        gameStats.correctCount++;
        gameStats.consecutiveCorrect++;
        
        // æ›´æ–°æœ€å¿«/æœ€æ…¢ç­”é¡Œæ™‚é–“
        if (answerTime < gameStats.fastestAnswer) {
          gameStats.fastestAnswer = answerTime;
        }
        if (answerTime > gameStats.slowestAnswer) {
          gameStats.slowestAnswer = answerTime;
        }
        
        // æª¢æŸ¥æ˜¯å¦ç‚ºå®Œç¾ç­”é¡Œï¼ˆ10ç§’å…§ç­”å°ï¼‰
        if (answerTime <= 10) {
          gameStats.perfectAnswers++;
        }
        
        // è¨ˆç®—æ˜Ÿæ˜Ÿçå‹µ
        const starsEarned = calculateStarReward(true, answerTime, gameStats.consecutiveCorrect, current.word.length, hintUsed);
        
        // ä½¿ç”¨çµ±ä¸€çš„æ˜Ÿæ˜Ÿç³»çµ±
        if (typeof StarRewardSystem !== 'undefined') {
          StarRewardSystem.addStars(starsEarned);
        } else {
          totalStarCount += starsEarned;
          localStorage.setItem('totalStars', totalStarCount);
        }
        
        // æ›´æ–°é¡¯ç¤º
        updateTotal();
        
        // é¡¯ç¤ºçå‹µå‹•ç•«
        let reasonText = '';
        if (answerTime <= 5) {
          reasonText = 'âš¡ è¶…å¿«é€Ÿæ‹¼å­—ï¼';
        } else if (answerTime <= 10) {
          reasonText = 'ğŸ¯ å¿«é€Ÿæ‹¼å­—ï¼';
        }
        if (gameStats.consecutiveCorrect >= 3) {
          reasonText += reasonText ? ' + é€£æ“Šçå‹µï¼' : 'ğŸ”¥ é€£æ“Šçå‹µï¼';
        }
        if (hintUsed) {
          reasonText += reasonText ? ' - æç¤ºæ‡²ç½°' : 'ğŸ’¡ ä½¿ç”¨æç¤º';
        }
        
        showRewardAnimation(starsEarned, reasonText);
        
        // é¡¯ç¤ºé€£æ“Šé€šçŸ¥
        showComboNotification(gameStats.consecutiveCorrect);
        
        // ===== æ–°å¢ï¼šè¨˜éŒ„ç­”å°çš„å–®å­— =====
        if (typeof VocabularyAchievementSystem !== 'undefined') {
          VocabularyAchievementSystem.recordCorrectWord(current.word, bookName);
        }
        
        speak(current.word);
      } else {
        input.classList.add('wrong');
        feedback.textContent = `âŒ æ­£è§£æ˜¯ï¼š${current.word}`;
        feedback.className = 'wrong';
        wrongList.push(current);
        
        // ===== æ–°å¢ï¼šç­”éŒ¯é‚è¼¯ =====
        gameStats.consecutiveCorrect = 0; // é‡ç½®é€£æ“Š
      }
      setTimeout(nextWord, 1200);
    }

    function skipWord() {
      disablePlay();
      wrongList.push(current);
      setTimeout(nextWord, 200);
    }

    function restartGame() {
      clearInterval(timer);
      used = [];
      wrongList = [];
      correctCount = 0;
      hintUsed = false;
      document.getElementById('currentQuestion').textContent = '0';
      document.getElementById('progressFill').style.width = '0%';
      document.getElementById('resultModal').style.display = 'none';
      document.getElementById('wrongModal').style.display = 'none';
      document.getElementById('hintArea').style.display = 'none';
      nextWord();
    }

    // å³æ™‚åé¥‹åŠŸèƒ½
    document.getElementById('answerInput').addEventListener('keydown', e => {
      if (e.key === 'Enter') {
        checkAnswer();
      } else if (e.key === 'Tab') {
        e.preventDefault();
        showHint();
      }
    });

    function shuffleArray(arr) {
      for (let i = arr.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [arr[i], arr[j]] = [arr[j], arr[i]];
      }
    }

    // åˆå§‹åŒ–
    updateTotal();
    updateQuestionCount();
    updateProgressBar();
    nextWord();
    
    // ç¢ºä¿é é¢è¼‰å…¥å¾Œè‡ªå‹•èšç„¦åˆ°è¼¸å…¥æ¡†
    window.addEventListener('load', () => {
      setTimeout(() => {
        document.getElementById('answerInput').focus();
      }, 500);
    });

    // ===== æ–°å¢ï¼šé¡¯ç¤ºéŠæˆ²ç¸½çµ =====
    function showGameSummary() {
      const totalTime = (Date.now() - gameStats.startTime) / 1000;
      const accuracy = (gameStats.correctCount / gameStats.totalAnswered * 100).toFixed(1);
      const avgTime = gameStats.totalTimeUsed / gameStats.totalAnswered;
      
      const summaryDiv = document.createElement('div');
      summaryDiv.style.cssText = `
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.9);
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 10000;
        backdrop-filter: blur(10px);
      `;
      
      summaryDiv.innerHTML = `
        <div style="
          background: linear-gradient(135deg, rgba(10, 20, 40, 0.95), rgba(20, 40, 80, 0.95));
          border: 3px solid #00ffff;
          border-radius: 25px;
          padding: 40px;
          max-width: 600px;
          text-align: center;
          box-shadow: 0 0 50px #00ffff;
          animation: summaryPop 0.8s cubic-bezier(0.68, -0.55, 0.27, 1.55);
          color: #fff;
          font-family: 'Orbitron', sans-serif;
        ">
          <div style="font-size: 4rem; margin-bottom: 20px;">ğŸ†</div>
          <h2 style="color: #00ffff; margin-bottom: 30px; font-size: 2rem;">æ‹¼å­—éŠæˆ²å®Œæˆï¼</h2>
          
          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 30px;">
            <div style="background: rgba(0,255,255,0.1); padding: 15px; border-radius: 15px; border: 1px solid #00ffff;">
              <div style="font-size: 1.5rem; color: #00ffff;">${gameStats.correctCount}</div>
              <div style="font-size: 0.9rem; color: #ccc;">ç­”å°é¡Œæ•¸</div>
            </div>
            <div style="background: rgba(0,255,255,0.1); padding: 15px; border-radius: 15px; border: 1px solid #00ffff;">
              <div style="font-size: 1.5rem; color: #00ffff;">${accuracy}%</div>
              <div style="font-size: 0.9rem; color: #ccc;">æ­£ç¢ºç‡</div>
            </div>
            <div style="background: rgba(0,255,255,0.1); padding: 15px; border-radius: 15px; border: 1px solid #00ffff;">
              <div style="font-size: 1.5rem; color: #00ffff;">${totalTime.toFixed(1)}s</div>
              <div style="font-size: 0.9rem; color: #ccc;">ç¸½ç”¨æ™‚</div>
            </div>
            <div style="background: rgba(0,255,255,0.1); padding: 15px; border-radius: 15px; border: 1px solid #00ffff;">
              <div style="font-size: 1.5rem; color: #00ffff;">${gameStats.perfectAnswers}</div>
              <div style="font-size: 0.9rem; color: #ccc;">å®Œç¾ç­”é¡Œ</div>
            </div>
          </div>
          
          <div style="
            background: linear-gradient(90deg, #ffd700, #ffaa00);
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            color: #000;
            font-weight: bold;
            font-size: 1.3rem;
          ">
            â­ æœ¬æ¬¡ç²å¾—æ˜Ÿæ˜Ÿï¼š${parseInt(localStorage.getItem('totalStars') || '0') - totalStarCount} é¡† â­
          </div>
          
          <div style="color: #ccc; font-size: 0.9rem; margin-top: 20px;">
            é»æ“Šä»»æ„è™•é—œé–‰...
          </div>
        </div>
      `;
      
      // æ·»åŠ å‹•ç•«æ¨£å¼
      const style = document.createElement('style');
      style.textContent = `
        @keyframes summaryPop {
          0% { transform: scale(0.2) rotate(-15deg); opacity: 0; }
          50% { transform: scale(1.15) rotate(3deg); }
          100% { transform: scale(1) rotate(0deg); opacity: 1; }
        }
      `;
      document.head.appendChild(style);
      
      document.body.appendChild(summaryDiv);
      
      // é»æ“ŠèƒŒæ™¯é—œé–‰
      summaryDiv.onclick = function(e) {
        if (e.target === summaryDiv) {
          summaryDiv.remove();
          style.remove();
        }
      };
    }
  </script>
</body>
</html>
