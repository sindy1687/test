<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>ç¤¾äº¤åˆ†äº« - Typing Hero</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Roboto+Mono:wght@400;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="responsive.css">
  <style>
    /* ====== å…¨åŸŸæ¨£å¼ ====== */
    body {
      margin: 0;
      font-family: 'Orbitron', sans-serif;
      background: url('https://wallpaperaccess.com/full/192936.jpg') no-repeat center center fixed;
      background-size: cover;
      color: #fff;
      text-align: center;
      overflow-y: auto;
    }

    header {
      background: rgba(10, 20, 40, 0.85);
      padding: 16px 32px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      box-shadow: 0 0 24px 8px #00ffff88, 0 0 40px 0 #a259ff33 inset;
      border-bottom: 2px solid #00ffff;
      backdrop-filter: blur(4px);
      position: relative;
      z-index: 10;
    }

    header h1 {
      margin: 0;
      font-size: 2.1rem;
      color: #00ffff;
      letter-spacing: 2px;
      text-shadow: 0 0 12px #00ffff, 0 0 32px #a259ff;
    }

    .btn {
      background: linear-gradient(90deg, #00ffff 0%, #a259ff 100%);
      color: #000;
      border: none;
      padding: 10px 22px;
      border-radius: 12px;
      cursor: pointer;
      font-weight: bold;
      box-shadow: 0 0 16px #00ffff, 0 0 24px #a259ff99;
      margin-left: 8px;
      font-size: 1.1rem;
      letter-spacing: 1px;
      transition: transform 0.15s, box-shadow 0.15s;
    }

    .btn:hover {
      transform: scale(1.07);
      box-shadow: 0 0 32px #00ffff, 0 0 48px #a259ffcc;
    }

    /* ====== ä¸»è¦å…§å®¹å€åŸŸ ====== */
    .main-content {
      max-width: 1200px;
      margin: 0 auto;
      padding: 32px 20px;
    }

    .share-section {
      background: rgba(10, 20, 40, 0.85);
      border: 2px solid #00ffff;
      border-radius: 16px;
      padding: 24px;
      margin-bottom: 24px;
      backdrop-filter: blur(8px);
    }

    .share-title {
      font-size: 1.8rem;
      color: #00ffff;
      margin-bottom: 16px;
      text-shadow: 0 0 8px #00ffff;
    }

    /* ====== åˆ†äº«å¡ç‰‡ç”Ÿæˆå™¨ ====== */
    .share-card-generator {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
      margin-bottom: 24px;
    }

    .share-card {
      background: linear-gradient(135deg, rgba(0, 255, 255, 0.1) 0%, rgba(162, 89, 255, 0.1) 100%);
      border: 2px solid #00ffff;
      border-radius: 12px;
      padding: 20px;
      position: relative;
      overflow: hidden;
    }

    .share-card::before {
      content: '';
      position: absolute;
      top: 0; left: 0; right: 0; bottom: 0;
      background: linear-gradient(45deg, transparent 30%, rgba(0, 255, 255, 0.05) 50%, transparent 70%);
      animation: shimmer 3s infinite;
    }

    @keyframes shimmer {
      0% { transform: translateX(-100%); }
      100% { transform: translateX(100%); }
    }

    .share-card-title {
      font-size: 1.3rem;
      color: #ffd700;
      margin-bottom: 12px;
      position: relative;
      z-index: 1;
    }

    .share-card-content {
      position: relative;
      z-index: 1;
    }

    .stats-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 12px;
      margin: 16px 0;
    }

    .stat-item {
      background: rgba(0, 0, 0, 0.3);
      border-radius: 8px;
      padding: 8px;
      font-size: 0.9rem;
    }

    .stat-label {
      color: #ccc;
      font-size: 0.8rem;
    }

    .stat-value {
      color: #00ffff;
      font-weight: bold;
      font-size: 1.1rem;
    }

    /* ====== åˆ†äº«æŒ‰éˆ• ====== */
    .share-buttons {
      display: flex;
      gap: 12px;
      justify-content: center;
      flex-wrap: wrap;
      margin-top: 20px;
    }

    .share-btn {
      background: linear-gradient(45deg, #00ffff, #a259ff);
      color: #000;
      border: none;
      padding: 12px 20px;
      border-radius: 8px;
      cursor: pointer;
      font-weight: bold;
      display: flex;
      align-items: center;
      gap: 8px;
      transition: transform 0.2s, box-shadow 0.2s;
    }

    .share-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0, 255, 255, 0.4);
    }

    /* ====== æ’è¡Œæ¦œå€åŸŸ ====== */
    .leaderboard-section {
      background: rgba(10, 20, 40, 0.85);
      border: 2px solid #ffd700;
      border-radius: 16px;
      padding: 24px;
      margin-bottom: 24px;
      backdrop-filter: blur(8px);
    }

    .leaderboard-title {
      font-size: 1.8rem;
      color: #ffd700;
      margin-bottom: 16px;
      text-shadow: 0 0 8px #ffd700;
    }

    .leaderboard-list {
      display: grid;
      gap: 12px;
    }

    .leaderboard-item {
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(255, 215, 0, 0.3);
      border-radius: 8px;
      padding: 12px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      transition: all 0.2s;
    }

    .leaderboard-item:hover {
      background: rgba(255, 215, 0, 0.1);
      border-color: #ffd700;
    }

    .rank {
      font-size: 1.2rem;
      font-weight: bold;
      color: #ffd700;
      min-width: 40px;
    }

    .player-info {
      flex: 1;
      text-align: left;
      margin-left: 12px;
    }

    .player-name {
      font-weight: bold;
      color: #fff;
    }

    .player-stats {
      font-size: 0.8rem;
      color: #ccc;
    }

    .player-score {
      font-size: 1.1rem;
      font-weight: bold;
      color: #00ffff;
    }

    /* ====== è¨è«–å€åŸŸ ====== */
    .discussion-section {
      background: rgba(10, 20, 40, 0.85);
      border: 2px solid #a259ff;
      border-radius: 16px;
      padding: 24px;
      backdrop-filter: blur(8px);
    }

    .discussion-title {
      font-size: 1.8rem;
      color: #a259ff;
      margin-bottom: 16px;
      text-shadow: 0 0 8px #a259ff;
    }

    .discussion-topics {
      display: grid;
      gap: 16px;
    }

    .topic-item {
      background: rgba(162, 89, 255, 0.1);
      border: 1px solid rgba(162, 89, 255, 0.3);
      border-radius: 8px;
      padding: 16px;
      text-align: left;
      transition: all 0.2s;
    }

    .topic-item:hover {
      background: rgba(162, 89, 255, 0.2);
      border-color: #a259ff;
    }

    .topic-title {
      font-weight: bold;
      color: #fff;
      margin-bottom: 8px;
    }

    .topic-desc {
      color: #ccc;
      font-size: 0.9rem;
      line-height: 1.4;
    }

    .topic-meta {
      display: flex;
      justify-content: space-between;
      margin-top: 8px;
      font-size: 0.8rem;
      color: #888;
    }

    /* ====== é€šçŸ¥ç³»çµ± ====== */
    .notification {
      position: fixed;
      top: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(10, 20, 40, 0.95);
      border: 2px solid #00ffff;
      border-radius: 12px;
      padding: 16px 24px;
      color: #fff;
      font-weight: bold;
      z-index: 10000;
      animation: slideDown 0.3s ease-out;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
    }

    @keyframes slideDown {
      from { transform: translateX(-50%) translateY(-100%); opacity: 0; }
      to { transform: translateX(-50%) translateY(0); opacity: 1; }
    }
  </style>
</head>
<body>
  <header>
    <h1>ğŸ‘¥ ç¤¾äº¤åˆ†äº«</h1>
    <div>
      <button class="btn" onclick="location.href='index.html'">ğŸ  é¦–é </button>
      <button class="btn" onclick="location.href='cards.html'">ğŸ“ å¡ç‰‡æ”¶è—</button>
      <button class="btn" onclick="location.href='game_scenarios.html'">ğŸ® éŠæˆ²å ´æ™¯</button>
      <button class="btn" onclick="testDataSync()" style="background: linear-gradient(90deg, #ff6b6b 0%, #ffd700 100%);">ğŸ§ª æ¸¬è©¦é€£å‹•</button>
    </div>
  </header>

  <div class="main-content">
    <!-- åˆ†äº«å¡ç‰‡ç”Ÿæˆå™¨ -->
    <div class="share-section">
      <h2 class="share-title">ğŸ“¤ åˆ†äº«ä½ çš„æ”¶è—</h2>
      <div class="share-card-generator">
        <div class="share-card">
          <div class="share-card-title">ğŸ¯ æ”¶é›†é€²åº¦</div>
          <div class="share-card-content">
            <div class="stats-grid">
              <div class="stat-item">
                <div class="stat-label">ç¸½å¡ç‰‡</div>
                <div class="stat-value" id="totalCards">0</div>
              </div>
              <div class="stat-item">
                <div class="stat-label">å·²æ”¶é›†</div>
                <div class="stat-value" id="collectedCards">0</div>
              </div>
              <div class="stat-item">
                <div class="stat-label">å®Œæˆåº¦</div>
                <div class="stat-value" id="completionRate">0%</div>
              </div>
              <div class="stat-item">
                <div class="stat-label">ç¨€æœ‰åº¦</div>
                <div class="stat-value" id="rarityLevel">æ–°æ‰‹</div>
              </div>
            </div>
            <div class="share-buttons">
              <button class="share-btn" onclick="shareProgress()">
                ğŸ“Š åˆ†äº«é€²åº¦
              </button>
              <button class="share-btn" onclick="shareAchievement()">
                ğŸ† åˆ†äº«æˆå°±
              </button>
            </div>
          </div>
        </div>

        <div class="share-card">
          <div class="share-card-title">â­ ç¨€æœ‰æ”¶è—</div>
          <div class="share-card-content">
            <div class="stats-grid">
              <div class="stat-item">
                <div class="stat-label">SSRå¡ç‰‡</div>
                <div class="stat-value" id="ssrCards">0</div>
              </div>
              <div class="stat-item">
                <div class="stat-label">ç¨€æœ‰å¡ç‰‡</div>
                <div class="stat-value" id="rareCards">0</div>
              </div>
              <div class="stat-item">
                <div class="stat-label">æ™®é€šå¡ç‰‡</div>
                <div class="stat-value" id="commonCards">0</div>
              </div>
              <div class="stat-item">
                <div class="stat-label">æ”¶é›†ç­‰ç´š</div>
                <div class="stat-value" id="collectionLevel">æ–°æ‰‹</div>
              </div>
            </div>
            <div class="share-buttons">
              <button class="share-btn" onclick="shareRarity()">
                â­ åˆ†äº«ç¨€æœ‰åº¦
              </button>
              <button class="share-btn" onclick="shareCollection()">
                ğŸ“š åˆ†äº«æ”¶è—
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- æ–°å¢ï¼šè©³ç´°çµ±è¨ˆå€åŸŸ -->
    <div class="share-section">
      <h2 class="share-title">ğŸ“Š è©³ç´°çµ±è¨ˆ</h2>
      <div class="stats-grid">
        <div class="stat-item">
          <div class="stat-label">ç¸½å¡ç‰‡æ•¸</div>
          <div class="stat-value" id="totalCardsDetail">-</div>
        </div>
        <div class="stat-item">
          <div class="stat-label">å·²æ”¶é›†</div>
          <div class="stat-value" id="collectedCardsDetail">-</div>
        </div>
        <div class="stat-item">
          <div class="stat-label">æ”¶é›†é€²åº¦</div>
          <div class="stat-value" id="collectionProgressPercent">-</div>
        </div>
        <div class="stat-item">
          <div class="stat-label">ç¸½ç¢ç‰‡æ•¸</div>
          <div class="stat-value" id="totalShards">-</div>
        </div>
      </div>
      
      <!-- é¡åˆ¥çµ±è¨ˆ -->
      <div style="margin-top: 20px;">
        <h3 style="color: #00ffff; margin-bottom: 10px;">ğŸ·ï¸ é¡åˆ¥çµ±è¨ˆ</h3>
        <div id="categoryStats" style="text-align: left; max-height: 200px; overflow-y: auto;"></div>
      </div>
      
      <!-- ç¨€æœ‰åº¦çµ±è¨ˆ -->
      <div style="margin-top: 20px;">
        <h3 style="color: #ffd700; margin-bottom: 10px;">â­ ç¨€æœ‰åº¦çµ±è¨ˆ</h3>
        <div id="rarityStats" style="text-align: left; max-height: 200px; overflow-y: auto;"></div>
      </div>
      
      <!-- æ”¶é›†é€²åº¦ -->
      <div style="margin-top: 20px;">
        <h3 style="color: #a259ff; margin-bottom: 10px;">ğŸ“ˆ æ”¶é›†é€²åº¦</h3>
        <div id="collectionProgressDetail" style="text-align: left; max-height: 200px; overflow-y: auto;"></div>
      </div>
    </div>

    <!-- ====== å¡ç‰‡åˆ†æå€åŸŸ ====== -->
    <div class="share-section">
      <h2 class="share-title">ğŸ” å¡ç‰‡åˆ†æ</h2>
      <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 20px;">
        <button class="btn" onclick="showCategoryBreakdown()">é¡åˆ¥è©³æƒ…</button>
        <button class="btn" onclick="showRarityBreakdown()">ç¨€æœ‰åº¦è©³æƒ…</button>
        <button class="btn" onclick="showCollectionTips()">æ”¶é›†å»ºè­°</button>
        <button class="btn" onclick="showNextTargets()">ä¸‹å€‹ç›®æ¨™</button>
      </div>
      
      <!-- ç¢ç‰‡åˆ†æ -->
      <div style="margin-top: 20px;">
        <h3 style="color: #ff6b6b; margin-bottom: 10px;">ğŸ’ ç¢ç‰‡åˆ†æ</h3>
        <div id="shardAnalysis" style="text-align: left; max-height: 200px; overflow-y: auto;"></div>
      </div>
    </div>

    <!-- ====== è³‡æ–™åŒ¯å‡ºåŒ¯å…¥å€åŸŸ ====== -->
    <div class="share-section">
      <h2 class="share-title">ğŸ’¾ è³‡æ–™ç®¡ç†</h2>
      <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
        <button class="btn" onclick="exportData()">åŒ¯å‡ºè³‡æ–™</button>
        <button class="btn" onclick="importData()">åŒ¯å…¥è³‡æ–™</button>
        <button class="btn" onclick="resetData()">é‡ç½®è³‡æ–™</button>
        <button class="btn" onclick="testData()">æ¸¬è©¦è³‡æ–™</button>
      </div>
    </div>

    <!-- æ’è¡Œæ¦œ -->
    <div class="leaderboard-section">
      <h2 class="leaderboard-title">ğŸ† æ”¶é›†æ’è¡Œæ¦œ</h2>
      <div class="leaderboard-list" id="leaderboardList">
        <!-- æ’è¡Œæ¦œé …ç›®å°‡ç”±JavaScriptå‹•æ…‹ç”Ÿæˆ -->
      </div>
    </div>

    <!-- è¨è«–å€åŸŸ -->
    <div class="discussion-section">
      <h2 class="discussion-title">ğŸ’¬ å¡ç‰‡è¨è«–</h2>
      <div class="discussion-topics" id="discussionTopics">
        <!-- è¨è«–ä¸»é¡Œå°‡ç”±JavaScriptå‹•æ…‹ç”Ÿæˆ -->
      </div>
    </div>
  </div>

  <script src="js/sound.js"></script>
  <script src="js/userData.js"></script>
  <script src="cards.js"></script>
  <script>
    // ç°¡å–®æ¸¬è©¦å‡½æ•¸
    console.log('social_share.html JavaScript å·²è¼‰å…¥');
    
    // è¼‰å…¥ cards.js è³‡æ–™
    let allCards = [];
    let ownedCards = {};
    let stars = 0;

    // é é¢è¼‰å…¥æ™‚åˆå§‹åŒ–
    document.addEventListener('DOMContentLoaded', function() {
      console.log('DOM å·²è¼‰å…¥å®Œæˆ');
      
      // ç°¡å–®æ¸¬è©¦ï¼šç¢ºä¿é é¢å…ƒç´ å­˜åœ¨
      const testElement = document.getElementById('totalCards');
      if (testElement) {
        console.log('é é¢å…ƒç´ è¼‰å…¥æ­£å¸¸');
        testElement.textContent = 'æ¸¬è©¦ä¸­...';
      } else {
        console.error('æ‰¾ä¸åˆ°é é¢å…ƒç´ ');
      }
      
      // æª¢æŸ¥æ˜¯å¦å·²è¼‰å…¥ cards.js
      if (typeof window.allCards !== 'undefined') {
        allCards = window.allCards;
        console.log('æˆåŠŸè¼‰å…¥ cards.js è³‡æ–™ï¼Œå…±', allCards.length, 'å¼µå¡ç‰‡');
        loadUserData();
        updateAllStats();
      } else {
        console.warn('cards.js å°šæœªè¼‰å…¥ï¼Œè«‹ç¢ºä¿å·²å¼•å…¥è©²æª”æ¡ˆ');
        // è¼‰å…¥ cards.js
        const script = document.createElement('script');
        script.src = 'cards.js';
        script.onload = function() {
          allCards = window.allCards || [];
          console.log('å‹•æ…‹è¼‰å…¥ cards.js æˆåŠŸï¼Œå…±', allCards.length, 'å¼µå¡ç‰‡');
          loadUserData();
          updateAllStats();
        };
        script.onerror = function() {
          console.error('ç„¡æ³•è¼‰å…¥ cards.js');
          alert('ç„¡æ³•è¼‰å…¥å¡ç‰‡è³‡æ–™ï¼Œè«‹æª¢æŸ¥ cards.js æª”æ¡ˆæ˜¯å¦å­˜åœ¨');
        };
        document.head.appendChild(script);
      }
    });

    // è¼‰å…¥ä½¿ç”¨è€…è³‡æ–™
    function loadUserData() {
      try {
        // å¾ localStorage è¼‰å…¥è³‡æ–™
        const savedOwnedCards = localStorage.getItem('ownedCards');
        const savedStars = localStorage.getItem('totalStars');
        
        if (savedOwnedCards) {
          ownedCards = JSON.parse(savedOwnedCards);
        }
        
        if (savedStars) {
          stars = parseInt(savedStars) || 0;
        }
        
        console.log('è¼‰å…¥ä½¿ç”¨è€…è³‡æ–™å®Œæˆ');
      } catch (error) {
        console.error('è¼‰å…¥ä½¿ç”¨è€…è³‡æ–™æ™‚ç™¼ç”ŸéŒ¯èª¤:', error);
      }
    }

    // æ›´æ–°æ‰€æœ‰çµ±è¨ˆè³‡æ–™
    function updateAllStats() {
      updateBasicStats();
      updateCategoryStats();
      updateRarityStats();
      updateCollectionProgress();
      updateShardAnalysis();
    }

    // æ›´æ–°åŸºæœ¬çµ±è¨ˆ
    function updateBasicStats() {
      const totalCards = allCards.length;
      const collectedCards = Object.keys(ownedCards).length;
      const collectionProgress = totalCards > 0 ? Math.round((collectedCards / totalCards) * 100) : 0;
      const totalShards = Object.values(shards).reduce((sum, count) => sum + count, 0);
      
      // æ›´æ–°åˆ†äº«å¡ç‰‡å€åŸŸ
      document.getElementById('totalCards').textContent = totalCards;
      document.getElementById('collectedCards').textContent = collectedCards;
      document.getElementById('completionRate').textContent = collectionProgress + '%';
      
      // æ›´æ–°è©³ç´°çµ±è¨ˆå€åŸŸ
      document.getElementById('totalCardsDetail').textContent = totalCards;
      document.getElementById('collectedCardsDetail').textContent = collectedCards;
      document.getElementById('collectionProgressPercent').textContent = collectionProgress + '%';
      document.getElementById('totalShards').textContent = totalShards;
    }

    // æ›´æ–°é¡åˆ¥çµ±è¨ˆ
    function updateCategoryStats() {
      const categoryStats = {};
      
      allCards.forEach(card => {
        if (!categoryStats[card.category]) {
          categoryStats[card.category] = { total: 0, collected: 0, shards: 0 };
        }
        categoryStats[card.category].total++;
        
        if (ownedCards[card.word]) {
          categoryStats[card.category].collected++;
        }
        
        const cardShards = shards[card.word] || 0;
        categoryStats[card.category].shards += cardShards;
      });
      
      const categoryStatsHtml = Object.entries(categoryStats)
        .map(([category, stats]) => {
          const progress = Math.round((stats.collected / stats.total) * 100);
          const progressBar = 'â–ˆ'.repeat(Math.floor(progress / 10)) + 'â–‘'.repeat(10 - Math.floor(progress / 10));
          return `
            <div style="margin-bottom: 8px; padding: 8px; border-radius: 6px; background: rgba(0,255,255,0.1); border-left: 3px solid #00ffff;">
              <div style="font-weight: bold; color: #00ffff;">${category}</div>
              <div style="font-size: 0.9rem; color: #ccc;">
                ${stats.collected}/${stats.total} (${progress}%) | ç¢ç‰‡: ${stats.shards}
              </div>
              <div style="font-size: 0.8rem; color: #00ffff;">${progressBar}</div>
            </div>
          `;
        }).join('');
      
      document.getElementById('categoryStats').innerHTML = categoryStatsHtml || '<div style="color: #ccc;">å°šç„¡è³‡æ–™</div>';
    }

    // æ›´æ–°ç¨€æœ‰åº¦çµ±è¨ˆ
    function updateRarityStats() {
      const rarityStats = {};
      
      allCards.forEach(card => {
        if (!rarityStats[card.rarity]) {
          rarityStats[card.rarity] = { total: 0, collected: 0, shards: 0 };
        }
        rarityStats[card.rarity].total++;
        
        if (ownedCards[card.word]) {
          rarityStats[card.rarity].collected++;
        }
        
        const cardShards = shards[card.word] || 0;
        rarityStats[card.rarity].shards += cardShards;
      });
      
      const rarityStatsHtml = Object.entries(rarityStats)
        .map(([rarity, stats]) => {
          const progress = Math.round((stats.collected / stats.total) * 100);
          const progressBar = 'â–ˆ'.repeat(Math.floor(progress / 10)) + 'â–‘'.repeat(10 - Math.floor(progress / 10));
          const rarityColor = rarity === 'è¶…ç¨€æœ‰' ? '#ffd700' : rarity === 'ç¨€æœ‰' ? '#a259ff' : '#00ffff';
          return `
            <div style="margin-bottom: 8px; padding: 8px; border-radius: 6px; background: rgba(255,215,0,0.1); border-left: 3px solid ${rarityColor};">
              <div style="font-weight: bold; color: ${rarityColor};">${rarity}</div>
              <div style="font-size: 0.9rem; color: #ccc;">
                ${stats.collected}/${stats.total} (${progress}%) | ç¢ç‰‡: ${stats.shards}
              </div>
              <div style="font-size: 0.8rem; color: ${rarityColor};">${progressBar}</div>
            </div>
          `;
        }).join('');
      
      document.getElementById('rarityStats').innerHTML = rarityStatsHtml || '<div style="color: #ccc;">å°šç„¡è³‡æ–™</div>';
    }

    // æ›´æ–°æ”¶é›†é€²åº¦
    function updateCollectionProgress() {
      const rarityProgress = {};
      
      // çµ±è¨ˆå„ç¨€æœ‰åº¦çš„é€²åº¦
      allCards.forEach(card => {
        if (!rarityProgress[card.rarity]) {
          rarityProgress[card.rarity] = { total: 0, collected: 0, shards: 0 };
        }
        rarityProgress[card.rarity].total++;
        
        if (ownedCards[card.word]) {
          rarityProgress[card.rarity].collected++;
        }
        
        const cardShards = shards[card.word] || 0;
        rarityProgress[card.rarity].shards += cardShards;
      });
      
      // ç”Ÿæˆæ”¶é›†é€²åº¦ HTML
      const progressHtml = Object.entries(rarityProgress)
        .map(([rarity, stats]) => {
          const progress = Math.round((stats.collected / stats.total) * 100);
          const progressBar = 'â–ˆ'.repeat(Math.floor(progress / 10)) + 'â–‘'.repeat(10 - Math.floor(progress / 10));
          const rarityColor = rarity === 'è¶…ç¨€æœ‰' ? '#ffd700' : rarity === 'ç¨€æœ‰' ? '#a259ff' : '#00ffff';
          return `
            <div style="margin-bottom: 8px; padding: 8px; border-radius: 6px; background: rgba(162,89,255,0.1); border-left: 3px solid ${rarityColor};">
              <div style="font-weight: bold; color: ${rarityColor};">${rarity}</div>
              <div style="font-size: 0.9rem; color: #ccc;">
                ${stats.collected}/${stats.total} (${progress}%) | ç¢ç‰‡: ${stats.shards}
              </div>
              <div style="font-size: 0.8rem; color: ${rarityColor};">${progressBar}</div>
            </div>
          `;
        }).join('');
      
      document.getElementById('collectionProgressDetail').innerHTML = progressHtml || '<div style="color: #ccc;">å°šç„¡è³‡æ–™</div>';
    }

    // æ›´æ–°ç¢ç‰‡åˆ†æ
    function updateShardAnalysis() {
      const shardAnalysis = [];
      
      // æ‰¾å‡ºç¢ç‰‡æœ€å¤šçš„å¡ç‰‡
      const sortedShards = Object.entries(shards)
        .filter(([, count]) => count > 0)
        .sort(([,a], [,b]) => b - a)
        .slice(0, 10);
      
      if (sortedShards.length === 0) {
        document.getElementById('shardAnalysis').innerHTML = '<div style="color: #ccc;">å°šç„¡ç¢ç‰‡è³‡æ–™</div>';
        return;
      }
      
      const shardHtml = sortedShards
        .map(([word, count]) => {
          const card = allCards.find(c => c.word === word);
          const isOwned = ownedCards[word];
          const status = isOwned ? 'âœ… å·²æ“æœ‰' : 'â³ æ”¶é›†ä¸­';
          const statusColor = isOwned ? '#00ff00' : '#ff6b6b';
          
          return `
            <div style="margin-bottom: 6px; padding: 6px; border-radius: 4px; background: rgba(255,107,107,0.1);">
              <div style="font-size: 0.9rem; color: #ff6b6b;">
                ${card ? card.zh : word} (${count} ç‰‡)
              </div>
              <div style="font-size: 0.8rem; color: ${statusColor};">${status}</div>
            </div>
          `;
        }).join('');
      
      document.getElementById('shardAnalysis').innerHTML = shardHtml;
    }

    // é¡¯ç¤ºé¡åˆ¥è©³æƒ…
    function showCategoryBreakdown() {
      const categoryStats = {};
      
      allCards.forEach(card => {
        if (!categoryStats[card.category]) {
          categoryStats[card.category] = { total: 0, collected: 0, shards: 0, cards: [] };
        }
        categoryStats[card.category].total++;
        categoryStats[card.category].cards.push(card);
        
        if (ownedCards[card.word]) {
          categoryStats[card.category].collected++;
        }
        
        const cardShards = shards[card.word] || 0;
        categoryStats[card.category].shards += cardShards;
      });
      
      let breakdownMessage = 'ğŸ·ï¸ é¡åˆ¥è©³ç´°åˆ†æ\n\n';
      
      Object.entries(categoryStats)
        .sort(([,a], [,b]) => b.collected - a.collected)
        .forEach(([category, stats]) => {
          const progress = Math.round((stats.collected / stats.total) * 100);
          breakdownMessage += `${category}:\n`;
          breakdownMessage += `â€¢ é€²åº¦: ${stats.collected}/${stats.total} (${progress}%)\n`;
          breakdownMessage += `â€¢ ç¢ç‰‡: ${stats.shards} ç‰‡\n`;
          breakdownMessage += `â€¢ ç¨€æœ‰åº¦åˆ†å¸ƒ: `;
          
          const rarityCount = {};
          stats.cards.forEach(card => {
            rarityCount[card.rarity] = (rarityCount[card.rarity] || 0) + 1;
          });
          breakdownMessage += Object.entries(rarityCount)
            .map(([rarity, count]) => `${rarity}${count}`)
            .join(' ') + '\n\n';
        });
      
      alert(breakdownMessage);
    }

    // é¡¯ç¤ºç¨€æœ‰åº¦è©³æƒ…
    function showRarityBreakdown() {
      const rarityStats = {};
      
      allCards.forEach(card => {
        if (!rarityStats[card.rarity]) {
          rarityStats[card.rarity] = { total: 0, collected: 0, shards: 0, cards: [] };
        }
        rarityStats[card.rarity].total++;
        rarityStats[card.rarity].cards.push(card);
        
        if (ownedCards[card.word]) {
          rarityStats[card.rarity].collected++;
        }
        
        const cardShards = shards[card.word] || 0;
        rarityStats[card.rarity].shards += cardShards;
      });
      
      let breakdownMessage = 'â­ ç¨€æœ‰åº¦è©³ç´°åˆ†æ\n\n';
      
      ['æ™®é€š', 'ç¨€æœ‰', 'è¶…ç¨€æœ‰'].forEach(rarity => {
        const stats = rarityStats[rarity];
        if (stats) {
          const progress = Math.round((stats.collected / stats.total) * 100);
          breakdownMessage += `${rarity}:\n`;
          breakdownMessage += `â€¢ é€²åº¦: ${stats.collected}/${stats.total} (${progress}%)\n`;
          breakdownMessage += `â€¢ ç¢ç‰‡: ${stats.shards} ç‰‡\n`;
          breakdownMessage += `â€¢ é¡åˆ¥åˆ†å¸ƒ: `;
          
          const categoryCount = {};
          stats.cards.forEach(card => {
            categoryCount[card.category] = (categoryCount[card.category] || 0) + 1;
          });
          breakdownMessage += Object.entries(categoryCount)
            .map(([category, count]) => `${category}${count}`)
            .join(' ') + '\n\n';
        }
      });
      
      alert(breakdownMessage);
    }

    // é¡¯ç¤ºæ”¶é›†å»ºè­°
    function showCollectionTips() {
      const tips = [
        'ğŸ’¡ æ”¶é›†å»ºè­°ï¼š',
        '',
        'ğŸ¯ å„ªå…ˆæ”¶é›†ç­–ç•¥ï¼š',
        'â€¢ å…ˆå®Œæˆæ™®é€šå¡ç‰‡ï¼Œç¢ç‰‡éœ€æ±‚è¼ƒå°‘',
        'â€¢ å°ˆæ³¨æ–¼ç‰¹å®šé¡åˆ¥ï¼Œæé«˜å®Œæˆåº¦',
        'â€¢ ä¿ç•™æ˜Ÿæ˜Ÿç”¨æ–¼ç¨€æœ‰å¡ç‰‡',
        '',
        'ğŸ† ç¢ç‰‡ç®¡ç†ï¼š',
        'â€¢ å„ªå…ˆæ”¶é›†æœªæ“æœ‰çš„å¡ç‰‡ç¢ç‰‡',
        'â€¢ å·²æ“æœ‰å¡ç‰‡æœƒç²å¾—æ˜Ÿæ˜Ÿè£œå„Ÿ',
        'â€¢ å®šæœŸæª¢æŸ¥ç¢ç‰‡é€²åº¦',
        '',
        'ğŸ† æˆå°±ç›®æ¨™ï¼š',
        'â€¢ å®Œæˆç‰¹å®šé¡åˆ¥æ”¶é›†',
        'â€¢ é”åˆ°ç¨€æœ‰åº¦é‡Œç¨‹ç¢‘',
        'â€¢ åˆ†äº«é€²åº¦ç²å¾—çå‹µ'
      ].join('\n');
      
      alert(tips);
    }

    // é¡¯ç¤ºä¸‹å€‹ç›®æ¨™
    function showNextTargets() {
      const categoryStats = {};
      
      allCards.forEach(card => {
        if (!categoryStats[card.category]) {
          categoryStats[card.category] = { total: 0, collected: 0, shards: 0 };
        }
        categoryStats[card.category].total++;
        
        if (ownedCards[card.word]) {
          categoryStats[card.category].collected++;
        }
        
        const cardShards = shards[card.word] || 0;
        categoryStats[card.category].shards += cardShards;
      });
      
      // æ‰¾å‡ºæœ€æ¥è¿‘å®Œæˆçš„é¡åˆ¥
      const targets = Object.entries(categoryStats)
        .map(([category, stats]) => ({
          category,
          progress: stats.collected / stats.total,
          remaining: stats.total - stats.collected,
          shards: stats.shards
        }))
        .filter(target => target.remaining > 0)
        .sort((a, b) => b.progress - a.progress)
        .slice(0, 5);
      
      let targetsMessage = 'ğŸ¯ ä¸‹å€‹æ”¶é›†ç›®æ¨™\n\n';
      
      if (targets.length === 0) {
        targetsMessage += 'ğŸ‰ æ­å–œï¼ä½ å·²ç¶“æ”¶é›†å®Œæ‰€æœ‰å¡ç‰‡ï¼';
      } else {
        targets.forEach((target, index) => {
          const progress = Math.round(target.progress * 100);
          targetsMessage += `${index + 1}. ${target.category}\n`;
          targetsMessage += `   é€²åº¦: ${progress}% (é‚„éœ€ ${target.remaining} å¼µ)\n`;
          targetsMessage += `   ç¢ç‰‡: ${target.shards} ç‰‡\n\n`;
        });
      }
      
      alert(targetsMessage);
    }

    // åŒ¯å‡ºè³‡æ–™
    function exportData() {
      const data = {
        ownedCards,
        stars,
        exportDate: new Date().toISOString()
      };
      
      const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `typing-hero-data-${new Date().toISOString().split('T')[0]}.json`;
      a.click();
      URL.revokeObjectURL(url);
      
      alert('è³‡æ–™åŒ¯å‡ºæˆåŠŸï¼');
    }

    // åŒ¯å…¥è³‡æ–™
    function importData() {
      const input = document.createElement('input');
      input.type = 'file';
      input.accept = '.json';
      input.onchange = function(e) {
        const file = e.target.files[0];
        if (file) {
          const reader = new FileReader();
          reader.onload = function(e) {
            try {
              const data = JSON.parse(e.target.result);
              
              if (data.ownedCards) ownedCards = data.ownedCards;
              if (data.stars) stars = data.stars;
              
              // å„²å­˜åˆ° localStorage
              localStorage.setItem('ownedCards', JSON.stringify(ownedCards));
              localStorage.setItem('totalStars', stars.toString());
              
              updateAllStats();
              alert('è³‡æ–™åŒ¯å…¥æˆåŠŸï¼');
            } catch (error) {
              alert('åŒ¯å…¥å¤±æ•—ï¼šæª”æ¡ˆæ ¼å¼éŒ¯èª¤');
              console.error('åŒ¯å…¥è³‡æ–™éŒ¯èª¤:', error);
            }
          };
          reader.readAsText(file);
        }
      };
      input.click();
    }

    // é‡ç½®è³‡æ–™
    function resetData() {
      if (confirm('ç¢ºå®šè¦é‡ç½®æ‰€æœ‰è³‡æ–™å—ï¼Ÿæ­¤æ“ä½œç„¡æ³•å¾©åŸã€‚')) {
        ownedCards = {};
        stars = 0;
        
        localStorage.removeItem('ownedCards');
        localStorage.removeItem('totalStars');
        
        updateAllStats();
        alert('è³‡æ–™å·²é‡ç½®');
      }
    }

    // æ¸¬è©¦è³‡æ–™
    function testData() {
      console.log('=== æ¸¬è©¦è³‡æ–™ ===');
      console.log('allCards é•·åº¦:', allCards.length);
      console.log('ownedCards:', ownedCards);
      console.log('stars:', stars);
      
      // ç”Ÿæˆä¸€äº›æ¸¬è©¦è³‡æ–™
      if (allCards.length > 0) {
        const testCard = allCards[0];
        if (!ownedCards[testCard.word]) {
          ownedCards[testCard.word] = true;
        }
        stars = 100;
        
        localStorage.setItem('ownedCards', JSON.stringify(ownedCards));
        localStorage.setItem('totalStars', stars.toString());
        
        updateAllStats();
        alert('å·²ç”Ÿæˆæ¸¬è©¦è³‡æ–™ï¼');
      } else {
        alert('ç„¡æ³•ç”Ÿæˆæ¸¬è©¦è³‡æ–™ï¼šcards.js å°šæœªè¼‰å…¥');
      }
    }

    // æ¸¬è©¦é é¢é¡¯ç¤º
    function testPageDisplay() {
      console.log('=== æ¸¬è©¦é é¢é¡¯ç¤º ===');
      
      // æª¢æŸ¥å¿…è¦å…ƒç´ æ˜¯å¦å­˜åœ¨
      const elements = [
        'totalCards', 'collectedCards', 'completionRate',
        'totalCardsDetail', 'collectedCardsDetail', 'collectionProgressPercent', 'totalShards'
      ];
      
      elements.forEach(id => {
        const element = document.getElementById(id);
        if (element) {
          console.log(`âœ“ ${id} å…ƒç´ å­˜åœ¨`);
          element.textContent = 'æ¸¬è©¦';
        } else {
          console.error(`âœ— ${id} å…ƒç´ ä¸å­˜åœ¨`);
        }
      });
      
      // ç”Ÿæˆæ¸¬è©¦è³‡æ–™
      if (allCards.length > 0) {
        const testCard = allCards[0];
        if (!ownedCards[testCard.word]) {
          ownedCards[testCard.word] = true;
        }
        stars = 100;
        
        localStorage.setItem('ownedCards', JSON.stringify(ownedCards));
        localStorage.setItem('totalStars', stars.toString());
        
        updateAllStats();
        alert('æ¸¬è©¦è³‡æ–™å·²ç”Ÿæˆï¼è«‹æª¢æŸ¥é é¢é¡¯ç¤ºæ˜¯å¦æ­£å¸¸ã€‚');
      } else {
        alert('ç„¡æ³•ç”Ÿæˆæ¸¬è©¦è³‡æ–™ï¼šcards.js å°šæœªè¼‰å…¥');
      }
    }

    // é é¢è¼‰å…¥å®Œæˆå¾Œè‡ªå‹•æ¸¬è©¦
    window.addEventListener('load', function() {
      setTimeout(function() {
        console.log('é é¢è¼‰å…¥å®Œæˆï¼Œé–‹å§‹æ¸¬è©¦...');
        testPageDisplay();
        initLeaderboard();
        initDiscussionTopics();
      }, 2000); // å»¶é² 2 ç§’æ¸¬è©¦ï¼Œç¢ºä¿æ‰€æœ‰è³‡æºå·²è¼‰å…¥
    });

    // åˆå§‹åŒ–æ’è¡Œæ¦œ
    function initLeaderboard() {
      const leaderboardList = document.getElementById('leaderboardList');
      if (!leaderboardList) return;
      
      // æ¨¡æ“¬æ’è¡Œæ¦œè³‡æ–™
      const mockLeaderboard = [
        { name: 'æ”¶é›†å¤§å¸«', cards: 95, level: 'å‚³å¥‡' },
        { name: 'å¡ç‰‡çµäºº', cards: 87, level: 'å°ˆå®¶' },
        { name: 'æ”¶è—å®¶', cards: 76, level: 'å¤§å¸«' },
        { name: 'æ–°æ‰‹ç©å®¶', cards: 45, level: 'é€²éš' },
        { name: 'å‰›é–‹å§‹', cards: 23, level: 'æ–°æ‰‹' }
      ];
      
      const leaderboardHtml = mockLeaderboard.map((player, index) => `
        <div class="leaderboard-item">
          <div class="rank">#${index + 1}</div>
          <div class="player-info">
            <div class="player-name">${player.name}</div>
            <div class="player-stats">ç­‰ç´šï¼š${player.level}</div>
          </div>
          <div class="player-score">${player.cards} å¼µ</div>
        </div>
      `).join('');
      
      leaderboardList.innerHTML = leaderboardHtml;
    }

    // åˆå§‹åŒ–è¨è«–ä¸»é¡Œ
    function initDiscussionTopics() {
      const discussionTopics = document.getElementById('discussionTopics');
      if (!discussionTopics) return;
      
      const mockTopics = [
        {
          title: 'æœ€é›£æ”¶é›†çš„å¡ç‰‡æ˜¯å“ªå¼µï¼Ÿ',
          desc: 'å¤§å®¶è¦ºå¾—å“ªå¼µå¡ç‰‡çš„ç¢ç‰‡æœ€é›£æ”¶é›†ï¼Ÿåˆ†äº«ä½ çš„æ”¶é›†å¿ƒå¾—ï¼',
          author: 'æ”¶é›†å¤§å¸«',
          replies: 15,
          views: 128
        },
        {
          title: 'ç¢ç‰‡ç³»çµ±çš„æ”¹é€²å»ºè­°',
          desc: 'å°æ–¼ç•¶å‰çš„ç¢ç‰‡æ”¶é›†æ©Ÿåˆ¶ï¼Œå¤§å®¶æœ‰ä»€éº¼æƒ³æ³•å’Œå»ºè­°å—ï¼Ÿ',
          author: 'å¡ç‰‡çµäºº',
          replies: 8,
          views: 89
        },
        {
          title: 'ç¨€æœ‰å¡ç‰‡å±•ç¤º',
          desc: 'ä¾†æ›¬æ›¬ä½ çš„ç¨€æœ‰å¡ç‰‡æ”¶è—å§ï¼çœ‹çœ‹èª°çš„æ”¶è—æœ€å²å®³ï¼',
          author: 'æ”¶è—å®¶',
          replies: 23,
          views: 256
        },
        {
          title: 'æ”¶é›†ç­–ç•¥åˆ†äº«',
          desc: 'å¤§å®¶éƒ½æ˜¯ç”¨ä»€éº¼ç­–ç•¥ä¾†æ”¶é›†å¡ç‰‡çš„ï¼Ÿæœ‰ä»€éº¼å°æŠ€å·§å—ï¼Ÿ',
          author: 'æ–°æ‰‹ç©å®¶',
          replies: 12,
          views: 156
        }
      ];
      
      const topicsHtml = mockTopics.map(topic => `
        <div class="topic-item">
          <div class="topic-title">${topic.title}</div>
          <div class="topic-desc">${topic.desc}</div>
          <div class="topic-meta">
            <span>ä½œè€…ï¼š${topic.author}</span>
            <span>ğŸ’¬ ${topic.replies} | ğŸ‘ï¸ ${topic.views}</span>
          </div>
        </div>
      `).join('');
      
      discussionTopics.innerHTML = topicsHtml;
    }

    // åˆ†äº«é€²åº¦
    function shareProgress() {
      const totalCards = allCards.length;
      const collectedCards = Object.keys(ownedCards).length;
      const collectionProgress = totalCards > 0 ? Math.round((collectedCards / totalCards) * 100) : 0;
      
      const shareText = `ğŸ¯ æˆ‘åœ¨ Typing Hero ä¸­å·²æ”¶é›† ${collectedCards}/${totalCards} å¼µå¡ç‰‡ï¼Œå®Œæˆåº¦ ${collectionProgress}%ï¼\n\nğŸ† ä¸€èµ·ä¾†æŒ‘æˆ°æ”¶é›†æ‰€æœ‰å¡ç‰‡å§ï¼`;
      
      if (navigator.share) {
        navigator.share({
          title: 'Typing Hero æ”¶é›†é€²åº¦',
          text: shareText,
          url: window.location.href
        });
      } else {
        // è¤‡è£½åˆ°å‰ªè²¼ç°¿
        navigator.clipboard.writeText(shareText).then(() => {
          showNotification('ğŸ“‹ åˆ†äº«å…§å®¹å·²è¤‡è£½åˆ°å‰ªè²¼ç°¿ï¼');
        }).catch(() => {
          alert(shareText);
        });
      }
    }

    // åˆ†äº«æˆå°±
    function shareAchievement() {
      const totalCards = allCards.length;
      const collectedCards = Object.keys(ownedCards).length;
      const totalShards = Object.values(shards).reduce((sum, count) => sum + count, 0);
      
      let achievement = 'æ–°æ‰‹æ”¶é›†è€…';
      if (collectedCards >= 100) achievement = 'å¡ç‰‡å‚³å¥‡';
      else if (collectedCards >= 50) achievement = 'å¡ç‰‡å°ˆå®¶';
      else if (collectedCards >= 20) achievement = 'å¡ç‰‡å¤§å¸«';
      else if (collectedCards >= 10) achievement = 'æ”¶è—å®¶';
      else if (collectedCards >= 1) achievement = 'åˆæ¬¡æ”¶é›†';
      
      const shareText = `ğŸ† æˆ‘åœ¨ Typing Hero ä¸­ç²å¾—ã€Œ${achievement}ã€æˆå°±ï¼\n\nğŸ“Š æ”¶é›†é€²åº¦ï¼š${collectedCards}/${totalCards} å¼µå¡ç‰‡\nğŸ’ ç¸½ç¢ç‰‡ï¼š${totalShards} ç‰‡\n\nğŸ® ä¸€èµ·ä¾†æŒ‘æˆ°æ›´é«˜æˆå°±å§ï¼`;
      
      if (navigator.share) {
        navigator.share({
          title: 'Typing Hero æˆå°±åˆ†äº«',
          text: shareText,
          url: window.location.href
        });
      } else {
        navigator.clipboard.writeText(shareText).then(() => {
          showNotification('ğŸ“‹ æˆå°±åˆ†äº«å…§å®¹å·²è¤‡è£½åˆ°å‰ªè²¼ç°¿ï¼');
        }).catch(() => {
          alert(shareText);
        });
      }
    }

    // åˆ†äº«ç¨€æœ‰åº¦
    function shareRarity() {
      const rarityStats = {};
      
      allCards.forEach(card => {
        if (!rarityStats[card.rarity]) {
          rarityStats[card.rarity] = { total: 0, collected: 0 };
        }
        rarityStats[card.rarity].total++;
        if (ownedCards[card.word]) {
          rarityStats[card.rarity].collected++;
        }
      });
      
      const shareText = `â­ æˆ‘çš„ç¨€æœ‰åº¦æ”¶é›†ç‹€æ³ï¼š\n\n${Object.entries(rarityStats).map(([rarity, stats]) => {
        const progress = Math.round((stats.collected / stats.total) * 100);
        return `${rarity}ï¼š${stats.collected}/${stats.total} (${progress}%)`;
      }).join('\n')}\n\nğŸ¯ ä¸€èµ·ä¾†æ”¶é›†ç¨€æœ‰å¡ç‰‡å§ï¼`;
      
      if (navigator.share) {
        navigator.share({
          title: 'Typing Hero ç¨€æœ‰åº¦åˆ†äº«',
          text: shareText,
          url: window.location.href
        });
      } else {
        navigator.clipboard.writeText(shareText).then(() => {
          showNotification('ğŸ“‹ ç¨€æœ‰åº¦åˆ†äº«å…§å®¹å·²è¤‡è£½åˆ°å‰ªè²¼ç°¿ï¼');
        }).catch(() => {
          alert(shareText);
        });
      }
    }

    // åˆ†äº«æ”¶è—
    function shareCollection() {
      const totalCards = allCards.length;
      const collectedCards = Object.keys(ownedCards).length;
      const totalShards = Object.values(shards).reduce((sum, count) => sum + count, 0);
      
      // æ‰¾å‡ºæœ€ç¨€æœ‰çš„å·²æ”¶é›†å¡ç‰‡
      const ownedCardList = allCards.filter(card => ownedCards[card.word]);
      const rarestCard = ownedCardList.sort((a, b) => {
        const rarityOrder = { 'æ™®é€š': 1, 'ç¨€æœ‰': 2, 'è¶…ç¨€æœ‰': 3 };
        return rarityOrder[b.rarity] - rarityOrder[a.rarity];
      })[0];
      
      const shareText = `ğŸ“š æˆ‘çš„æ”¶è—å±•ç¤ºï¼š\n\nğŸ† æœ€ç¨€æœ‰å¡ç‰‡ï¼š${rarestCard ? `${rarestCard.zh} (${rarestCard.rarity})` : 'å°šç„¡'}\nğŸ“Š æ”¶é›†é€²åº¦ï¼š${collectedCards}/${totalCards} å¼µ\nğŸ’ ç¸½ç¢ç‰‡ï¼š${totalShards} ç‰‡\n\nğŸ® ä¸€èµ·ä¾†å»ºç«‹ä½ çš„æ”¶è—å§ï¼`;
      
      if (navigator.share) {
        navigator.share({
          title: 'Typing Hero æ”¶è—åˆ†äº«',
          text: shareText,
          url: window.location.href
        });
      } else {
        navigator.clipboard.writeText(shareText).then(() => {
          showNotification('ğŸ“‹ æ”¶è—åˆ†äº«å…§å®¹å·²è¤‡è£½åˆ°å‰ªè²¼ç°¿ï¼');
        }).catch(() => {
          alert(shareText);
        });
      }
    }

    // é¡¯ç¤ºé€šçŸ¥
    function showNotification(message) {
      const notification = document.createElement('div');
      notification.className = 'notification';
      notification.textContent = message;
      document.body.appendChild(notification);
      
      setTimeout(() => {
        notification.remove();
      }, 3000);
    }

    // æ¸¬è©¦è³‡æ–™é€£å‹•
    function testDataSync() {
      console.log('=== æ¸¬è©¦è³‡æ–™é€£å‹• ===');
      
      // é‡æ–°è¼‰å…¥è³‡æ–™
      loadUserData();
      
      // æª¢æŸ¥è³‡æ–™
      const totalCards = allCards.length;
      const collectedCards = Object.keys(ownedCards).length;
      const totalShards = Object.values(shards).reduce((sum, count) => sum + count, 0);
      
      console.log('allCards é•·åº¦:', totalCards);
      console.log('ownedCards:', ownedCards);
      console.log('stars:', stars);
      
      // æª¢æŸ¥ localStorage
      const localStorageOwnedCards = localStorage.getItem('ownedCards');
      const localStorageStars = localStorage.getItem('totalStars');
      
      console.log('localStorage ownedCards:', localStorageOwnedCards);
      console.log('localStorage totalStars:', localStorageStars);
      
      // ç”Ÿæˆæ¸¬è©¦å ±å‘Š
      let report = 'ğŸ§ª è³‡æ–™é€£å‹•æ¸¬è©¦å ±å‘Š\n\n';
      report += `ğŸ“Š åŸºæœ¬çµ±è¨ˆï¼š\n`;
      report += `â€¢ ç¸½å¡ç‰‡æ•¸ï¼š${totalCards}\n`;
      report += `â€¢ å·²æ”¶é›†ï¼š${collectedCards}\n`;
      report += `â€¢ ç¸½ç¢ç‰‡ï¼š${totalShards}\n`;
      report += `â€¢ æ˜Ÿæ˜Ÿæ•¸ï¼š${stars}\n\n`;
      
      report += `ğŸ’¾ localStorage ç‹€æ…‹ï¼š\n`;
      report += `â€¢ ownedCardsï¼š${localStorageOwnedCards ? 'âœ… å­˜åœ¨' : 'âŒ ä¸å­˜åœ¨'}\n`;
      report += `â€¢ totalStarsï¼š${localStorageStars ? 'âœ… å­˜åœ¨' : 'âŒ ä¸å­˜åœ¨'}\n\n`;
      
      // æª¢æŸ¥è³‡æ–™ä¸€è‡´æ€§
      const ownedCardsFromStorage = localStorageOwnedCards ? JSON.parse(localStorageOwnedCards) : {};
      const starsFromStorage = localStorageStars ? parseInt(localStorageStars) : 0;
      
      const ownedCardsMatch = JSON.stringify(ownedCards) === JSON.stringify(ownedCardsFromStorage);
      const starsMatch = stars === starsFromStorage;
      
      report += `ğŸ”— è³‡æ–™ä¸€è‡´æ€§ï¼š\n`;
      report += `â€¢ ownedCardsï¼š${ownedCardsMatch ? 'âœ… ä¸€è‡´' : 'âŒ ä¸ä¸€è‡´'}\n`;
      report += `â€¢ starsï¼š${starsMatch ? 'âœ… ä¸€è‡´' : 'âŒ ä¸ä¸€è‡´'}\n\n`;
      
      if (ownedCardsMatch && starsMatch) {
        report += 'ğŸ‰ æ‰€æœ‰è³‡æ–™é€£å‹•æ­£å¸¸ï¼';
      } else {
        report += 'âš ï¸ ç™¼ç¾è³‡æ–™ä¸ä¸€è‡´ï¼Œè«‹æª¢æŸ¥ localStorage è¨­å®šã€‚';
      }
      
      alert(report);
      
      // æ›´æ–°é é¢é¡¯ç¤º
      updateAllStats();
    }
  </script>
</body>
</html>