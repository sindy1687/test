<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¡ç‰‡è³‡æ–™æ¸¬è©¦</title>
    <style>
        body {
            font-family: 'Inter', 'Noto Sans TC', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            margin: 0;
            padding: 20px;
            min-height: 100vh;
            color: white;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }
        
        h1 {
            text-align: center;
            margin-bottom: 30px;
            color: #ffd700;
        }
        
        .test-section {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .test-section h2 {
            color: #00ffff;
            margin-top: 0;
        }
        
        .result {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
            font-family: monospace;
            white-space: pre-wrap;
            max-height: 300px;
            overflow-y: auto;
        }
        
        .button {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            cursor: pointer;
            font-weight: bold;
            margin: 5px;
            transition: all 0.3s ease;
        }
        
        .button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }
        
        .status {
            padding: 10px;
            border-radius: 8px;
            margin: 10px 0;
            font-weight: bold;
        }
        
        .status.success {
            background: rgba(0, 255, 0, 0.2);
            border: 1px solid #00ff00;
            color: #00ff00;
        }
        
        .status.error {
            background: rgba(255, 0, 0, 0.2);
            border: 1px solid #ff0000;
            color: #ff0000;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ” å¡ç‰‡è³‡æ–™æ¸¬è©¦å·¥å…·</h1>
        
        <div class="test-section">
            <h2>ğŸ“Š ç³»çµ±ç‹€æ…‹</h2>
            <div id="systemStatus"></div>
            <button class="button" onclick="checkSystem()">æª¢æŸ¥ç³»çµ±</button>
        </div>
        
        <div class="test-section">
            <h2>ğŸ´ å¡ç‰‡è³‡æ–™</h2>
            <div id="cardData"></div>
            <button class="button" onclick="checkCardData()">æª¢æŸ¥å¡ç‰‡è³‡æ–™</button>
        </div>
        
        <div class="test-section">
            <h2>ğŸ’ ç¢ç‰‡è³‡æ–™</h2>
            <div id="shardData"></div>
            <button class="button" onclick="checkShardData()">æª¢æŸ¥ç¢ç‰‡è³‡æ–™</button>
        </div>
        
        <div class="test-section">
            <h2>ğŸ”§ æ¸¬è©¦æ“ä½œ</h2>
            <button class="button" onclick="testAddCard()">æ¸¬è©¦æ–°å¢å¡ç‰‡</button>
            <button class="button" onclick="testAddShard()">æ¸¬è©¦æ–°å¢ç¢ç‰‡</button>
            <button class="button" onclick="testUnlockCard()">æ¸¬è©¦è§£é–å¡ç‰‡</button>
            <button class="button" onclick="clearTestData()">æ¸…é™¤æ¸¬è©¦è³‡æ–™</button>
        </div>
    </div>

    <script src="js/userData.js"></script>
    <script src="js/cardStorage.js"></script>
    <script>
        function checkSystem() {
            const status = document.getElementById('systemStatus');
            
            let result = 'ç³»çµ±æª¢æŸ¥çµæœï¼š\n\n';
            
            // æª¢æŸ¥ LinkageSystem
            if (typeof LinkageSystem === 'undefined') {
                result += 'âŒ LinkageSystem æœªè¼‰å…¥\n';
            } else {
                result += 'âœ… LinkageSystem å·²è¼‰å…¥\n';
            }
            
            // æª¢æŸ¥ allCards
            if (typeof window.allCards === 'undefined') {
                result += 'âŒ allCards æœªè¼‰å…¥\n';
            } else {
                result += `âœ… allCards å·²è¼‰å…¥ (${window.allCards.length} å¼µå¡ç‰‡)\n`;
            }
            
            // æª¢æŸ¥ localStorage
            try {
                const ownedCards = localStorage.getItem('ownedCards');
                const cardShards = localStorage.getItem('cardShards');
                result += `âœ… localStorage æª¢æŸ¥ï¼š\n`;
                result += `  - ownedCards: ${ownedCards ? 'å­˜åœ¨' : 'ä¸å­˜åœ¨'}\n`;
                result += `  - cardShards: ${cardShards ? 'å­˜åœ¨' : 'ä¸å­˜åœ¨'}\n`;
            } catch (e) {
                result += `âŒ localStorage éŒ¯èª¤: ${e.message}\n`;
            }
            
            status.innerHTML = `<div class="result">${result}</div>`;
        }

        function checkCardData() {
            const data = document.getElementById('cardData');
            
            if (typeof LinkageSystem === 'undefined') {
                data.innerHTML = '<div class="status error">âŒ LinkageSystem æœªè¼‰å…¥</div>';
                return;
            }
            
            const ownedCards = LinkageSystem.cards.getOwnedCards();
            const totalCards = window.allCards ? window.allCards.length : 0;
            
            let result = 'å¡ç‰‡è³‡æ–™æª¢æŸ¥çµæœï¼š\n\n';
            result += `ç¸½å¡ç‰‡æ•¸: ${totalCards}\n`;
            result += `å·²è§£é–å¡ç‰‡æ•¸: ${Object.keys(ownedCards).length}\n`;
            result += `è§£é–é€²åº¦: ${totalCards > 0 ? (Object.keys(ownedCards).length / totalCards * 100).toFixed(1) : 0}%\n\n`;
            
            result += 'å·²è§£é–çš„å¡ç‰‡ï¼š\n';
            Object.keys(ownedCards).forEach(cardWord => {
                const card = window.allCards.find(c => c.word === cardWord);
                if (card) {
                    result += `  - ${card.zh} (${card.word}) [${card.rarity}]\n`;
                } else {
                    result += `  - ${cardWord} [ç„¡æ•ˆå¡ç‰‡]\n`;
                }
            });
            
            data.innerHTML = `<div class="result">${result}</div>`;
        }

        function checkShardData() {
            const data = document.getElementById('shardData');
            
            if (typeof LinkageSystem === 'undefined') {
                data.innerHTML = '<div class="status error">âŒ LinkageSystem æœªè¼‰å…¥</div>';
                return;
            }
            
            const shards = LinkageSystem.cards.getShards();
            const totalShards = Object.values(shards).reduce((sum, count) => sum + (parseInt(count) || 0), 0);
            
            let result = 'ç¢ç‰‡è³‡æ–™æª¢æŸ¥çµæœï¼š\n\n';
            result += `ç¢ç‰‡ç¨®é¡æ•¸: ${Object.keys(shards).length}\n`;
            result += `ç¸½ç¢ç‰‡æ•¸: ${totalShards}\n\n`;
            
            result += 'ç¢ç‰‡è©³ç´°è³‡æ–™ï¼š\n';
            Object.entries(shards).forEach(([cardWord, count]) => {
                const card = window.allCards.find(c => c.word === cardWord);
                if (card) {
                    const required = getRequiredShards(card.rarity);
                    const isUnlocked = LinkageSystem.cards.isCardOwned(cardWord);
                    const status = isUnlocked ? 'å·²è§£é–' : 'æœªè§£é–';
                    const progress = `${count}/${required}`;
                    result += `  - ${card.zh} (${cardWord}): ${count} ç‰‡ [${progress}] [${status}]\n`;
                } else {
                    result += `  - ${cardWord}: ${count} ç‰‡ [ç„¡æ•ˆå¡ç‰‡]\n`;
                }
            });
            
            data.innerHTML = `<div class="result">${result}</div>`;
        }

        function testAddCard() {
            if (typeof LinkageSystem === 'undefined') {
                alert('LinkageSystem æœªè¼‰å…¥');
                return;
            }
            
            // æ¸¬è©¦æ–°å¢ç¬¬ä¸€å¼µå¡ç‰‡
            const firstCard = window.allCards[0];
            if (firstCard) {
                LinkageSystem.cards.addCard(firstCard.word);
                alert(`æ¸¬è©¦æ–°å¢å¡ç‰‡: ${firstCard.zh} (${firstCard.word})`);
                checkCardData();
            } else {
                alert('æ²’æœ‰å¯ç”¨çš„å¡ç‰‡é€²è¡Œæ¸¬è©¦');
            }
        }

        function testAddShard() {
            if (typeof LinkageSystem === 'undefined') {
                alert('LinkageSystem æœªè¼‰å…¥');
                return;
            }
            
            // æ¸¬è©¦æ–°å¢ç¬¬ä¸€å¼µå¡ç‰‡çš„ç¢ç‰‡
            const firstCard = window.allCards[0];
            if (firstCard) {
                LinkageSystem.cards.addShard(firstCard.word, 1);
                alert(`æ¸¬è©¦æ–°å¢ç¢ç‰‡: ${firstCard.zh} (${firstCard.word}) +1`);
                checkShardData();
            } else {
                alert('æ²’æœ‰å¯ç”¨çš„å¡ç‰‡é€²è¡Œæ¸¬è©¦');
            }
        }

        function testUnlockCard() {
            if (typeof LinkageSystem === 'undefined') {
                alert('LinkageSystem æœªè¼‰å…¥');
                return;
            }
            
            // æ‰¾åˆ°ä¸€å¼µæœ‰ç¢ç‰‡çš„å¡ç‰‡é€²è¡Œæ¸¬è©¦
            const shards = LinkageSystem.cards.getShards();
            const cardWithShards = Object.keys(shards).find(cardWord => {
                const card = window.allCards.find(c => c.word === cardWord);
                if (!card) return false;
                
                const required = getRequiredShards(card.rarity);
                const count = shards[cardWord] || 0;
                return count >= required && !LinkageSystem.cards.isCardOwned(cardWord);
            });
            
            if (cardWithShards) {
                const card = window.allCards.find(c => c.word === cardWithShards);
                LinkageSystem.cards.addCard(cardWithShards);
                alert(`æ¸¬è©¦è§£é–å¡ç‰‡: ${card.zh} (${card.word})`);
                checkCardData();
                checkShardData();
            } else {
                alert('æ²’æœ‰å¯ä»¥è§£é–çš„å¡ç‰‡');
            }
        }

        function clearTestData() {
            if (confirm('ç¢ºå®šè¦æ¸…é™¤æ‰€æœ‰æ¸¬è©¦è³‡æ–™å—ï¼Ÿ')) {
                localStorage.removeItem('ownedCards');
                localStorage.removeItem('cardShards');
                localStorage.removeItem('recentlyObtainedCards');
                localStorage.removeItem('newCardTimestamps');
                alert('æ¸¬è©¦è³‡æ–™å·²æ¸…é™¤');
                checkCardData();
                checkShardData();
            }
        }

        function getRequiredShards(rarity) {
            switch (rarity) {
                case 'è¶…ç¨€æœ‰': return 5;
                case 'ç¨€æœ‰': return 3;
                case 'æ™®é€š': return 1;
                default: return 1;
            }
        }

        // é é¢è¼‰å…¥æ™‚è‡ªå‹•æª¢æŸ¥
        window.addEventListener('load', () => {
            setTimeout(() => {
                checkSystem();
                checkCardData();
                checkShardData();
            }, 1000);
        });
    </script>
</body>
</html> 