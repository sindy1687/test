<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¡ç‰‡æ¢å¾©é–å®šå•é¡Œæ¸¬è©¦</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f0f0f0;
        }
        .container {
            max-width: 1000px;
            margin: 0 auto;
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
            font-weight: bold;
        }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .info { background: #d1ecf1; color: #0c5460; }
        .warning { background: #fff3cd; color: #856404; }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #0056b3;
        }
        .card {
            background: white;
            border-radius: 10px;
            padding: 15px;
            margin: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            display: inline-block;
            width: 200px;
            text-align: center;
        }
        .card.unlocked {
            border: 3px solid #28a745;
        }
        .card.locked {
            border: 3px solid #dc3545;
            opacity: 0.6;
        }
        .debug-info {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 5px;
            padding: 15px;
            margin: 10px 0;
            font-family: monospace;
            font-size: 12px;
            white-space: pre-wrap;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ” å¡ç‰‡æ¢å¾©é–å®šå•é¡Œæ¸¬è©¦</h1>
        
        <div id="status" class="status info">æ­£åœ¨è¼‰å…¥...</div>
        
        <div>
            <button onclick="checkLinkageSystem()">ğŸ”— æª¢æŸ¥ LinkageSystem</button>
            <button onclick="checkLocalStorage()">ğŸ’¾ æª¢æŸ¥ localStorage</button>
            <button onclick="checkAllCards()">ğŸ´ æª¢æŸ¥ allCards</button>
            <button onclick="loadCardData()">ğŸ“¥ é‡æ–°è¼‰å…¥å¡ç‰‡è³‡æ–™</button>
            <button onclick="renderTestCards()">ğŸ”„ é‡æ–°æ¸²æŸ“æ¸¬è©¦å¡ç‰‡</button>
            <button onclick="addTestCards()">â• æ·»åŠ æ¸¬è©¦å¡ç‰‡</button>
            <button onclick="clearTestCards()">ğŸ—‘ï¸ æ¸…é™¤æ¸¬è©¦å¡ç‰‡</button>
        </div>
        
        <div id="debugInfo" class="debug-info">ç­‰å¾…æ¸¬è©¦...</div>
        
        <div id="testCards"></div>
    </div>

    <!-- è¼‰å…¥å¿…è¦çš„è…³æœ¬ -->
    <script src="js/userData.js"></script>
    <script src="cards.js"></script>
    
    <script>
        let ownedCards = {};
        let shards = {};
        let recentlyObtainedCards = [];
        
        // æª¢æŸ¥ LinkageSystem
        function checkLinkageSystem() {
            const status = document.getElementById('status');
            const debugInfo = document.getElementById('debugInfo');
            
            let info = '=== LinkageSystem æª¢æŸ¥ ===\n';
            
            if (typeof LinkageSystem === 'undefined') {
                status.className = 'status error';
                status.textContent = 'âŒ LinkageSystem æœªå®šç¾©';
                info += 'âŒ LinkageSystem æœªå®šç¾©\n';
            } else {
                status.className = 'status success';
                status.textContent = 'âœ… LinkageSystem å·²è¼‰å…¥';
                info += 'âœ… LinkageSystem å·²è¼‰å…¥\n';
                
                if (LinkageSystem.cards) {
                    info += 'âœ… LinkageSystem.cards å¯ç”¨\n';
                    
                    try {
                        const owned = LinkageSystem.cards.getOwnedCards();
                        const cardShards = LinkageSystem.cards.getShards();
                        info += `âœ… å·²è§£é–å¡ç‰‡æ•¸: ${Object.keys(owned).length}\n`;
                        info += `âœ… ç¢ç‰‡ç¨®é¡æ•¸: ${Object.keys(cardShards).length}\n`;
                        info += `å·²è§£é–å¡ç‰‡: ${JSON.stringify(Object.keys(owned))}\n`;
                    } catch (e) {
                        info += `âŒ è®€å–å¡ç‰‡è³‡æ–™å¤±æ•—: ${e.message}\n`;
                    }
                } else {
                    info += 'âŒ LinkageSystem.cards ä¸å¯ç”¨\n';
                }
            }
            
            debugInfo.textContent = info;
        }
        
        // æª¢æŸ¥ localStorage
        function checkLocalStorage() {
            const status = document.getElementById('status');
            const debugInfo = document.getElementById('debugInfo');
            
            let info = '=== localStorage æª¢æŸ¥ ===\n';
            
            const ownedCardsStr = localStorage.getItem('ownedCards');
            const shardsStr = localStorage.getItem('cardShards');
            const recentlyStr = localStorage.getItem('recentlyObtainedCards');
            
            if (ownedCardsStr) {
                try {
                    const owned = JSON.parse(ownedCardsStr);
                    info += `âœ… ownedCards: ${Object.keys(owned).length} å¼µ\n`;
                    info += `å·²è§£é–å¡ç‰‡: ${JSON.stringify(Object.keys(owned))}\n`;
                } catch (e) {
                    info += `âŒ è§£æ ownedCards å¤±æ•—: ${e.message}\n`;
                }
            } else {
                info += 'âŒ localStorage ä¸­æ²’æœ‰ ownedCards\n';
            }
            
            if (shardsStr) {
                try {
                    const cardShards = JSON.parse(shardsStr);
                    info += `âœ… cardShards: ${Object.keys(cardShards).length} ç¨®\n`;
                    info += `ç¢ç‰‡è³‡æ–™: ${JSON.stringify(cardShards)}\n`;
                } catch (e) {
                    info += `âŒ è§£æ cardShards å¤±æ•—: ${e.message}\n`;
                }
            } else {
                info += 'âŒ localStorage ä¸­æ²’æœ‰ cardShards\n';
            }
            
            if (recentlyStr) {
                try {
                    const recent = JSON.parse(recentlyStr);
                    info += `âœ… recentlyObtainedCards: ${recent.length} å¼µ\n`;
                    info += `æœ€è¿‘ç²å¾—: ${JSON.stringify(recent)}\n`;
                } catch (e) {
                    info += `âŒ è§£æ recentlyObtainedCards å¤±æ•—: ${e.message}\n`;
                }
            } else {
                info += 'âŒ localStorage ä¸­æ²’æœ‰ recentlyObtainedCards\n';
            }
            
            status.className = 'status info';
            status.textContent = 'ğŸ“Š localStorage æª¢æŸ¥å®Œæˆ';
            debugInfo.textContent = info;
        }
        
        // æª¢æŸ¥ allCards
        function checkAllCards() {
            const status = document.getElementById('status');
            const debugInfo = document.getElementById('debugInfo');
            
            let info = '=== allCards æª¢æŸ¥ ===\n';
            
            if (typeof window.allCards === 'undefined') {
                status.className = 'status error';
                status.textContent = 'âŒ allCards æœªå®šç¾©';
                info += 'âŒ allCards æœªå®šç¾©\n';
            } else if (!Array.isArray(window.allCards)) {
                status.className = 'status error';
                status.textContent = 'âŒ allCards ä¸æ˜¯é™£åˆ—';
                info += 'âŒ allCards ä¸æ˜¯é™£åˆ—\n';
            } else if (window.allCards.length === 0) {
                status.className = 'status warning';
                status.textContent = 'âš ï¸ allCards æ˜¯ç©ºé™£åˆ—';
                info += 'âš ï¸ allCards æ˜¯ç©ºé™£åˆ—\n';
            } else {
                status.className = 'status success';
                status.textContent = `âœ… allCards è¼‰å…¥æˆåŠŸ (${window.allCards.length} å¼µ)`;
                info += `âœ… allCards è¼‰å…¥æˆåŠŸ: ${window.allCards.length} å¼µ\n`;
                
                // æª¢æŸ¥æ°´æœå¡ç‰‡æ˜¯å¦å­˜åœ¨
                const fruitCards = ['apple', 'banana', 'orange', 'grape', 'strawberry'];
                fruitCards.forEach(fruit => {
                    const found = window.allCards.find(card => card.word === fruit);
                    if (found) {
                        info += `âœ… æ‰¾åˆ°æ°´æœå¡ç‰‡: ${fruit}\n`;
                    } else {
                        info += `âŒ æ‰¾ä¸åˆ°æ°´æœå¡ç‰‡: ${fruit}\n`;
                    }
                });
                
                // é¡¯ç¤ºå‰5å¼µå¡ç‰‡
                info += '\nå‰5å¼µå¡ç‰‡:\n';
                window.allCards.slice(0, 5).forEach((card, index) => {
                    info += `${index + 1}. ${card.word} (${card.zh}) - ${card.rarity}\n`;
                });
            }
            
            debugInfo.textContent = info;
        }
        
        // è¼‰å…¥å¡ç‰‡è³‡æ–™
        function loadCardData() {
            const status = document.getElementById('status');
            const debugInfo = document.getElementById('debugInfo');
            
            let info = '=== è¼‰å…¥å¡ç‰‡è³‡æ–™ ===\n';
            
            try {
                if (typeof LinkageSystem !== 'undefined' && LinkageSystem.cards) {
                    info += 'âœ… ä½¿ç”¨ LinkageSystem è¼‰å…¥å¡ç‰‡è³‡æ–™\n';
                    ownedCards = LinkageSystem.cards.getOwnedCards();
                    shards = LinkageSystem.cards.getShards();
                } else {
                    info += 'âš ï¸ LinkageSystem ä¸å¯ç”¨ï¼Œä½¿ç”¨ localStorage è¼‰å…¥\n';
                    const ownedCardsStr = localStorage.getItem('ownedCards');
                    const shardsStr = localStorage.getItem('cardShards');
                    
                    if (ownedCardsStr) {
                        ownedCards = JSON.parse(ownedCardsStr);
                        info += 'âœ… å¾ localStorage è¼‰å…¥ ownedCards æˆåŠŸ\n';
                    } else {
                        ownedCards = {};
                        info += 'âš ï¸ localStorage ä¸­æ²’æœ‰ ownedCards\n';
                    }
                    
                    if (shardsStr) {
                        shards = JSON.parse(shardsStr);
                        info += 'âœ… å¾ localStorage è¼‰å…¥ cardShards æˆåŠŸ\n';
                    } else {
                        shards = {};
                        info += 'âš ï¸ localStorage ä¸­æ²’æœ‰ cardShards\n';
                    }
                }
                
                const recentlyObtainedStr = localStorage.getItem('recentlyObtainedCards');
                if (recentlyObtainedStr) {
                    recentlyObtainedCards = JSON.parse(recentlyObtainedStr);
                    info += 'âœ… è¼‰å…¥ recentlyObtainedCards æˆåŠŸ\n';
                } else {
                    recentlyObtainedCards = [];
                    info += 'âš ï¸ localStorage ä¸­æ²’æœ‰ recentlyObtainedCards\n';
                }
                
                info += `\nğŸ“Š è¼‰å…¥çµæœ:\n`;
                info += `å·²è§£é–å¡ç‰‡: ${Object.keys(ownedCards).length} å¼µ\n`;
                info += `ç¢ç‰‡ç¨®é¡: ${Object.keys(shards).length} ç¨®\n`;
                info += `æœ€è¿‘ç²å¾—: ${recentlyObtainedCards.length} å¼µ\n`;
                
                if (Object.keys(ownedCards).length > 0) {
                    info += `å·²è§£é–å¡ç‰‡åˆ—è¡¨: ${JSON.stringify(Object.keys(ownedCards))}\n`;
                }
                
                status.className = 'status success';
                status.textContent = 'âœ… å¡ç‰‡è³‡æ–™è¼‰å…¥æˆåŠŸ';
                
            } catch (error) {
                info += `âŒ è¼‰å…¥å¡ç‰‡è³‡æ–™æ™‚ç™¼ç”ŸéŒ¯èª¤: ${error.message}\n`;
                status.className = 'status error';
                status.textContent = 'âŒ å¡ç‰‡è³‡æ–™è¼‰å…¥å¤±æ•—';
            }
            
            debugInfo.textContent = info;
        }
        
        // æ¸²æŸ“æ¸¬è©¦å¡ç‰‡
        function renderTestCards() {
            const testCardsDiv = document.getElementById('testCards');
            const status = document.getElementById('status');
            
            if (!window.allCards || window.allCards.length === 0) {
                status.className = 'status error';
                status.textContent = 'âŒ allCards ä¸å¯ç”¨ï¼Œç„¡æ³•æ¸²æŸ“å¡ç‰‡';
                return;
            }
            
            // é‡æ–°è¼‰å…¥å¡ç‰‡è³‡æ–™
            loadCardData();
            
            let html = '<h2>ğŸ´ æ¸¬è©¦å¡ç‰‡é¡¯ç¤º</h2>';
            
            // é¡¯ç¤ºæ°´æœå¡ç‰‡
            const fruitCards = ['apple', 'banana', 'orange', 'grape', 'strawberry'];
            
            fruitCards.forEach(fruit => {
                const card = window.allCards.find(c => c.word === fruit);
                if (card) {
                    const isUnlocked = ownedCards[fruit] || false;
                    const haveShards = shards[fruit] || 0;
                    const required = getRequiredShards(card.rarity);
                    
                    html += `
                        <div class="card ${isUnlocked ? 'unlocked' : 'locked'}">
                            <h3>${card.zh} (${card.word})</h3>
                            <p>ç¨€æœ‰åº¦: ${card.rarity}</p>
                            <p>è§£é–ç‹€æ…‹: ${isUnlocked ? 'âœ… å·²è§£é–' : 'ğŸ”’ æœªè§£é–'}</p>
                            <p>ç¢ç‰‡: ${haveShards}/${required}</p>
                            <p>é¡åˆ¥: ${card.category}</p>
                        </div>
                    `;
                } else {
                    html += `
                        <div class="card locked">
                            <h3>â“ ${fruit}</h3>
                            <p style="color: red;">æ‰¾ä¸åˆ°å¡ç‰‡è³‡æ–™</p>
                        </div>
                    `;
                }
            });
            
            testCardsDiv.innerHTML = html;
            status.className = 'status success';
            status.textContent = 'âœ… æ¸¬è©¦å¡ç‰‡æ¸²æŸ“å®Œæˆ';
        }
        
        // æ·»åŠ æ¸¬è©¦å¡ç‰‡
        function addTestCards() {
            const status = document.getElementById('status');
            
            // æ·»åŠ æ°´æœå¡ç‰‡åˆ°å·²è§£é–åˆ—è¡¨
            const fruitCards = ['apple', 'banana', 'orange', 'grape', 'strawberry'];
            
            fruitCards.forEach(fruit => {
                ownedCards[fruit] = true;
                shards[fruit] = 5; // çµ¦5å€‹ç¢ç‰‡
            });
            
            // åŒæ­¥åˆ° LinkageSystem
            if (typeof LinkageSystem !== 'undefined' && LinkageSystem.cards) {
                LinkageSystem.cards.setOwnedCards(ownedCards);
                LinkageSystem.cards.setShards(shards);
            } else {
                // ç›´æ¥æ›´æ–° localStorage
                localStorage.setItem('ownedCards', JSON.stringify(ownedCards));
                localStorage.setItem('cardShards', JSON.stringify(shards));
            }
            
            // æ·»åŠ åˆ°æœ€è¿‘ç²å¾—åˆ—è¡¨
            recentlyObtainedCards = fruitCards;
            localStorage.setItem('recentlyObtainedCards', JSON.stringify(recentlyObtainedCards));
            
            status.className = 'status success';
            status.textContent = 'âœ… æ¸¬è©¦å¡ç‰‡å·²æ·»åŠ ';
            
            // é‡æ–°æ¸²æŸ“
            renderTestCards();
        }
        
        // æ¸…é™¤æ¸¬è©¦å¡ç‰‡
        function clearTestCards() {
            const status = document.getElementById('status');
            
            // æ¸…é™¤æ°´æœå¡ç‰‡
            const fruitCards = ['apple', 'banana', 'orange', 'grape', 'strawberry'];
            
            fruitCards.forEach(fruit => {
                delete ownedCards[fruit];
                delete shards[fruit];
            });
            
            // åŒæ­¥åˆ° LinkageSystem
            if (typeof LinkageSystem !== 'undefined' && LinkageSystem.cards) {
                LinkageSystem.cards.setOwnedCards(ownedCards);
                LinkageSystem.cards.setShards(shards);
            } else {
                // ç›´æ¥æ›´æ–° localStorage
                localStorage.setItem('ownedCards', JSON.stringify(ownedCards));
                localStorage.setItem('cardShards', JSON.stringify(shards));
            }
            
            // æ¸…é™¤æœ€è¿‘ç²å¾—åˆ—è¡¨
            recentlyObtainedCards = [];
            localStorage.setItem('recentlyObtainedCards', JSON.stringify(recentlyObtainedCards));
            
            status.className = 'status warning';
            status.textContent = 'ğŸ—‘ï¸ æ¸¬è©¦å¡ç‰‡å·²æ¸…é™¤';
            
            // é‡æ–°æ¸²æŸ“
            renderTestCards();
        }
        
        // æ ¹æ“šç¨€æœ‰åº¦å›å‚³æ‰€éœ€ç¢ç‰‡æ•¸é‡
        function getRequiredShards(rarity) {
            switch(rarity) {
                case 'æ™®é€š': return 1;
                case 'ç¨€æœ‰': return 3;
                case 'è¶…ç¨€æœ‰': return 5;
                default: return 1;
            }
        }
        
        // é é¢è¼‰å…¥æ™‚è‡ªå‹•æª¢æŸ¥
        window.addEventListener('load', function() {
            setTimeout(() => {
                checkLinkageSystem();
                setTimeout(() => {
                    checkAllCards();
                    setTimeout(() => {
                        loadCardData();
                        setTimeout(() => {
                            renderTestCards();
                        }, 500);
                    }, 500);
                }, 500);
            }, 1000);
        });
    </script>
</body>
</html> 