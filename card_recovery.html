<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>å¡ç‰‡æ¢å¾©å·¥å…· - Typing Hero</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body {
      font-family: 'Arial', sans-serif;
      margin: 20px;
      background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
      color: #fff;
      min-height: 100vh;
    }
    .container {
      max-width: 800px;
      margin: 0 auto;
      padding: 20px;
    }
    .card {
      background: rgba(255, 255, 255, 0.1);
      border-radius: 10px;
      padding: 20px;
      margin: 20px 0;
      border: 1px solid rgba(255, 255, 255, 0.2);
      backdrop-filter: blur(10px);
    }
    .status {
      padding: 15px;
      border-radius: 8px;
      margin: 10px 0;
      font-weight: bold;
    }
    .success { background: rgba(76, 175, 80, 0.2); border: 1px solid #4caf50; }
    .error { background: rgba(244, 67, 54, 0.2); border: 1px solid #f44336; }
    .warning { background: rgba(255, 193, 7, 0.2); border: 1px solid #ffc107; }
    .info { background: rgba(33, 150, 243, 0.2); border: 1px solid #2196f3; }
    .btn {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 8px;
      cursor: pointer;
      margin: 8px;
      font-weight: bold;
      transition: all 0.3s ease;
    }
    .btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(0,0,0,0.3);
    }
    .btn.danger {
      background: linear-gradient(135deg, #ff6b6b 0%, #ee5a52 100%);
    }
    .btn.success {
      background: linear-gradient(135deg, #4caf50 0%, #45a049 100%);
    }
    .log {
      background: rgba(0, 0, 0, 0.8);
      color: #00ff00;
      padding: 15px;
      border-radius: 8px;
      font-family: 'Courier New', monospace;
      max-height: 300px;
      overflow-y: auto;
      white-space: pre-wrap;
      border: 1px solid #00ff00;
    }
    .progress {
      background: rgba(0, 0, 0, 0.3);
      border-radius: 10px;
      padding: 10px;
      margin: 10px 0;
    }
    .progress-bar {
      background: linear-gradient(90deg, #00ff00, #00ffff);
      height: 20px;
      border-radius: 10px;
      transition: width 0.3s ease;
      text-align: center;
      line-height: 20px;
      color: #000;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸ”„ å¡ç‰‡æ¢å¾©å·¥å…·</h1>
    <p>é€™å€‹å·¥å…·å¯ä»¥å¹«åŠ©æ‚¨æ¢å¾©éºå¤±çš„å¡ç‰‡è³‡æ–™</p>
    
    <div class="card">
      <h2>ğŸ“Š ç•¶å‰ç‹€æ…‹</h2>
      <div id="currentStatus"></div>
      <button class="btn" onclick="checkCurrentStatus()">ğŸ”„ æª¢æŸ¥ç‹€æ…‹</button>
    </div>
    
    <div class="card">
      <h2>ğŸ’¾ å‚™ä»½ç®¡ç†</h2>
      <div id="backupStatus"></div>
      <button class="btn" onclick="createBackup()">ğŸ’¾ å‰µå»ºå‚™ä»½</button>
      <button class="btn success" onclick="restoreFromBackup()">ğŸ“¥ å¾å‚™ä»½æ¢å¾©</button>
      <button class="btn danger" onclick="clearBackup()">ğŸ—‘ï¸ æ¸…é™¤å‚™ä»½</button>
    </div>
    
    <div class="card">
      <h2>ğŸ”§ ä¿®å¾©å·¥å…·</h2>
      <button class="btn" onclick="generateTestData()">ğŸ§ª ç”Ÿæˆæ¸¬è©¦è³‡æ–™</button>
      <button class="btn" onclick="repairCardData()">ğŸ”§ ä¿®å¾©å¡ç‰‡è³‡æ–™</button>
      <button class="btn danger" onclick="resetAllData()">ğŸ—‘ï¸ é‡ç½®æ‰€æœ‰è³‡æ–™</button>
    </div>
    
    <div class="card">
      <h2>ğŸ“ æ“ä½œæ—¥èªŒ</h2>
      <div id="log" class="log"></div>
      <button class="btn" onclick="clearLog()">ğŸ—‘ï¸ æ¸…é™¤æ—¥èªŒ</button>
    </div>
    
    <div class="card">
      <h2>âš ï¸ é é˜²æªæ–½</h2>
      <div class="status info">
        <h3>å¦‚ä½•é¿å…å¡ç‰‡å†æ¬¡æ¶ˆå¤±ï¼š</h3>
        <ul>
          <li>å®šæœŸä½¿ç”¨ã€Œå‰µå»ºå‚™ä»½ã€åŠŸèƒ½</li>
          <li>é¿å…åœ¨é é¢ä¸­è¼¸å…¥ "clean" ç„¶å¾ŒæŒ‰ Enter</li>
          <li>ä¸è¦é»æ“Šã€Œé‡ç½®è³‡æ–™ã€æŒ‰éˆ•</li>
          <li>å®šæœŸå„²å­˜éŠæˆ²é€²åº¦</li>
          <li>é¿å…åœ¨ç„¡ç—•æ¨¡å¼ä¸‹éŠç©</li>
        </ul>
      </div>
    </div>
  </div>

  <!-- è¼‰å…¥å¿…è¦çš„ JavaScript -->
  <script src="js/sound.js"></script>
  <script src="js/userData.js"></script>
  <script src="js/autoSaveSystem.js"></script>
  <script src="js/starRewardSystem.js"></script>
  <script src="js/cardUtils.js"></script>
  <script src="js/cardStorage.js"></script>
  <script src="cards.js"></script>
  <script src="js/achievementSystem.js"></script>
  <script src="js/contextMenuSystem.js"></script>
  <script src="js/enhancedSaveReminder.js"></script>

  <script>
    let logMessages = [];
    
    function log(message, type = 'info') {
      const timestamp = new Date().toLocaleTimeString();
      const logEntry = `[${timestamp}] ${message}`;
      logMessages.push(logEntry);
      
      const logElement = document.getElementById('log');
      if (logElement) {
        logElement.textContent = logMessages.join('\n');
        logElement.scrollTop = logElement.scrollHeight;
      }
      
      console.log(logEntry);
    }
    
    function clearLog() {
      logMessages = [];
      document.getElementById('log').textContent = '';
    }
    
    function addStatus(elementId, message, type = 'info') {
      const element = document.getElementById(elementId);
      if (element) {
        element.innerHTML += `<div class="status ${type}">${message}</div>`;
      }
    }
    
    function clearStatus(elementId) {
      const element = document.getElementById(elementId);
      if (element) {
        element.innerHTML = '';
      }
    }
    
    function checkCurrentStatus() {
      clearStatus('currentStatus');
      log('é–‹å§‹æª¢æŸ¥ç•¶å‰ç‹€æ…‹...');
      
      // æª¢æŸ¥ç³»çµ±ç‹€æ…‹
      if (typeof window.allCards !== 'undefined' && window.allCards.length > 0) {
        addStatus('currentStatus', `âœ… å¡ç‰‡è³‡æ–™åº«å·²è¼‰å…¥: ${window.allCards.length} å¼µå¡ç‰‡`, 'success');
        log(`å¡ç‰‡è³‡æ–™åº«å·²è¼‰å…¥: ${window.allCards.length} å¼µå¡ç‰‡`);
      } else {
        addStatus('currentStatus', 'âŒ å¡ç‰‡è³‡æ–™åº«æœªè¼‰å…¥', 'error');
        log('å¡ç‰‡è³‡æ–™åº«æœªè¼‰å…¥', 'error');
      }
      
      if (typeof window.LinkageSystem !== 'undefined') {
        addStatus('currentStatus', 'âœ… é€£å‹•ç³»çµ±å·²è¼‰å…¥', 'success');
        log('é€£å‹•ç³»çµ±å·²è¼‰å…¥');
      } else {
        addStatus('currentStatus', 'âŒ é€£å‹•ç³»çµ±æœªè¼‰å…¥', 'error');
        log('é€£å‹•ç³»çµ±æœªè¼‰å…¥', 'error');
      }
      
      // æª¢æŸ¥å¡ç‰‡è³‡æ–™
      if (window.LinkageSystem) {
        try {
          const ownedCards = window.LinkageSystem.cards.getOwnedCards();
          const shards = window.LinkageSystem.cards.getShards();
          const totalStars = window.LinkageSystem.stars.get();
          
          const ownedCount = Object.keys(ownedCards).length;
          const shardCount = Object.keys(shards).length;
          const totalShards = Object.values(shards).reduce((sum, count) => sum + count, 0);
          
          addStatus('currentStatus', `ğŸ“Š å·²æ“æœ‰å¡ç‰‡: ${ownedCount} å¼µ`, 'info');
          addStatus('currentStatus', `ğŸ’ ç¢ç‰‡ç¨®é¡: ${shardCount} ç¨®`, 'info');
          addStatus('currentStatus', `ğŸ’ ç¸½ç¢ç‰‡æ•¸: ${totalShards} å€‹`, 'info');
          addStatus('currentStatus', `â­ ç¸½æ˜Ÿæ˜Ÿæ•¸: ${totalStars} é¡†`, 'info');
          
          log(`ç•¶å‰ç‹€æ…‹: å·²æ“æœ‰ ${ownedCount} å¼µå¡ç‰‡ï¼Œ${shardCount} ç¨®ç¢ç‰‡ï¼Œç¸½è¨ˆ ${totalShards} å€‹ç¢ç‰‡ï¼Œ${totalStars} é¡†æ˜Ÿæ˜Ÿ`);
          
        } catch (error) {
          addStatus('currentStatus', `âŒ æª¢æŸ¥å¡ç‰‡è³‡æ–™æ™‚ç™¼ç”ŸéŒ¯èª¤: ${error.message}`, 'error');
          log(`æª¢æŸ¥å¡ç‰‡è³‡æ–™æ™‚ç™¼ç”ŸéŒ¯èª¤: ${error.message}`, 'error');
        }
      }
    }
    
    function createBackup() {
      if (!window.LinkageSystem) {
        log('ç„¡æ³•å‰µå»ºå‚™ä»½ï¼šé€£å‹•ç³»çµ±æœªè¼‰å…¥', 'error');
        addStatus('backupStatus', 'âŒ ç„¡æ³•å‰µå»ºå‚™ä»½ï¼šé€£å‹•ç³»çµ±æœªè¼‰å…¥', 'error');
        return;
      }
      
      try {
        const backup = {
          timestamp: new Date().toISOString(),
          ownedCards: window.LinkageSystem.cards.getOwnedCards(),
          shards: window.LinkageSystem.cards.getShards(),
          totalStars: window.LinkageSystem.stars.get(),
          recentlyObtainedCards: JSON.parse(localStorage.getItem('recentlyObtainedCards') || '[]'),
          newCardTimestamps: JSON.parse(localStorage.getItem('newCardTimestamps') || '{}')
        };
        
        localStorage.setItem('cardBackup', JSON.stringify(backup));
        
        log('å‚™ä»½å‰µå»ºæˆåŠŸ');
        addStatus('backupStatus', 'âœ… å‚™ä»½å‰µå»ºæˆåŠŸ', 'success');
        
      } catch (error) {
        log(`å‰µå»ºå‚™ä»½å¤±æ•—: ${error.message}`, 'error');
        addStatus('backupStatus', `âŒ å‰µå»ºå‚™ä»½å¤±æ•—: ${error.message}`, 'error');
      }
    }
    
    function restoreFromBackup() {
      try {
        const backupStr = localStorage.getItem('cardBackup');
        if (!backupStr) {
          log('æ²’æœ‰æ‰¾åˆ°å‚™ä»½è³‡æ–™', 'warning');
          addStatus('backupStatus', 'âš ï¸ æ²’æœ‰æ‰¾åˆ°å‚™ä»½è³‡æ–™', 'warning');
          return;
        }
        
        const backup = JSON.parse(backupStr);
        
        if (window.LinkageSystem) {
          window.LinkageSystem.cards.setOwnedCards(backup.ownedCards);
          window.LinkageSystem.cards.setShards(backup.shards);
          window.LinkageSystem.stars.set(backup.totalStars);
          localStorage.setItem('recentlyObtainedCards', JSON.stringify(backup.recentlyObtainedCards));
          localStorage.setItem('newCardTimestamps', JSON.stringify(backup.newCardTimestamps));
        }
        
        log('è³‡æ–™æ¢å¾©æˆåŠŸ');
        addStatus('backupStatus', 'âœ… è³‡æ–™æ¢å¾©æˆåŠŸ', 'success');
        
        // é‡æ–°æª¢æŸ¥ç‹€æ…‹
        setTimeout(() => {
          checkCurrentStatus();
        }, 100);
        
      } catch (error) {
        log(`æ¢å¾©è³‡æ–™å¤±æ•—: ${error.message}`, 'error');
        addStatus('backupStatus', `âŒ æ¢å¾©è³‡æ–™å¤±æ•—: ${error.message}`, 'error');
      }
    }
    
    function clearBackup() {
      if (confirm('ç¢ºå®šè¦æ¸…é™¤å‚™ä»½è³‡æ–™å—ï¼Ÿ')) {
        localStorage.removeItem('cardBackup');
        log('å‚™ä»½è³‡æ–™å·²æ¸…é™¤');
        addStatus('backupStatus', 'ğŸ—‘ï¸ å‚™ä»½è³‡æ–™å·²æ¸…é™¤', 'warning');
      }
    }
    
    function generateTestData() {
      if (!window.allCards || window.allCards.length === 0) {
        log('ç„¡æ³•ç”Ÿæˆæ¸¬è©¦è³‡æ–™ï¼šå¡ç‰‡è³‡æ–™åº«æœªè¼‰å…¥', 'error');
        return;
      }
      
      if (!window.LinkageSystem) {
        log('ç„¡æ³•ç”Ÿæˆæ¸¬è©¦è³‡æ–™ï¼šé€£å‹•ç³»çµ±æœªè¼‰å…¥', 'error');
        return;
      }
      
      try {
        // éš¨æ©Ÿé¸æ“‡ä¸€äº›å¡ç‰‡
        const testOwnedCards = {};
        const testCount = Math.min(15, window.allCards.length);
        
        for (let i = 0; i < testCount; i++) {
          const card = window.allCards[i];
          testOwnedCards[card.word] = true;
        }
        
        window.LinkageSystem.cards.setOwnedCards(testOwnedCards);
        window.LinkageSystem.stars.set(200);
        
        log(`æ¸¬è©¦è³‡æ–™ç”ŸæˆæˆåŠŸï¼š${testCount} å¼µå¡ç‰‡`);
        addStatus('currentStatus', `âœ… æ¸¬è©¦è³‡æ–™ç”ŸæˆæˆåŠŸï¼š${testCount} å¼µå¡ç‰‡`, 'success');
        
        // é‡æ–°æª¢æŸ¥ç‹€æ…‹
        setTimeout(() => {
          checkCurrentStatus();
        }, 100);
        
      } catch (error) {
        log(`ç”Ÿæˆæ¸¬è©¦è³‡æ–™å¤±æ•—: ${error.message}`, 'error');
      }
    }
    
    function repairCardData() {
      if (!window.LinkageSystem) {
        log('ç„¡æ³•ä¿®å¾©è³‡æ–™ï¼šé€£å‹•ç³»çµ±æœªè¼‰å…¥', 'error');
        return;
      }
      
      try {
        // æª¢æŸ¥ä¸¦ä¿®å¾©å¡ç‰‡è³‡æ–™
        const ownedCards = window.LinkageSystem.cards.getOwnedCards();
        const shards = window.LinkageSystem.cards.getShards();
        
        // ç§»é™¤ç„¡æ•ˆçš„å¡ç‰‡å¼•ç”¨
        const validOwnedCards = {};
        
        if (window.allCards) {
          window.allCards.forEach(card => {
            if (ownedCards[card.word]) {
              validOwnedCards[card.word] = true;
            }
          });
        }
        
        window.LinkageSystem.cards.setOwnedCards(validOwnedCards);
        
        log('å¡ç‰‡è³‡æ–™ä¿®å¾©å®Œæˆ');
        addStatus('currentStatus', 'âœ… å¡ç‰‡è³‡æ–™ä¿®å¾©å®Œæˆ', 'success');
        
        // é‡æ–°æª¢æŸ¥ç‹€æ…‹
        setTimeout(() => {
          checkCurrentStatus();
        }, 100);
        
      } catch (error) {
        log(`ä¿®å¾©è³‡æ–™å¤±æ•—: ${error.message}`, 'error');
      }
    }
    
    function resetAllData() {
      if (!confirm('ç¢ºå®šè¦é‡ç½®æ‰€æœ‰è³‡æ–™å—ï¼Ÿæ­¤æ“ä½œç„¡æ³•å¾©åŸï¼')) {
        return;
      }
      
      if (!window.LinkageSystem) {
        log('ç„¡æ³•é‡ç½®è³‡æ–™ï¼šé€£å‹•ç³»çµ±æœªè¼‰å…¥', 'error');
        return;
      }
      
      try {
        window.LinkageSystem.cards.setOwnedCards({});
        window.LinkageSystem.stars.set(0);
        localStorage.removeItem('recentlyObtainedCards');
        localStorage.removeItem('newCardTimestamps');
        
        log('æ‰€æœ‰è³‡æ–™å·²é‡ç½®');
        addStatus('currentStatus', 'ğŸ—‘ï¸ æ‰€æœ‰è³‡æ–™å·²é‡ç½®', 'warning');
        
        // é‡æ–°æª¢æŸ¥ç‹€æ…‹
        setTimeout(() => {
          checkCurrentStatus();
        }, 100);
        
      } catch (error) {
        log(`é‡ç½®è³‡æ–™å¤±æ•—: ${error.message}`, 'error');
      }
    }
    
    // é é¢è¼‰å…¥æ™‚è‡ªå‹•æª¢æŸ¥
    window.addEventListener('load', function() {
      log('å¡ç‰‡æ¢å¾©å·¥å…·å·²è¼‰å…¥');
      
      setTimeout(() => {
        checkCurrentStatus();
      }, 2000);
    });
  </script>
</body>
</html> 